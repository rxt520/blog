(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{372:function(s,t,n){"use strict";n.r(t);var a=n(3),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"nginx-跨域解决"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx-跨域解决"}},[s._v("#")]),s._v(" Nginx 跨域解决")]),s._v(" "),n("h2",{attrs:{id:"什么是跨域问题？"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是跨域问题？"}},[s._v("#")]),s._v(" 什么是跨域问题？")]),s._v(" "),n("p",[s._v("跨域，指的是浏览器不能执行其他网站的脚本。它是由浏览器的同源策略造成的，是浏览器对 JavaScript 施加的安全限制。")]),s._v(" "),n("h2",{attrs:{id:"什么是同源？"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是同源？"}},[s._v("#")]),s._v(" 什么是同源？")]),s._v(" "),n("p",[s._v("所谓同源是指，域名，协议，端口均相同")]),s._v(" "),n("ul",[n("li",[s._v("http://www.funtl.com --\x3e http://admin.funtl.com 跨域")]),s._v(" "),n("li",[s._v("http://www.funtl.com --\x3e http://www.funtl.com 非跨域")]),s._v(" "),n("li",[s._v("http://www.funtl.com --\x3e http://www.funtl.com:8080 跨域")]),s._v(" "),n("li",[s._v("http://www.funtl.com --\x3e https://www.funtl.com 跨域")])]),s._v(" "),n("h2",{attrs:{id:"如何解决跨域问题？"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何解决跨域问题？"}},[s._v("#")]),s._v(" 如何解决跨域问题？")]),s._v(" "),n("h3",{attrs:{id:"使用-cors（跨资源共享）解决跨域问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-cors（跨资源共享）解决跨域问题"}},[s._v("#")]),s._v(" 使用 "),n("code",[s._v("CORS")]),s._v("（跨资源共享）解决跨域问题")]),s._v(" "),n("p",[n("code",[s._v("CORS")]),s._v(" 是一个"),n("code",[s._v("W3C")]),s._v('标准，全称是"跨域资源共享"（Cross-origin resource sharing）。它允许浏览器向跨源服务器，发出 '),n("code",[s._v("XMLHttpRequest")]),s._v("请求，从而克服了 AJAX 只能同源使用的限制。")]),s._v(" "),n("p",[n("code",[s._v("CORS")]),s._v("需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，IE 浏览器不能低于"),n("code",[s._v("IE10")]),s._v("。整个 "),n("code",[s._v("CORS")]),s._v("通信过程，都是浏览器自动完成，不需要用户参与。对于开发者来说，"),n("code",[s._v("CORS")]),s._v(" 通信与同源的 AJAX 通信没有差别，代码完全一样。浏览器一旦发现 AJAX 请求跨源，就会自动添加一些附加的头信息，有时还会多出一次附加的请求，但用户不会有感觉。因此，实现 "),n("code",[s._v("CORS")]),s._v(" 通信的关键是服务器。只要服务器实现了"),n("code",[s._v("CORS")]),s._v("接口，就可以跨源通信（在 "),n("code",[s._v("header")]),s._v(" 中设置："),n("code",[s._v("Access-Control-Allow-Origin")]),s._v("）")]),s._v(" "),n("h3",{attrs:{id:"使用-jsonp解决跨域问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-jsonp解决跨域问题"}},[s._v("#")]),s._v(" 使用 "),n("code",[s._v("JSONP")]),s._v("解决跨域问题")]),s._v(" "),n("p",[n("code",[s._v("JSONP")]),s._v("（"),n("code",[s._v("JSON")]),s._v(" with Padding）是"),n("code",[s._v("JSON")]),s._v(" 的一种“使用模式”，可用于解决主流浏览器的跨域数据访问的问题。由于同源策略，一般来说位于 "),n("code",[s._v("server1.example.com")]),s._v(" 的网页无法与 "),n("code",[s._v("server2.example.com")]),s._v(" 的服务器沟通，而 HTML 的 "),n("code",[s._v("元素是一个例外。利用")]),s._v(" 元素的这个开放策略，网页可以得到从其他来源动态产生的 JSON 资料，而这种使用模式就是所谓的"),n("code",[s._v("JSONP")]),s._v("。用"),n("code",[s._v("JSONP")]),s._v("抓到的资料并不是 "),n("code",[s._v("JSON")]),s._v("，而是任意的 JavaScript，用 JavaScript 直译器执行而不是用"),n("code",[s._v("JSON")]),s._v(" 解析器解析（需要目标服务器配合一个 "),n("code",[s._v("callback")]),s._v(" 函数）。")]),s._v(" "),n("h3",{attrs:{id:"cors-与-jsonp的比较"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cors-与-jsonp的比较"}},[s._v("#")]),s._v(" "),n("code",[s._v("CORS")]),s._v(" 与 "),n("code",[s._v("JSONP")]),s._v("的比较")]),s._v(" "),n("p",[n("code",[s._v("CORS")]),s._v(" 与"),n("code",[s._v("JSONP")]),s._v(" 的使用目的相同，但是比"),n("code",[s._v("JSONP")]),s._v("更强大。")]),s._v(" "),n("p",[s._v("J"),n("code",[s._v("SONP")]),s._v("只支持 GET 请求，"),n("code",[s._v("CORS")]),s._v(" 支持所有类型的 HTTP 请求。"),n("code",[s._v("JSONP")]),s._v(" 的优势在于支持老式浏览器，以及可以向不支持"),n("code",[s._v("CORS")]),s._v("的网站请求数据。")]),s._v(" "),n("h3",{attrs:{id:"使用-nginx-反向代理解决跨域问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-nginx-反向代理解决跨域问题"}},[s._v("#")]),s._v(" 使用 "),n("code",[s._v("Nginx")]),s._v(" 反向代理解决跨域问题")]),s._v(" "),n("p",[s._v("以上跨域问题解决方案都需要服务器支持，当服务器无法设置 "),n("code",[s._v("header")]),s._v(" 或提供 "),n("code",[s._v("callback")]),s._v(" 时我们就可以采用 "),n("code",[s._v("Nginx")]),s._v("反向代理的方式解决跨域问题。")]),s._v(" "),n("p",[s._v("以下为文件上传的跨域配置方案：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("user  nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nworker_processes  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nevents "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    worker_connections  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nhttp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    include       mime.types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    default_type  application/octet-stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    sendfile        on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    keepalive_timeout  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name upload.myshop.com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        add_header "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Origin'")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        add_header "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Headers'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Content-Range,Range'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        location / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            proxy_pass  http://192.168.0.104:8888"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_method")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'OPTIONS'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                add_header Access-Control-Allow-Origin  *"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                add_header Access-Control-Allow-Headers X-Requested-With"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,PATCH,OPTIONS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解决假请求问题，如果是简单请求则没有这个问题，但这里是上传文件，首次请求为 OPTIONS 方式，实际请求为 POST 方式")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Provisional headers are shown.")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Request header field Cache-Control is not allowed by Access-Control-Allow-Headers in preflight response.")]),s._v("\n                add_header Access-Control-Allow-Headers DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Content-Range,Range"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);