<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>项目实战 Myshop | blog</title>
    <meta name="description" content="blog">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="/favicon.ico">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.29b4407c.css" as="style"><link rel="preload" href="/assets/js/app.20e080e3.js" as="script"><link rel="preload" href="/assets/js/3.69b4042a.js" as="script"><link rel="preload" href="/assets/js/1.c4c6ad86.js" as="script"><link rel="preload" href="/assets/js/41.79742567.js" as="script"><link rel="prefetch" href="/assets/js/10.fbf5bf0b.js"><link rel="prefetch" href="/assets/js/11.89c72eac.js"><link rel="prefetch" href="/assets/js/12.8f3fc90e.js"><link rel="prefetch" href="/assets/js/13.606381d5.js"><link rel="prefetch" href="/assets/js/14.7a61181a.js"><link rel="prefetch" href="/assets/js/15.2595a1ba.js"><link rel="prefetch" href="/assets/js/16.3a0abb52.js"><link rel="prefetch" href="/assets/js/17.6a344db1.js"><link rel="prefetch" href="/assets/js/18.4bf78878.js"><link rel="prefetch" href="/assets/js/19.8f00e0c6.js"><link rel="prefetch" href="/assets/js/20.260311cc.js"><link rel="prefetch" href="/assets/js/21.8578208c.js"><link rel="prefetch" href="/assets/js/22.20e75bd8.js"><link rel="prefetch" href="/assets/js/23.363521a2.js"><link rel="prefetch" href="/assets/js/24.15a014dc.js"><link rel="prefetch" href="/assets/js/25.f74701fe.js"><link rel="prefetch" href="/assets/js/26.9805c56f.js"><link rel="prefetch" href="/assets/js/27.c059cd71.js"><link rel="prefetch" href="/assets/js/28.04fb7d74.js"><link rel="prefetch" href="/assets/js/29.b1ef7687.js"><link rel="prefetch" href="/assets/js/30.5fb4a460.js"><link rel="prefetch" href="/assets/js/31.860de359.js"><link rel="prefetch" href="/assets/js/32.d40511a0.js"><link rel="prefetch" href="/assets/js/33.abe76948.js"><link rel="prefetch" href="/assets/js/34.c95627c4.js"><link rel="prefetch" href="/assets/js/35.884b7ac2.js"><link rel="prefetch" href="/assets/js/36.ce4ffc06.js"><link rel="prefetch" href="/assets/js/37.ed7666d7.js"><link rel="prefetch" href="/assets/js/38.6efa9d7f.js"><link rel="prefetch" href="/assets/js/39.ff98a367.js"><link rel="prefetch" href="/assets/js/4.295bb786.js"><link rel="prefetch" href="/assets/js/40.040344ed.js"><link rel="prefetch" href="/assets/js/42.bea47c85.js"><link rel="prefetch" href="/assets/js/43.14107803.js"><link rel="prefetch" href="/assets/js/44.f793a44c.js"><link rel="prefetch" href="/assets/js/45.293deda9.js"><link rel="prefetch" href="/assets/js/46.025ac826.js"><link rel="prefetch" href="/assets/js/47.9857334e.js"><link rel="prefetch" href="/assets/js/48.4d7aeb19.js"><link rel="prefetch" href="/assets/js/5.6ab23509.js"><link rel="prefetch" href="/assets/js/6.a01c80cf.js"><link rel="prefetch" href="/assets/js/7.6ced6a0e.js"><link rel="prefetch" href="/assets/js/8.3a631268.js"><link rel="prefetch" href="/assets/js/9.09f4064e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.29b4407c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container" data-v-4698c43e><div data-v-4698c43e><div id="loader-wrapper" class="loading-wrapper" data-v-4b73742e data-v-4698c43e data-v-4698c43e><div class="loader-main" data-v-4b73742e><div data-v-4b73742e></div><div data-v-4b73742e></div><div data-v-4b73742e></div><div data-v-4b73742e></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-6cbeab0a data-v-4698c43e data-v-4698c43e><h3 class="title" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a>blog</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><input type="password" value="" data-v-6cbeab0a> <span data-v-6cbeab0a>Konck! Knock!</span> <button data-v-6cbeab0a>OK</button></label> <div class="footer" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><span data-v-6cbeab0a><i class="iconfont reco-theme" data-v-6cbeab0a></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-6cbeab0a>vuePress-theme-reco</a></span> <span data-v-6cbeab0a><i class="iconfont reco-copyright" data-v-6cbeab0a></i> <a data-v-6cbeab0a><span data-v-6cbeab0a>blog</span>
            
          <span data-v-6cbeab0a>2019 - </span>
          2020
        </a></span></div></div> <div class="hide" data-v-4698c43e><header class="navbar" data-v-4698c43e><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="blog" class="logo"> <span class="site-name">blog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Linux/" class="nav-link"><i class="iconfont undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/categories/java/" class="nav-link"><i class="iconfont undefined"></i>
  java
</a></li><li class="dropdown-item"><!----> <a href="/categories/java 后端/" class="nav-link"><i class="iconfont undefined"></i>
  java 后端
</a></li><li class="dropdown-item"><!----> <a href="/categories/typora/" class="nav-link"><i class="iconfont undefined"></i>
  typora
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue/" class="nav-link"><i class="iconfont undefined"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/categories/java 基础/" class="nav-link"><i class="iconfont undefined"></i>
  java 基础
</a></li><li class="dropdown-item"><!----> <a href="/categories/编程方法/" class="nav-link"><i class="iconfont undefined"></i>
  编程方法
</a></li><li class="dropdown-item"><!----> <a href="/categories/Mysql/" class="nav-link"><i class="iconfont undefined"></i>
  Mysql
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-npm"></i>
      在线工具
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://smallpdf.com/cn/pdf-to-word" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  PDF 转换器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.bejson.com/jsoneditoronline" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  JSON 编辑器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://tableconvert.com/?output=text" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  MD 表格生成器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://cron.qqe2.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  CRON 表达式
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://tool.oschina.net/codeformat/html" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  代码格式化
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://zh.numberempire.com/latexequationeditor.php" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  公式编辑器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://cli.im/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  二维码生成器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://tool.chinaz.com/tools/native_ascii.aspx" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  在线编码转换
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.toyaml.com" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  YAML &lt;-&gt; Properties
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://jsfiddle.net/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  在线 Web 练习
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.github.com/rxt520" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/.html" class="nav-link"><i class="iconfont reco-jianshu"></i>
  简书
</a></li><li class="dropdown-item"><!----> <a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/.html" class="nav-link"><i class="iconfont reco-csdn"></i>
  CSDN
</a></li><li class="dropdown-item"><!----> <a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/.html" class="nav-link"><i class="iconfont reco-bokeyuan"></i>
  博客圆
</a></li><li class="dropdown-item"><!----> <a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/.html" class="nav-link"><i class="iconfont reco-wechat"></i>
  WeChat
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-4698c43e></div> <aside class="sidebar" data-v-4698c43e><div class="personal-info-wrapper" data-v-6c8ffc9c><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-6c8ffc9c> <h3 class="name" data-v-6c8ffc9c>
    blog
  </h3> <div class="num" data-v-6c8ffc9c><div data-v-6c8ffc9c><h3 data-v-6c8ffc9c>23</h3> <h6 data-v-6c8ffc9c>文章</h6></div> <div data-v-6c8ffc9c><h3 data-v-6c8ffc9c>16</h3> <h6 data-v-6c8ffc9c>标签</h6></div></div> <hr data-v-6c8ffc9c></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Linux/" class="nav-link"><i class="iconfont undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/categories/java/" class="nav-link"><i class="iconfont undefined"></i>
  java
</a></li><li class="dropdown-item"><!----> <a href="/categories/java 后端/" class="nav-link"><i class="iconfont undefined"></i>
  java 后端
</a></li><li class="dropdown-item"><!----> <a href="/categories/typora/" class="nav-link"><i class="iconfont undefined"></i>
  typora
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue/" class="nav-link"><i class="iconfont undefined"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/categories/java 基础/" class="nav-link"><i class="iconfont undefined"></i>
  java 基础
</a></li><li class="dropdown-item"><!----> <a href="/categories/编程方法/" class="nav-link"><i class="iconfont undefined"></i>
  编程方法
</a></li><li class="dropdown-item"><!----> <a href="/categories/Mysql/" class="nav-link"><i class="iconfont undefined"></i>
  Mysql
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-npm"></i>
      在线工具
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://smallpdf.com/cn/pdf-to-word" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  PDF 转换器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.bejson.com/jsoneditoronline" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  JSON 编辑器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://tableconvert.com/?output=text" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  MD 表格生成器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://cron.qqe2.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  CRON 表达式
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://tool.oschina.net/codeformat/html" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  代码格式化
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://zh.numberempire.com/latexequationeditor.php" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  公式编辑器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://cli.im/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  二维码生成器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://tool.chinaz.com/tools/native_ascii.aspx" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  在线编码转换
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.toyaml.com" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  YAML &lt;-&gt; Properties
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://jsfiddle.net/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  在线 Web 练习
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.github.com/rxt520" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/.html" class="nav-link"><i class="iconfont reco-jianshu"></i>
  简书
</a></li><li class="dropdown-item"><!----> <a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/.html" class="nav-link"><i class="iconfont reco-csdn"></i>
  CSDN
</a></li><li class="dropdown-item"><!----> <a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/.html" class="nav-link"><i class="iconfont reco-bokeyuan"></i>
  博客圆
</a></li><li class="dropdown-item"><!----> <a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/.html" class="nav-link"><i class="iconfont reco-wechat"></i>
  WeChat
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>项目实战 Myshop</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#myshopplus-简介" class="sidebar-link">MyShopPlus 简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#开发工具" class="sidebar-link">开发工具</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#后端技术" class="sidebar-link">后端技术</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#前端技术" class="sidebar-link">前端技术</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#框架集成" class="sidebar-link">框架集成</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#后台功能清单" class="sidebar-link">后台功能清单</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#前台功能清单" class="sidebar-link">前台功能清单</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#基础设施规划" class="sidebar-link">基础设施规划</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#容器部署配置" class="sidebar-link">容器部署配置</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#myshopplus-helm" class="sidebar-link">MyShopPlus Helm</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#概述-2" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#kubernetes-的应用部署" class="sidebar-link">Kubernetes 的应用部署</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#什么是-helm" class="sidebar-link">什么是 Helm</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#组件及相关术语" class="sidebar-link">组件及相关术语</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#工作原理" class="sidebar-link">工作原理</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#安装-helm" class="sidebar-link">安装 Helm</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#卸载-tiller" class="sidebar-link">卸载 Tiller</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#myshopplus-tidb-简介" class="sidebar-link">MyShopPlus TiDB 简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#什么是-tidb" class="sidebar-link">什么是 TiDB</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#核心特点" class="sidebar-link">核心特点</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#整体架构" class="sidebar-link">整体架构</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#技术内幕" class="sidebar-link">技术内幕</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#附：扩展阅读" class="sidebar-link">附：扩展阅读</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#myshopplus-tidb-operator" class="sidebar-link">MyShopPlus TiDB Operator</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#什么是-tidb-operator" class="sidebar-link">什么是 TiDB Operator</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#为什么-tidb-operator" class="sidebar-link">为什么 TiDB Operator</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#原理解析" class="sidebar-link">原理解析</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#安装-tidb-operator" class="sidebar-link">安装 TiDB Operator</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#【补充】kubernetes-v1-15-安装-tidb-v1-0-1" class="sidebar-link">【补充】Kubernetes v1.15 安装 TiDB v1.0.1</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#安装客户端-helm-2" class="sidebar-link">安装客户端 Helm</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#安装服务端-tiller-2" class="sidebar-link">安装服务端 Tiller</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#给-tiller-授权-2" class="sidebar-link">给 Tiller 授权</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#验证安装是否成功-2" class="sidebar-link">验证安装是否成功</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#安装-pingcap-官方-chart-仓库" class="sidebar-link">安装 PingCap 官方 chart 仓库</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#卸载-tiller-2" class="sidebar-link">卸载 Tiller</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#配置本地持久化卷" class="sidebar-link">配置本地持久化卷</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#为虚拟机添加新的磁盘" class="sidebar-link">为虚拟机添加新的磁盘</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#查看新磁盘" class="sidebar-link">查看新磁盘</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#格式化磁盘" class="sidebar-link">格式化磁盘</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#挂载磁盘" class="sidebar-link">挂载磁盘</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#准备本地卷" class="sidebar-link">准备本地卷</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#安装-tidb-operator-2" class="sidebar-link">安装 TiDB Operator</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#安装-crd" class="sidebar-link">安装 CRD</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#获取并修改配置文件" class="sidebar-link">获取并修改配置文件</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#安装-operator" class="sidebar-link">安装 Operator</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#安装-tidb-cluster" class="sidebar-link">安装 TiDB Cluster</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#获取配置文件" class="sidebar-link">获取配置文件</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#安装-cluster" class="sidebar-link">安装 Cluster</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#查看-pod-状态" class="sidebar-link">查看 Pod 状态</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#访问数据库" class="sidebar-link">访问数据库</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#【补充】kubernetes-v1-16-安装-tidb-v1-0-x" class="sidebar-link">【补充】Kubernetes v1.16 安装 TiDB v1.0.x</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#概述-3" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#安装-helm-2" class="sidebar-link">安装 Helm</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#配置本地持久化卷-2" class="sidebar-link">配置本地持久化卷</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#克隆-tidb-operator-到本地" class="sidebar-link">克隆 TiDB Operator 到本地</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#准备本地卷-2" class="sidebar-link">准备本地卷</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#安装-tidb-operator-3" class="sidebar-link">安装 TiDB Operator</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#安装-tidb-cluster-2" class="sidebar-link">安装 TiDB Cluster</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#myshopplus-创建项目工程" class="sidebar-link">MyShopPlus 创建项目工程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#工程-pom" class="sidebar-link">工程 POM</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#依赖管理-pom" class="sidebar-link">依赖管理 POM</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#初始化数据库" class="sidebar-link">初始化数据库</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#myshopplus-部署注册中心" class="sidebar-link">MyShopPlus 部署注册中心</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#准备-nfs" class="sidebar-link">准备 NFS</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#克隆-nacos" class="sidebar-link">克隆 Nacos</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#部署-nfs" class="sidebar-link">部署 NFS</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#部署数据库" class="sidebar-link">部署数据库</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#部署-nacos" class="sidebar-link">部署 Nacos</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#路由-nacos" class="sidebar-link">路由 Nacos</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#扩容选举-leader" class="sidebar-link">扩容选举 Leader</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#附：其它小记" class="sidebar-link">附：其它小记</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#myshopplus-用户服务提供者" class="sidebar-link">MyShopPlus 用户服务提供者</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#概述-4" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#创建提供者模块" class="sidebar-link">创建提供者模块</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#创建用户服务接口" class="sidebar-link">创建用户服务接口</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#创建用户服务实现" class="sidebar-link">创建用户服务实现</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#myshopplus-用户注册服务" class="sidebar-link">MyShopPlus 用户注册服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#概述-5" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#创建业务服务模块" class="sidebar-link">创建业务服务模块</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#修改用户服务提供者" class="sidebar-link">修改用户服务提供者</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#创建资源配置类" class="sidebar-link">创建资源配置类</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#创建通用类模块" class="sidebar-link">创建通用类模块</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#创建通用传输对象模块" class="sidebar-link">创建通用传输对象模块</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#创建用户注册服务" class="sidebar-link">创建用户注册服务</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#myshopplus-创建认证服务" class="sidebar-link">MyShopPlus 创建认证服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#概述-6" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#pom-5" class="sidebar-link">POM</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#application-yml-3" class="sidebar-link">application.yml</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#application-3" class="sidebar-link">Application</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#自定义认证授权" class="sidebar-link">自定义认证授权</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#服务器安全配置" class="sidebar-link">服务器安全配置</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#认证服务器配置" class="sidebar-link">认证服务器配置</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#登录获取令牌" class="sidebar-link">登录获取令牌</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#myshopplus-创建后台客户端" class="sidebar-link">MyShopPlus 创建后台客户端</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#概述-7" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#构建步骤" class="sidebar-link">构建步骤</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#发布" class="sidebar-link">发布</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#其它" class="sidebar-link">其它</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#myshopplus-okhttp3" class="sidebar-link">MyShopPlus OKHttp3</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#概述-8" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#特性" class="sidebar-link">特性</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#功能" class="sidebar-link">功能</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#依赖" class="sidebar-link">依赖</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#测试请求" class="sidebar-link">测试请求</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#工具类" class="sidebar-link">工具类</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#myshopplus-完善登录和注销" class="sidebar-link">MyShopPlus 完善登录和注销</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#概述-9" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#websecurity" class="sidebar-link">WebSecurity</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#authorizationserver" class="sidebar-link">AuthorizationServer</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#userdetailsservice" class="sidebar-link">UserDetailsService</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#logincontroller" class="sidebar-link">LoginController</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#myshopplus-创建路由网关" class="sidebar-link">MyShopPlus 创建路由网关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#spring-cloud-gateway" class="sidebar-link">Spring Cloud Gateway</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#功能特征" class="sidebar-link">功能特征</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#工程流程" class="sidebar-link">工程流程</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#创建网关服务" class="sidebar-link">创建网关服务</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#myshopplus-番外-更新版本号" class="sidebar-link">MyShopPlus 番外-更新版本号</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#概述-10" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#工程" class="sidebar-link">工程</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#依赖管理项目" class="sidebar-link">依赖管理项目</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#网关服务" class="sidebar-link">网关服务</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#用户管理服务提供者" class="sidebar-link">用户管理服务提供者</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#注册服务" class="sidebar-link">注册服务</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#认证服务" class="sidebar-link">认证服务</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/%E5%AE%9E%E6%88%98/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%20Myshop.html#个人信息服务" class="sidebar-link">个人信息服务</a></li></ul></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-6cbeab0a data-v-4698c43e><h3 class="title" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a></h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><input type="password" value="" data-v-6cbeab0a> <span data-v-6cbeab0a>Konck! Knock!</span> <button data-v-6cbeab0a>OK</button></label> <div class="footer" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><span data-v-6cbeab0a><i class="iconfont reco-theme" data-v-6cbeab0a></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-6cbeab0a>vuePress-theme-reco</a></span> <span data-v-6cbeab0a><i class="iconfont reco-copyright" data-v-6cbeab0a></i> <a data-v-6cbeab0a><span data-v-6cbeab0a>blog</span>
            
          <span data-v-6cbeab0a>2019 - </span>
          2020
        </a></span></div></div> <div data-v-4698c43e><main class="page"><!----> <div class="page-title" style="display:none;"><h1>项目实战 Myshop</h1> <hr> <div data-v-484a899e><i class="iconfont reco-account" data-v-484a899e><span data-v-484a899e>blog</span></i> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default" style="display:none;"><h1 id="项目实战-myshop"><a href="#项目实战-myshop" class="header-anchor">#</a> 项目实战 Myshop</h1> <h2 id="myshopplus-简介"><a href="#myshopplus-简介" class="header-anchor">#</a> MyShopPlus 简介</h2> <h3 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h3> <p><strong>MyShopPlus</strong> 项目致力于推广并普及 <strong>微服务架构</strong> 思想，采用全新 <strong>服务网格</strong> 系统打造电商生态级产品。</p> <h3 id="开发工具"><a href="#开发工具" class="header-anchor">#</a> 开发工具</h3> <table><thead><tr><th style="text-align:left;">工具</th> <th style="text-align:left;">下载地址</th></tr></thead> <tbody><tr><td style="text-align:left;">Intellij IDEA</td> <td style="text-align:left;"><a href="http://www.qfdmy.com/wp-content/themes/quanbaike/go.php?url=aHR0cHM6Ly93d3cuamV0YnJhaW5zLmNvbS9pZGVhL2Rvd25sb2Fk" target="_blank" rel="noopener noreferrer">https://www.jetbrains.com/idea/download<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td></tr> <tr><td style="text-align:left;">SwitchHosts</td> <td style="text-align:left;"><a href="http://www.qfdmy.com/wp-content/themes/quanbaike/go.php?url=aHR0cHM6Ly9vbGRqLmdpdGh1Yi5pby9Td2l0Y2hIb3N0cy8=" target="_blank" rel="noopener noreferrer">https://oldj.github.io/SwitchHosts/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td></tr> <tr><td style="text-align:left;">FinalShell</td> <td style="text-align:left;"><a href="http://www.qfdmy.com/wp-content/themes/quanbaike/go.php?url=aHR0cDovL3d3dy5ob3N0YnVmLmNvbS8=" target="_blank" rel="noopener noreferrer">http://www.hostbuf.com/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td></tr> <tr><td style="text-align:left;">Postman</td> <td style="text-align:left;"><a href="http://www.qfdmy.com/wp-content/themes/quanbaike/go.php?url=aHR0cHM6Ly93d3cuZ2V0cG9zdG1hbi5jb20vZG93bmxvYWRzLw==" target="_blank" rel="noopener noreferrer">https://www.getpostman.com/downloads/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td></tr> <tr><td style="text-align:left;">SQLyog</td> <td style="text-align:left;"><a href="http://www.qfdmy.com/wp-content/themes/quanbaike/go.php?url=aHR0cHM6Ly9zcWx5b2cuZW4uc29mdG9uaWMuY29tLw==" target="_blank" rel="noopener noreferrer">https://sqlyog.en.softonic.com/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td></tr> <tr><td style="text-align:left;">PicPick</td> <td style="text-align:left;"><a href="http://www.qfdmy.com/wp-content/themes/quanbaike/go.php?url=aHR0cHM6Ly9waWNwaWNrLmFwcC96aC9kb3dubG9hZA==" target="_blank" rel="noopener noreferrer">https://picpick.app/zh/download<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td></tr> <tr><td style="text-align:left;">亿图图示</td> <td style="text-align:left;"><a href="http://www.qfdmy.com/wp-content/themes/quanbaike/go.php?url=aHR0cHM6Ly93d3cuZWRyYXdzb2Z0LmNuL2VkcmF3bWF4Lw==" target="_blank" rel="noopener noreferrer">https://www.edrawsoft.cn/edrawmax/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td></tr> <tr><td style="text-align:left;">亿图导图</td> <td style="text-align:left;"><a href="http://www.qfdmy.com/wp-content/themes/quanbaike/go.php?url=aHR0cHM6Ly93d3cuZWRyYXdzb2Z0LmNuL21pbmRtYXN0ZXIv" target="_blank" rel="noopener noreferrer">https://www.edrawsoft.cn/mindmaster/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td></tr></tbody></table> <h3 id="后端技术"><a href="#后端技术" class="header-anchor">#</a> 后端技术</h3> <table><thead><tr><th style="text-align:left;">技术</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">Spring Boot</td> <td style="text-align:left;">新一代 JavaEE 开发标准</td></tr> <tr><td style="text-align:left;">Spring Cloud Alibaba</td> <td style="text-align:left;">阿里巴巴基于 Spring Cloud 编程模型的微服务生态</td></tr> <tr><td style="text-align:left;">Spring Cloud Alibaba Dubbo</td> <td style="text-align:left;">与 Spring Cloud Alibaba 生态相结合的高性能 Java RPC 框架</td></tr> <tr><td style="text-align:left;">Spring Security oAuth2</td> <td style="text-align:left;">安全认证和授权框架</td></tr> <tr><td style="text-align:left;">Spring Social</td> <td style="text-align:left;">第三方登录接入框架</td></tr> <tr><td style="text-align:left;">TkMyBatis</td> <td style="text-align:left;">基于 MyBatis 二次开发的轻量级框架，用于简化 MyBatis 操作</td></tr> <tr><td style="text-align:left;">MyBatisGenerator</td> <td style="text-align:left;">Maven 插件，用于 MyBatis 相关代码生成</td></tr> <tr><td style="text-align:left;">MybatisCodeHelper</td> <td style="text-align:left;">Intellij IDEA 插件，用于 MyBatis 相关代码生成</td></tr> <tr><td style="text-align:left;">PageHelper</td> <td style="text-align:left;">MyBatis 分页插件</td></tr> <tr><td style="text-align:left;">Swagger</td> <td style="text-align:left;">API 文档生成工具</td></tr> <tr><td style="text-align:left;">HikariCP</td> <td style="text-align:left;">数据库连接池</td></tr> <tr><td style="text-align:left;">Docker</td> <td style="text-align:left;">容器化引擎</td></tr> <tr><td style="text-align:left;">Docker Compose</td> <td style="text-align:left;">容器编排工具</td></tr> <tr><td style="text-align:left;">Kubernetes</td> <td style="text-align:left;">容器编排系统</td></tr> <tr><td style="text-align:left;">TiDB</td> <td style="text-align:left;">分布式数据库</td></tr> <tr><td style="text-align:left;">OKHttp3</td> <td style="text-align:left;">轻量级网络框架</td></tr></tbody></table> <h3 id="前端技术"><a href="#前端技术" class="header-anchor">#</a> 前端技术</h3> <table><thead><tr><th style="text-align:left;">技术</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">Vue</td> <td style="text-align:left;">前端框架，MVVM 模式的实现者</td></tr> <tr><td style="text-align:left;">Vue CLI</td> <td style="text-align:left;">Vue 脚手架，基于 NodeJS</td></tr> <tr><td style="text-align:left;">Vue Router</td> <td style="text-align:left;">Vue 路由框架</td></tr> <tr><td style="text-align:left;">Vuex</td> <td style="text-align:left;">Vue 全局状态管理框架</td></tr> <tr><td style="text-align:left;">Axios</td> <td style="text-align:left;">前端 HTTP 框架</td></tr> <tr><td style="text-align:left;">Element UI</td> <td style="text-align:left;">饿了么 UI 框架</td></tr> <tr><td style="text-align:left;">Vue Element Admin</td> <td style="text-align:left;">基于 Element UI 的前端后台解决方案</td></tr></tbody></table> <h3 id="框架集成"><a href="#框架集成" class="header-anchor">#</a> 框架集成</h3> <table><thead><tr><th style="text-align:left;">集成</th> <th style="text-align:left;">完成</th></tr></thead> <tbody><tr><td style="text-align:left;">Spring Boot</td> <td style="text-align:left;">✔</td></tr> <tr><td style="text-align:left;">Spring Cloud Alibaba</td> <td style="text-align:left;">✔</td></tr> <tr><td style="text-align:left;">Spring Cloud Alibaba Dubbo</td> <td style="text-align:left;">✔</td></tr> <tr><td style="text-align:left;">Spring Security oAuth2</td> <td style="text-align:left;">✔</td></tr> <tr><td style="text-align:left;">TkMyBatis</td> <td style="text-align:left;">✔</td></tr> <tr><td style="text-align:left;">HikariCP</td> <td style="text-align:left;">✔</td></tr> <tr><td style="text-align:left;">OKHttp3</td> <td style="text-align:left;">✔</td></tr> <tr><td style="text-align:left;">Feign 传递 Token</td> <td style="text-align:left;">✔</td></tr></tbody></table> <h3 id="后台功能清单"><a href="#后台功能清单" class="header-anchor">#</a> 后台功能清单</h3> <h4 id="后台登录"><a href="#后台登录" class="header-anchor">#</a> 后台登录</h4> <table><thead><tr><th style="text-align:left;">功能</th> <th style="text-align:left;">完成</th></tr></thead> <tbody><tr><td style="text-align:left;">用户注册</td> <td style="text-align:left;">✔</td></tr> <tr><td style="text-align:left;">用户登录</td> <td style="text-align:left;">✔</td></tr> <tr><td style="text-align:left;">获取 Token</td> <td style="text-align:left;">✔</td></tr> <tr><td style="text-align:left;">刷新 Token</td> <td style="text-align:left;"></td></tr></tbody></table> <h4 id="个人信息"><a href="#个人信息" class="header-anchor">#</a> 个人信息</h4> <table><thead><tr><th style="text-align:left;">功能</th> <th style="text-align:left;">完成</th></tr></thead> <tbody><tr><td style="text-align:left;">查看个人信息</td> <td style="text-align:left;">✔</td></tr> <tr><td style="text-align:left;">编辑个人信息</td> <td style="text-align:left;"></td></tr></tbody></table> <h4 id="权限管理"><a href="#权限管理" class="header-anchor">#</a> 权限管理</h4> <table><thead><tr><th style="text-align:left;">角色</th> <th style="text-align:left;">菜单</th></tr></thead> <tbody><tr><td style="text-align:left;">超级管理员</td> <td style="text-align:left;">所有菜单权限</td></tr> <tr><td style="text-align:left;">运营人员</td> <td style="text-align:left;">首页、用户、促销、运营、内容</td></tr></tbody></table> <table><thead><tr><th style="text-align:left;">功能</th> <th style="text-align:left;">说明</th> <th style="text-align:left;">完成</th></tr></thead> <tbody><tr><td style="text-align:left;">权限管理</td> <td style="text-align:left;">添加权限、删除权限、修改权限、以树形结构返回权限</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;">角色管理</td> <td style="text-align:left;">添加角色、删除角色、更新角色、角色列表、获取角色权限、修改角色权限</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;">成员管理</td> <td style="text-align:left;">CRUD、为成员分配角色、获取成员角色、权限分配、获取权限列表</td> <td style="text-align:left;"></td></tr></tbody></table> <h3 id="前台功能清单"><a href="#前台功能清单" class="header-anchor">#</a> 前台功能清单</h3> <table><thead><tr><th style="text-align:left;">功能</th> <th style="text-align:left;">完成</th></tr></thead> <tbody><tr><td style="text-align:left;">用户注册</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;">用户登录</td> <td style="text-align:left;">✔</td></tr> <tr><td style="text-align:left;">获取 Token</td> <td style="text-align:left;">✔</td></tr> <tr><td style="text-align:left;">刷新 Token</td> <td style="text-align:left;"></td></tr></tbody></table> <h3 id="基础设施规划"><a href="#基础设施规划" class="header-anchor">#</a> 基础设施规划</h3> <h4 id="docker"><a href="#docker" class="header-anchor">#</a> Docker</h4> <table><thead><tr><th style="text-align:left;">服务</th> <th style="text-align:left;">主机名</th> <th style="text-align:left;">IP/端口</th> <th style="text-align:left;">CPU/MEM</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">GitLab</td> <td style="text-align:left;">docker-gitlab</td> <td style="text-align:left;">192.168.141.200:80</td> <td style="text-align:left;">2 核 2G</td> <td style="text-align:left;">代码管理</td></tr> <tr><td style="text-align:left;">Nexus</td> <td style="text-align:left;">docker-nexus</td> <td style="text-align:left;">192.168.141.201:80</td> <td style="text-align:left;">2 核 2G</td> <td style="text-align:left;">依赖管理</td></tr> <tr><td style="text-align:left;">Harbor</td> <td style="text-align:left;">docker-harbor</td> <td style="text-align:left;">192.168.141.202:80</td> <td style="text-align:left;">2 核 2G</td> <td style="text-align:left;">镜像管理</td></tr> <tr><td style="text-align:left;">ZenTao</td> <td style="text-align:left;">docker-zentao</td> <td style="text-align:left;">192.168.141.203:80</td> <td style="text-align:left;">2 核 2G</td> <td style="text-align:left;">项目管理</td></tr></tbody></table> <h4 id="kubernetes"><a href="#kubernetes" class="header-anchor">#</a> Kubernetes</h4> <table><thead><tr><th style="text-align:left;">主机名</th> <th style="text-align:left;">IP</th> <th style="text-align:left;">角色</th> <th style="text-align:left;">CPU/MEM</th> <th style="text-align:left;">磁盘</th></tr></thead> <tbody><tr><td style="text-align:left;">kubernetes-master</td> <td style="text-align:left;">192.168.141.110</td> <td style="text-align:left;">Master</td> <td style="text-align:left;">2 核 2G</td> <td style="text-align:left;">20G</td></tr> <tr><td style="text-align:left;">kubernetes-node-01</td> <td style="text-align:left;">192.168.141.120</td> <td style="text-align:left;">Node</td> <td style="text-align:left;">2 核 4G</td> <td style="text-align:left;">20G</td></tr> <tr><td style="text-align:left;">kubernetes-node-02</td> <td style="text-align:left;">192.168.141.121</td> <td style="text-align:left;">Node</td> <td style="text-align:left;">2 核 4G</td> <td style="text-align:left;">20G</td></tr> <tr><td style="text-align:left;">kubernetes-node-03</td> <td style="text-align:left;">192.168.141.122</td> <td style="text-align:left;">Node</td> <td style="text-align:left;">2 核 4G</td> <td style="text-align:left;">20G</td></tr> <tr><td style="text-align:left;">kubernetes-volumes</td> <td style="text-align:left;">192.168.141.130</td> <td style="text-align:left;">NFS</td> <td style="text-align:left;">2 核 2G</td> <td style="text-align:left;">按需扩容</td></tr></tbody></table> <h3 id="容器部署配置"><a href="#容器部署配置" class="header-anchor">#</a> 容器部署配置</h3> <h4 id="gitlab"><a href="#gitlab" class="header-anchor">#</a> GItLab</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: '3'
services:
    web:
      image: 'twang2218/gitlab-ce-zh'
      restart: always
      hostname: '192.168.141.200'
      environment:
        TZ: 'Asia/Shanghai'
        GITLAB_OMNIBUS_CONFIG: |
          external_url 'http://192.168.141.200'
          gitlab_rails['gitlab_shell_ssh_port'] = 2222
          unicorn['port'] = 8888
          nginx['listen_port'] = 80
      ports:
        - '80:80'
        - '443:443'
        - '2222:22'
      volumes:
        - ./config:/etc/gitlab
        - ./data:/var/opt/gitlab
        - ./logs:/var/log/gitlab
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h4 id="nexus"><a href="#nexus" class="header-anchor">#</a> Nexus</h4> <ul><li><strong>账号：</strong> admin</li> <li><strong>密码：</strong> <code>cat /var/lib/docker/volumes/nexus_data/_data/admin.password</code></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: '3.1'
services:
  nexus:
    restart: always
    image: sonatype/nexus3
    container_name: nexus
    ports:
      - 80:8081
    volumes:
      - data:/nexus-data
volumes:
  data:
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="harbor"><a href="#harbor" class="header-anchor">#</a> Harbor</h4> <p><a href="http://www.qfdmy.com/wp-content/themes/quanbaike/go.php?url=aHR0cHM6Ly9naXRodWIuY29tL2dvaGFyYm9yL2hhcmJvcg==" target="_blank" rel="noopener noreferrer">官方 GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 上下载最新离线安装版（我已经下载并放置在群分享的 <strong>Linux</strong> 目录下）并上传至服务器</p> <ul><li><strong>账号：</strong> admin</li> <li><strong>密码：</strong> Harbor12345</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># 解压
tar -zxvf harbor-offline-installer-v1.8.0.tgz
# 修改
cd harbor
vi harbor.yml
hostname: 192.168.141.202
# 安装
./install.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="禅道"><a href="#禅道" class="header-anchor">#</a> 禅道</h4> <ul><li>禅道开源版：<a href="http://www.qfdmy.com/wp-content/themes/quanbaike/go.php?url=aHR0cDovL2RsLmNuZXpzb2Z0LmNvbS96ZW50YW8vZG9ja2VyL2RvY2tlcl96ZW50YW8uemlw" target="_blank" rel="noopener noreferrer">http://dl.cnezsoft.com/zentao/docker/docker_zentao.zip<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>下载并解压后将目录名修改为 <code>build</code>，再通过 Compose 构建</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: '3.1'
services:
  zendao:
    build: build
    restart: always
    container_name: zendao
    environment:
      MYSQL_ROOT_PASSWORD: 123456
    ports:
      - 80:80
    volumes:
      - ./app:/app/zentaopms
      - ./data:/var/lib/mysql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="myshopplus-helm"><a href="#myshopplus-helm" class="header-anchor">#</a> MyShopPlus Helm</h2> <h3 id="概述-2"><a href="#概述-2" class="header-anchor">#</a> 概述</h3> <p>Helm 是 Kubernetes 生态系统中的一个软件包管理工具。</p> <p><a href="https://github.com/helm/helm" target="_blank" rel="noopener noreferrer">官方 GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="kubernetes-的应用部署"><a href="#kubernetes-的应用部署" class="header-anchor">#</a> Kubernetes 的应用部署</h3> <p>Kubernetes 是一个提供了基于容器的应用集群管理解决方案，Kubernetes 为容器化应用提供了部署运行、资源调度、服务发现和动态伸缩等一系列完整功能。</p> <p>Kubernetes 的核心设计理念是：用户定义要部署的应用程序的规则，而 Kubernetes 则负责按照定义的规则部署并运行应用程序。如果应用程序出现问题导致偏离了定义的规格，Kubernetes 负责对其进行自动修正。例如：定义的应用规则要求部署两个实例（Pod），其中一个实例异常终止了，Kubernetes 会检查到并重新启动一个新的实例。</p> <p>用户通过使用 Kubernetes API 对象来描述应用程序规则，包括 <strong>Pod</strong>、<strong>Service</strong>、<strong>Volume</strong>、<strong>Namespace</strong>、<strong>ReplicaSet</strong>、<strong>Deployment</strong>、<strong>Job</strong> 等等。一般这些资源对象的定义需要写入一系列的 YAML 文件中，然后通过 Kubernetes 命令行工具 Kubectl 调 Kubernetes API 进行部署。</p> <p>以一个典型的三层应用 WordPress 为例，该应用程序就涉及到多个 Kubernetes API 对象，而要描述这些 Kubernetes API 对象就可能要同时维护多个 YAML 文件。</p> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/f9b5071a354ac72.png" alt="img"></p> <p>从上图可以看到，在进行 Kubernetes 软件部署时，我们面临下述几个问题（Helm 的出现就是为了很好地解决下面这些问题）：</p> <ul><li>如何管理、编辑和更新这些这些分散的 Kubernetes 应用配置文件。</li> <li>如何把一套相关的配置文件作为一个应用进行管理。</li> <li>如何分发和重用 Kubernetes 的应用配置。</li></ul> <h3 id="什么是-helm"><a href="#什么是-helm" class="header-anchor">#</a> 什么是 Helm</h3> <p>Helm 是 Deis 开发的一个用于 Kubernetes 应用的包管理工具，主要用来管理 Charts。<strong>有点类似于 Ubuntu 中的 APT 或 CentOS 中的 YUM</strong>。</p> <p>Helm Chart 是用来封装 Kubernetes 原生应用程序的一系列 YAML 文件。可以在你部署应用的时候自定义应用程序的一些 Metadata，以便于应用程序的分发。</p> <p>对于应用发布者而言，可以通过 Helm 打包应用、管理应用依赖关系、管理应用版本并发布应用到软件仓库。</p> <p>对于使用者而言，使用 Helm 后不用需要编写复杂的应用部署文件，<strong>可以以简单的方式在 Kubernetes 上查找、安装、升级、回滚、卸载应用程序</strong>。</p> <h3 id="组件及相关术语"><a href="#组件及相关术语" class="header-anchor">#</a> 组件及相关术语</h3> <ul><li><strong>Helm：</strong> 是一个命令行下的客户端工具。主要用于 Kubernetes 应用程序 Chart 的创建、打包、发布以及创建和管理本地和远程的 Chart 仓库</li> <li><strong>Tiller：</strong> 是 Helm 的服务端，部署在 Kubernetes 集群中。Tiller 用于接收 Helm 的请求，并根据 Chart 生成 Kubernetes 的部署文件（ Helm 称为 Release ），然后提交给 Kubernetes 创建应用。Tiller 还提供了 Release 的升级、删除、回滚等一系列功能</li> <li><strong>Chart：</strong> Helm 的软件包，采用 TAR 格式。类似于 APT 的 DEB 包或者 YUM 的 RPM 包，其包含了一组定义 Kubernetes 资源相关的 YAML 文件</li> <li><strong>Repoistory：</strong> Helm 的软件仓库，Repository 本质上是一个 Web 服务器，该服务器保存了一系列的 Chart 软件包以供用户下载，并且提供了一个该 Repository 的 Chart 包的清单文件以供查询。Helm 可以同时管理多个不同的 Repository</li> <li><strong>Release：</strong> 使用 <code>helm install</code> 命令在 Kubernetes 集群中部署的 Chart 称为 Release</li></ul> <blockquote><p><strong>注意：</strong> Helm 中提到的 Release 和我们通常概念中的版本有所不同，这里的 Release 可以理解为 Helm 使用 Chart 包部署的一个应用实例。</p></blockquote> <h3 id="工作原理"><a href="#工作原理" class="header-anchor">#</a> 工作原理</h3> <p>下图描述了 Helm 的几个关键组件 Helm（客户端）、Tiller（服务器）、Repository（Chart 软件仓库）、Chart（软件包）之间的关系。</p> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/ba9170e64b57e7d.png" alt="img"></p> <h4 id="chart-install-安装过程"><a href="#chart-install-安装过程" class="header-anchor">#</a> Chart Install 安装过程</h4> <ul><li>Helm 从指定的目录或者 TAR 文件中解析出 Chart 结构信息</li> <li>Helm 将指定的 Chart 结构和 Values 信息通过 gRPC 传递给 Tiller</li> <li>Tiller 根据 Chart 和 Values 生成一个 Release</li> <li>Tiller 将 Release 发送给 Kubernetes 用于生成 Release</li></ul> <h4 id="chart-update-更新过程"><a href="#chart-update-更新过程" class="header-anchor">#</a> Chart Update 更新过程</h4> <ul><li>Helm 从指定的目录或者 TAR 文件中解析出 Chart 结构信息</li> <li>Helm 将需要更新的 Release 的名称、Chart 结构和 Values 信息传递给 Tiller</li> <li>Tiller 生成 Release 并更新指定名称的 Release 的 History</li> <li>Tiller 将 Release 发送给 Kubernetes 用于更新 Release</li></ul> <h4 id="chart-rollback-回滚过程"><a href="#chart-rollback-回滚过程" class="header-anchor">#</a> Chart Rollback 回滚过程</h4> <ul><li>Helm 将要回滚的 Release 的名称传递给 Tiller</li> <li>Tiller 根据 Release 的名称查找 History</li> <li>Tiller 从 History 中获取上一个 Release</li> <li>Tiller 将上一个 Release 发送给 Kubernetes 用于替换当前 Release</li></ul> <h4 id="chart-处理依赖"><a href="#chart-处理依赖" class="header-anchor">#</a> Chart 处理依赖</h4> <p>Tiller 在处理 Chart 时，直接将 Chart 以及其依赖的所有 Charts 合并为一个 Release，同时传递给 Kubernetes。因此 Tiller 并不负责管理依赖之间的启动顺序。Chart 中的应用需要能够自行处理依赖关系。</p> <h3 id="安装-helm"><a href="#安装-helm" class="header-anchor">#</a> 安装 Helm</h3> <h4 id="安装客户端-helm"><a href="#安装客户端-helm" class="header-anchor">#</a> 安装客户端 Helm</h4> <p>Helm 的安装方式很多，这里采用二进制的方式安装。更多安装方法可以参考 Helm 的 <a href="http://www.qfdmy.com/wp-content/themes/quanbaike/go.php?url=aHR0cHM6Ly9kb2NzLmhlbG0uc2gvdXNpbmdfaGVsbS8jaW5zdGFsbGluZy1oZWxt" target="_blank" rel="noopener noreferrer">官方帮助文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 下载
wget https://get.helm.sh/helm-v2.14.3-linux-amd64.tar.gz
# 解压
tar -zxvf helm-v2.14.3-linux-amd64.tar.gz
# 复制客户端执行文件到 bin 目录下
cp linux-amd64/helm /usr/local/bin/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="安装服务端-tiller"><a href="#安装服务端-tiller" class="header-anchor">#</a> 安装服务端 Tiller</h4> <p>Tiller 是以 Deployment 方式部署在 Kubernetes 集群中的，只需使用以下指令便可简单的完成安装</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 该语句已废弃
helm init --upgrade --tiller-image registry.cn-hangzhou.aliyuncs.com/google_containers/tiller:v2.14.3 --stable-repo-url https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts
# 由于阿里云的 Helm Repo 已经不再更新，我们使用微软提供的 Helm 源
helm init --upgrade --tiller-image registry.cn-hangzhou.aliyuncs.com/google_containers/tiller:v2.15.1 --stable-repo-url http://mirror.azure.cn/kubernetes/charts/
# 注意：如果你使用的是 Kubernetes v1.16.x 版本的话，tiller 2.15 之前的版本是不兼容的
# 解决方案原文地址：https://github.com/helm/helm/issues/6374
helm init --upgrade --tiller-image registry.cn-hangzhou.aliyuncs.com/google_containers/tiller:v2.14.3 --stable-repo-url http://mirror.azure.cn/kubernetes/charts/ --service-account tiller --override spec.selector.matchLabels.'name'='tiller',spec.selector.matchLabels.'app'='helm' --output yaml | sed 's@apiVersion: extensions/v1beta1@apiVersion: apps/v1@' | kubectl apply -f -
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="给-tiller-授权"><a href="#给-tiller-授权" class="header-anchor">#</a> 给 Tiller 授权</h4> <p>Helm 的服务端 Tiller 是一个部署在 Kubernetes 中 <code>Kube-system</code> Namespace 下的 Deployment，它会去连接 <code>kube-api</code> 在 Kubernetes 里创建和删除应用。</p> <p>从 Kubernetes 1.6 版本开始，API Server 启用了 RBAC 授权。目前的 Tiller 部署时默认没有定义授权的 ServiceAccount，这会导致访问 API Server 时被拒绝。所以我们需要明确为 Tiller 部署添加授权</p> <ul><li>创建一个名为 <code>tiller-adminuser.yaml</code> 的配置文件，为 Tiller 创建服务帐号和绑定角色</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>apiVersion: v1
kind: ServiceAccount
metadata:
  name: tiller
  namespace: kube-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: tiller-cluster-rule
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
- kind: ServiceAccount
  name: tiller
  namespace: kube-system
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl apply -f tiller-adminuser.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>为 Tiller 设置帐号</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># 使用 kubectl patch 更新 API 对象
kubectl patch deploy --namespace kube-system tiller-deploy -p '{&quot;spec&quot;:{&quot;template&quot;:{&quot;spec&quot;:{&quot;serviceAccount&quot;:&quot;tiller&quot;}}}}'
# 输出如下
deployment.extensions/tiller-deploy patched
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>查看是否授权成功</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get deploy --namespace kube-system tiller-deploy --output yaml|grep  serviceAccount
# 输出如下
serviceAccount: tiller
serviceAccountName: tiller
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="验证安装是否成功"><a href="#验证安装是否成功" class="header-anchor">#</a> 验证安装是否成功</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl -n kube-system get pods|grep tiller
# 输出如下
tiller-deploy-6d74cd8c9d-v6zg4              1/1     Running   0          10m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>helm version
# 输出如下
Client: &amp;version.Version{SemVer:&quot;v2.11.0&quot;, GitCommit:&quot;2e55dbe1fdb5fdb96b75ff144a339489417b146b&quot;, GitTreeState:&quot;clean&quot;}
Server: &amp;version.Version{SemVer:&quot;v2.11.0&quot;, GitCommit:&quot;2e55dbe1fdb5fdb96b75ff144a339489417b146b&quot;, GitTreeState:&quot;clean&quot;}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="卸载-tiller"><a href="#卸载-tiller" class="header-anchor">#</a> 卸载 Tiller</h3> <p>如果你需要在 Kubernetes 中卸载已部署的 Tiller，可使用以下命令完成卸载</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>helm reset
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="myshopplus-tidb-简介"><a href="#myshopplus-tidb-简介" class="header-anchor">#</a> MyShopPlus TiDB 简介</h2> <h3 id="什么是-tidb"><a href="#什么是-tidb" class="header-anchor">#</a> 什么是 TiDB</h3> <p>TiDB 是 PingCAP 公司受 Google Spanner / F1 论文启发而设计的开源分布式 HTAP (Hybrid Transactional and Analytical Processing) 数据库，结合了传统的 RDBMS 和 NoSQL 的最佳特性。TiDB 兼容 MySQL，支持无限的水平扩展，具备强一致性和高可用性。TiDB 的目标是为 OLTP (Online Transactional Processing) 和 OLAP (Online Analytical Processing) 场景提供一站式的解决方案</p> <p><a href="https://pingcap.com/" target="_blank" rel="noopener noreferrer">TiDB 官方网站<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="核心特点"><a href="#核心特点" class="header-anchor">#</a> 核心特点</h3> <h4 id="高度兼容-mysql"><a href="#高度兼容-mysql" class="header-anchor">#</a> 高度兼容 MySQL</h4> <p>大多数情况下，无需修改代码即可从 MySQL 轻松迁移至 TiDB，分库分表后的 MySQL 集群亦可通过 TiDB 工具进行实时迁移</p> <h4 id="水平弹性扩展"><a href="#水平弹性扩展" class="header-anchor">#</a> 水平弹性扩展</h4> <p>通过简单地增加新节点即可实现 TiDB 的水平扩展，按需扩展吞吐或存储，轻松应对高并发、海量数据场景</p> <h4 id="分布式事务"><a href="#分布式事务" class="header-anchor">#</a> 分布式事务</h4> <p>TiDB 100% 支持标准的 ACID 事务</p> <h4 id="真正金融级高可用"><a href="#真正金融级高可用" class="header-anchor">#</a> 真正金融级高可用</h4> <p>相比于传统主从 (M-S) 复制方案，基于 Raft 的多数派选举协议可以提供金融级的 100% 数据强一致性保证，且在不丢失大多数副本的前提下，可以实现故障的自动恢复 (auto-failover)，无需人工介入</p> <h4 id="一站式-htap-解决方案"><a href="#一站式-htap-解决方案" class="header-anchor">#</a> 一站式 HTAP 解决方案</h4> <p>TiDB 作为典型的 OLTP 行存数据库，同时兼具强大的 OLAP 性能，配合 TiSpark，可提供一站式 HTAP 解决方案，一份存储同时处理 OLTP &amp; OLAP 无需传统繁琐的 ETL 过程</p> <h4 id="云原生-sql-数据库"><a href="#云原生-sql-数据库" class="header-anchor">#</a> 云原生 SQL 数据库</h4> <p>TiDB 是为云而设计的数据库，同 Kubernetes 深度耦合，支持公有云、私有云和混合云，使部署、配置和维护变得十分简单。TiDB 的设计目标是 100% 的 OLTP 场景和 80% 的 OLAP 场景，更复杂的 OLAP 分析可以通过 TiSpark 项目来完成。 TiDB 对业务没有任何侵入性，能优雅的替换传统的数据库中间件、数据库分库分表等 Sharding 方案。同时它也让开发运维人员不用关注数据库 Scale 的细节问题，专注于业务开发，极大的提升研发的生产力</p> <h3 id="整体架构"><a href="#整体架构" class="header-anchor">#</a> 整体架构</h3> <p>要深入了解 TiDB 的水平扩展和高可用特点，首先需要了解 TiDB 的整体架构。TiDB 集群主要包括三个核心组件：TiDB Server，PD Server 和 TiKV Server。此外，还有用于解决用户复杂 OLAP 需求的 TiSpark 组件。</p> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/e2aee990bc0bcb6.png" alt="img"></p> <h4 id="tidb-server"><a href="#tidb-server" class="header-anchor">#</a> TiDB Server</h4> <p>TiDB Server 负责接收 SQL 请求，处理 SQL 相关的逻辑，并通过 PD 找到存储计算所需数据的 TiKV 地址，与 TiKV 交互获取数据，最终返回结果。TiDB Server 是无状态的，其本身并不存储数据，只负责计算，可以无限水平扩展，可以通过负载均衡组件（如 LVS、HAProxy 或 F5）对外提供统一的接入地址。</p> <h4 id="pd-server"><a href="#pd-server" class="header-anchor">#</a> PD Server</h4> <p>Placement Driver (简称 PD) 是整个集群的管理模块，其主要工作有三个：一是存储集群的元信息（某个 Key 存储在哪个 TiKV 节点）；二是对 TiKV 集群进行调度和负载均衡（如数据的迁移、Raft group leader 的迁移等）；三是分配全局唯一且递增的事务 ID。</p> <p>PD 通过 Raft 协议保证数据的安全性。Raft 的 leader server 负责处理所有操作，其余的 PD server 仅用于保证高可用。建议部署奇数个 PD 节点。</p> <h4 id="tikv-server"><a href="#tikv-server" class="header-anchor">#</a> TiKV Server</h4> <p>TiKV Server 负责存储数据，从外部看 TiKV 是一个分布式的提供事务的 Key-Value 存储引擎。存储数据的基本单位是 Region，每个 Region 负责存储一个 Key Range（从 StartKey 到 EndKey 的左闭右开区间）的数据，每个 TiKV 节点会负责多个 Region。TiKV 使用 Raft 协议做复制，保持数据的一致性和容灾。副本以 Region 为单位进行管理，不同节点上的多个 Region 构成一个 Raft Group，互为副本。数据在多个 TiKV 之间的负载均衡由 PD 调度，这里也是以 Region 为单位进行调度。</p> <h4 id="tispark"><a href="#tispark" class="header-anchor">#</a> TiSpark</h4> <p>TiSpark 作为 TiDB 中解决用户复杂 OLAP 需求的主要组件，将 Spark SQL 直接运行在 TiDB 存储层上，同时融合 TiKV 分布式集群的优势，并融入大数据社区生态。至此，TiDB 可以通过一套系统，同时支持 OLTP 与 OLAP，免除用户数据同步的烦恼。</p> <h3 id="技术内幕"><a href="#技术内幕" class="header-anchor">#</a> 技术内幕</h3> <ul><li><a href="http://www.qfdmy.com/wp-content/themes/quanbaike/go.php?url=aHR0cHM6Ly9waW5nY2FwLmNvbS9ibG9nLWNuL3RpZGItaW50ZXJuYWwtMS8=" target="_blank" rel="noopener noreferrer">保存数据<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.qfdmy.com/wp-content/themes/quanbaike/go.php?url=aHR0cHM6Ly9waW5nY2FwLmNvbS9ibG9nLWNuL3RpZGItaW50ZXJuYWwtMi8=" target="_blank" rel="noopener noreferrer">计算-如何做 SQL 运算<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.qfdmy.com/wp-content/themes/quanbaike/go.php?url=aHR0cHM6Ly9waW5nY2FwLmNvbS9ibG9nLWNuL3RpZGItaW50ZXJuYWwtMy8=" target="_blank" rel="noopener noreferrer">调度-TiDB 集群管理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="附：扩展阅读"><a href="#附：扩展阅读" class="header-anchor">#</a> 附：扩展阅读</h3> <h4 id="oltp"><a href="#oltp" class="header-anchor">#</a> OLTP</h4> <ul><li><strong>基本含义：</strong> OLTP(Online Transactional Processing)，OLTP 是传统的关系型数据库的主要应用，主要是基本的、日常的事务处理，记录即时的增、删、改、查，比如在银行存取一笔款，就是一个事务交易</li> <li><strong>实时性：</strong> OLTP 实时性要求高，OLTP 数据库旨在使事务应用程序仅写入所需的数据，以便尽快处理单个事务</li> <li><strong>数据量：</strong> OLTP 数据量不是很大，一般只读 / 写数十条记录，处理简单的事务</li> <li><strong>用户和系统的面向性：</strong> OLTP 是面向顾客的，用于事务和查询处理</li> <li><strong>数据库设计：</strong> OLTP 采用实体 - 联系 ER 模型和面向应用的数据库设计</li></ul> <h4 id="olap"><a href="#olap" class="header-anchor">#</a> OLAP</h4> <ul><li><strong>基本含义：</strong> OLAP(Online Analytical Processing) 即联机分析处理，是数据仓库的核心部心，支持复杂的分析操作，侧重决策支持，并且提供直观易懂的查询结果。典型的应用就是复杂的动态报表系统</li> <li><strong>实时性：</strong> OLAP 的实时性要求不是很高，很多应用顶多是每天更新一下数据</li> <li><strong>数据量：</strong> OLAP 数据量大，因为 OLAP 支持的是动态查询，所以用户也许要通过将很多数据的统计后才能得到想要知道的信息，例如时间序列分析等等，所以处理的数据量很大</li> <li><strong>用户和系统的面向性：</strong> OLAP 是面向市场的，用于数据分析</li> <li><strong>数据库设计：</strong> OLAP 采用星型或雪花模型和面向主题的数据库设计</li></ul> <table><thead><tr><th style="text-align:left;"></th> <th style="text-align:left;">OLTP</th> <th style="text-align:left;">OLAP</th></tr></thead> <tbody><tr><td style="text-align:left;">用户</td> <td style="text-align:left;">操作人员，低层管理人员</td> <td style="text-align:left;">决策人员，高级管理人员</td></tr> <tr><td style="text-align:left;">功能</td> <td style="text-align:left;">日常操作处理</td> <td style="text-align:left;">分析决策</td></tr> <tr><td style="text-align:left;">DB 设计</td> <td style="text-align:left;">面向应用</td> <td style="text-align:left;">面向主题</td></tr> <tr><td style="text-align:left;">数据</td> <td style="text-align:left;">当前的，最新的细节，二维的，分立的</td> <td style="text-align:left;">历史的，聚集的，多维集成的，统一的</td></tr> <tr><td style="text-align:left;">存取</td> <td style="text-align:left;">读/写数十条记录</td> <td style="text-align:left;">读上百万条记录</td></tr> <tr><td style="text-align:left;">工作单位</td> <td style="text-align:left;">简单的事务</td> <td style="text-align:left;">复杂的查询</td></tr> <tr><td style="text-align:left;">用户数</td> <td style="text-align:left;">上千个</td> <td style="text-align:left;">上百个</td></tr> <tr><td style="text-align:left;">DB 大小</td> <td style="text-align:left;">100MB-GB</td> <td style="text-align:left;">100GB-TB</td></tr></tbody></table> <h2 id="myshopplus-tidb-operator"><a href="#myshopplus-tidb-operator" class="header-anchor">#</a> MyShopPlus TiDB Operator</h2> <h3 id="什么是-tidb-operator"><a href="#什么是-tidb-operator" class="header-anchor">#</a> 什么是 TiDB Operator</h3> <p>TiDB Operator 是 TiDB 在 Kubernetes 平台上的自动化部署运维工具。目前，TiDB Operator 已正式开源（<a href="https://github.com/pingcap/tidb-operator/" target="_blank" rel="noopener noreferrer">pingcap/tidb-operator<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）<a href="https://pingcap.com/docs/v3.0/tidb-in-kubernetes/tidb-operator-overview/" target="_blank" rel="noopener noreferrer"> https://pingcap.com/docs/v3.0/tidb-in-kubernetes/tidb-operator-overview/ <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。借助 TiDB Operator，TiDB 可以无缝运行在公有云厂商提供的 Kubernetes 平台上，让 TiDB 成为真正的 Cloud-Native 数据库</p> <h3 id="为什么-tidb-operator"><a href="#为什么-tidb-operator" class="header-anchor">#</a> 为什么 TiDB Operator</h3> <h4 id="运维成本高"><a href="#运维成本高" class="header-anchor">#</a> 运维成本高</h4> <p>使用传统的自动化工具带来了很高的部署和运维成本。TiDB 的分层架构对于分布式系统是比较常见的，各个组件都可以根据业务需求独立水平伸缩，并且 TiKV 和 TiDB 都可以独立使用。比如，在 TiKV 之上可以构建兼容 Redis 协议的 KV 数据库，而 TiDB 也可以对接 LevelDB 这样的 KV 存储引擎。</p> <p>但是，这种多组件的分布式系统增加了手工部署和运维的成本。一些传统的自动化部署和运维工具如 Puppet/Chef/SaltStack/Ansible，由于缺乏全局状态管理，不能及时对各种异常情况做自动故障转移，并且很难发挥分布式系统的弹性伸缩能力。其中有些还需要写大量的 DSL 甚至与 Shell 脚本一起混合使用，可移植性较差，维护成本比较高。</p> <h4 id="为云而生"><a href="#为云而生" class="header-anchor">#</a> 为云而生</h4> <p>在云时代，容器成为应用分发部署的基本单位，而谷歌基于内部使用数十年的容器编排系统 Borg 经验推出的开源容器编排系统 Kubernetes 成为当前容器编排技术事实上的标准。如今各大云厂商都开始提供托管的 Kubernetes 集群，部署在 Kubernetes 平台的应用可以不用绑定在特定云平台，轻松实现在各种云平台之间的迁移，其容器化打包和发布方式也解决了对操作系统环境的依赖。</p> <h4 id="有状态的"><a href="#有状态的" class="header-anchor">#</a> 有状态的</h4> <p>Kubernetes 项目最早期只支持无状态服务（Stateless Service）的管理。无状态服务通过 ReplicationController 定义多个副本，由 Kubernetes 调度器来决定在不同节点上启动多个 Pod，实现负载均衡和故障转移。对于无状态服务，多个副本对应的 Pod 是等价的，所以在节点出现故障时，在新节点上启动一个 Pod 与失效的 Pod 是等价的，不会涉及状态迁移问题，因而管理非常简单。</p> <p>但是对于有状态服务（Stateful Service），由于需要将数据持久化到磁盘，使得不同 Pod 之间不能再认为成等价，也就不能再像无状态服务那样随意进行调度迁移。</p> <p>Kubernetes v1.3 版本提出 PetSet 的概念，用来管理有状态服务并于 v1.5 将其更名为 StatefulSet。StatefulSet 明确定义一组 Pod 中每个的身份，启动和升级都按特定顺序来操作。另外使用持久化卷存储（PersistentVolume）来作为存储数据的载体，当节点失效 Pod 需要迁移时，对应的 PV 也会重新挂载，而 PV 的底层依托于分布式文件系统，所以 Pod 仍然能访问到之前的数据。同时 Pod 在发生迁移时，其网络身份例如 IP 地址是会发生变化的，很多分布式系统不能接受这种情况。所以 StatefulSet 在迁移 Pod 时可以通过绑定域名的方式来保证 Pod 在集群中网络身份不发生变化。</p> <p>但是由于有状态服务的特殊性，当节点出现异常时，出于数据安全性考虑，Kubernetes 并不会像无状态服务那样自动做故障转移。尽管网络存储能挂载到不同的节点上供其上的 Pod 使用，但是如果出现节点故障时，简单粗暴地将网络 PV 挂载到其它节点上是比较危险的。</p> <p>Kubernetes 判断节点故障是基于部署在每个节点上的 Kubelet 服务是否能正常上报节点状态，Kubelet 能否正常工作与用户应用并没有必然联系，在一些特殊情况下，Kubelet 服务进程可能无法正常启动，但是节点上的业务容器还在运行，将 PV 再挂载到其它节点可能会出现双写问题。</p> <p>为了在 Kubernetes 上部署和管理 TiDB 这种有状态的服务，我们需要扩展 StatefulSet 的功能。TiDB Operator 正是基于 Kubernetes 内置的 StatefulSet 开发的 TiDB 集群管理和运维工具。</p> <p>Kubernetes 直到 v1.7 才试验性引入本地 PV，在这之前只有网络 PV，TiKV 自身在存储数据时就是多副本的，网络 PV 的多副本会增加数据冗余，降低 TiDB 的性能。在这之前我们基于 Kubernetes 内置的 hostPath volume 实现了本地 PV 满足 TiKV 对磁盘 IO 的要求。官方本地 PV 方案直到最近的 Kubernetes v1.10 才相对稳定地支持调度功能，满足用户对本地 PV 的需求。为了降低用户的使用和管理成本并且拥抱 Kubernetes 开源社区，我们又重新基于官方的本地 PV 方案实现了对数据的管理。</p> <h3 id="原理解析"><a href="#原理解析" class="header-anchor">#</a> 原理解析</h3> <p>Operator 本质上是 Kubernetes 的控制器（Controller），其核心思想是用户给定一个 Spec 描述文件，Controller 根据 Spec 的变化，在 Kubernetes 集群中创建对应资源，并且不断调整资源使其状态满足用户预期的 Spec。</p> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/77125efaac33d11.png" alt="img"></p> <p>上图是 TiDB Operator 工作流程原理图，其中 TidbCluster 是通过 CRD（Custom Resource Definition）扩展的内置资源类型：</p> <ul><li>用户通过 Helm 往 Kubernetes API Server 创建或更新 TidbCluster 对象</li> <li>TiDB Operator 通过 watch API Server 中的 TidbCluster 对象创建更新或删除，维护 PD/TiKV/TiDB StatefulSet, Service 和 Deployment 对象更新</li> <li>Kubernetes 根据 StatefulSet, Service 和 Deployment 对象创建更新或删除对应的容器和服务</li></ul> <p>在第 2 步中，TiDB Operator 在更新 StatefulSet 等对象时会参考 PD API 给出的集群状态来做出 TiDB 集群的运维处理。通过 TiDB Operator 和 Kubernetes 的动态调度处理，创建出符合用户预期的 TiDB 集群</p> <h3 id="安装-tidb-operator"><a href="#安装-tidb-operator" class="header-anchor">#</a> 安装 TiDB Operator</h3> <p>TiDB Operator 需要运行在 Kubernetes v1.10 及以上版本。TiDB Operator 和 TiDB 集群的部署和管理是通过 Kubernetes 平台上的包管理工具 Helm 实现的。运行 TiDB Operator 前请确保 Helm 已经正确安装在 Kubernetes 集群里</p> <h4 id="要求"><a href="#要求" class="header-anchor">#</a> 要求</h4> <ul><li>Kubernetes v1.10 或更高版本</li> <li>DNS 插件，如 Calico</li> <li>PersistentVolume</li> <li>开启 RBAC (可选)</li> <li>Helm version &gt;= v2.8.2 and &lt; v3.0.0</li></ul> <blockquote><p><strong>注意：</strong> TiDB 可以使用网络卷存储 TiDB 数据，但存在冗余复制操作，导致性能降低。强烈建议设置本地卷获得更好的性能。
<strong>注意：</strong> 网络卷做备份设置需要 Kubernetes v1.12 或更高版本</p></blockquote> <h4 id="克隆项目到本地"><a href="#克隆项目到本地" class="header-anchor">#</a> 克隆项目到本地</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>git clone https://github.com/pingcap/tidb-operator.git
cd tidb-operator
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="部署本地卷"><a href="#部署本地卷" class="header-anchor">#</a> 部署本地卷</h4> <blockquote><p><strong>注意：</strong></p> <ul><li>如果你的 Kubernetes 版本为 1.16.x，请将资源配置中的 DaemonSet 对象的 apiVersion 由 extensions/v1beta1 改为 apps/v1</li> <li>请将资源配置中的 quay.io 源修改为 quay.azk8s.cn，以解决无法下载镜像的问题</li></ul></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl apply -f manifests/local-dind/local-volume-provisioner.yaml
kubectl get po -n kube-system -l app=local-volume-provisioner
kubectl get pv | grep local-storage
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h4> <ul><li>安装 CRD</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl apply -f manifests/crd.yaml
kubectl get crd tidbclusters.pingcap.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>安装完 TidbCluster 后再在 Kubernetes 集群中安装 Operator，</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># 修改 tidb-operator/charts/tidb-operator/values.yaml 配置
kubeSchedulerImageName: registry.aliyuncs.com/google_containers/kube-scheduler
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>helm install charts/tidb-operator --name=tidb-operator --namespace=tidb-admin
kubectl get po -n tidb-admin -l app.kubernetes.io/name=tidb-operator
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="卸载"><a href="#卸载" class="header-anchor">#</a> 卸载</h4> <ul><li>查看 Helm 资源</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>helm ls -a
# 输出如下
NAME            REVISION        UPDATED                         STATUS          CHART                   APP VERSION     NAMESPACE 
tidb-operator   1               Tue Jul 23 07:22:22 2019        DEPLOYED        tidb-operator-dev                       tidb-admin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>卸载 Helm 资源</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>helm delete tidb-operator --purge
# 输出如下
release &quot;tidb-operator&quot; deleted

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="【补充】kubernetes-v1-15-安装-tidb-v1-0-1"><a href="#【补充】kubernetes-v1-15-安装-tidb-v1-0-1" class="header-anchor">#</a> 【补充】Kubernetes v1.15 安装 TiDB v1.0.1</h2> <p>安装 Helm</p> <h3 id="安装客户端-helm-2"><a href="#安装客户端-helm-2" class="header-anchor">#</a> 安装客户端 Helm</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code># 下载
wget https://get.helm.sh/helm-v2.14.3-linux-amd64.tar.gz
# 解压
tar -zxvf helm-v2.14.3-linux-amd64.tar.gz
# 复制客户端执行文件到 bin 目录下
cp linux-amd64/helm /usr/local/bin/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="安装服务端-tiller-2"><a href="#安装服务端-tiller-2" class="header-anchor">#</a> 安装服务端 Tiller</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>helm init --upgrade --tiller-image registry.cn-hangzhou.aliyuncs.com/google_containers/tiller:v2.14.3 --stable-repo-url http://mirror.azure.cn/kubernetes/charts/
# 输出如下
Creating /root/.helm 
Creating /root/.helm/repository 
Creating /root/.helm/repository/cache 
Creating /root/.helm/repository/local 
Creating /root/.helm/plugins 
Creating /root/.helm/starters 
Creating /root/.helm/cache/archive 
Creating /root/.helm/repository/repositories.yaml 
Adding stable repo with URL: http://mirror.azure.cn/kubernetes/charts/ 
Adding local repo with URL: http://127.0.0.1:8879/charts 
$HELM_HOME has been configured at /root/.helm.
Tiller (the Helm server-side component) has been installed into your Kubernetes Cluster.
Please note: by default, Tiller is deployed with an insecure 'allow unauthenticated users' policy.
To prevent this, run `helm init` with the --tiller-tls-verify flag.
For more information on securing your installation see: https://docs.helm.sh/using_helm/#securing-your-helm-installation
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="给-tiller-授权-2"><a href="#给-tiller-授权-2" class="header-anchor">#</a> 给 Tiller 授权</h3> <ul><li>创建一个名为 <code>tiller-adminuser.yaml</code> 的配置文件，为 Tiller 创建服务帐号和绑定角色</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>apiVersion: v1
kind: ServiceAccount
metadata:
  name: tiller
  namespace: kube-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: tiller-cluster-rule
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
- kind: ServiceAccount
  name: tiller
  namespace: kube-system
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl apply -f tiller-adminuser.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>为 Tiller 设置帐号</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl patch deploy --namespace kube-system tiller-deploy -p '{&quot;spec&quot;:{&quot;template&quot;:{&quot;spec&quot;:{&quot;serviceAccount&quot;:&quot;tiller&quot;}}}}'
# 输出如下
deployment.extensions/tiller-deploy patched
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>查看是否授权成功</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get deploy --namespace kube-system tiller-deploy --output yaml|grep  serviceAccount
# 输出如下
serviceAccount: tiller
serviceAccountName: tiller
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="验证安装是否成功-2"><a href="#验证安装是否成功-2" class="header-anchor">#</a> 验证安装是否成功</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl -n kube-system get pods|grep tiller
# 输出如下
tiller-deploy-7c7b67c9fd-w66c5              1/1     Running   3          13h
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>helm version
# 输出如下
Client: &amp;version.Version{SemVer:&quot;v2.14.3&quot;, GitCommit:&quot;0e7f3b6637f7af8fcfddb3d2941fcc7cbebb0085&quot;, GitTreeState:&quot;clean&quot;}
Server: &amp;version.Version{SemVer:&quot;v2.14.3&quot;, GitCommit:&quot;0e7f3b6637f7af8fcfddb3d2941fcc7cbebb0085&quot;, GitTreeState:&quot;clean&quot;}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="安装-pingcap-官方-chart-仓库"><a href="#安装-pingcap-官方-chart-仓库" class="header-anchor">#</a> 安装 PingCap 官方 chart 仓库</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>helm repo add pingcap http://charts.pingcap.org/ &amp;&amp; \
helm repo list &amp;&amp; \
helm repo update &amp;&amp; \
helm search tidb-cluster -l &amp;&amp; \
helm search tidb-operator -l
# 输出如下
NAME    URL                                      
stable  http://mirror.azure.cn/kubernetes/charts/
local   http://127.0.0.1:8879/charts             
pingcap http://charts.pingcap.org/               
Hang tight while we grab the latest from your chart repositories...
...Skip local chart repository
...Successfully got an update from the &quot;pingcap&quot; chart repository
...Successfully got an update from the &quot;stable&quot; chart repository
Update Complete.
NAME                    CHART VERSION   APP VERSION     DESCRIPTION                  
pingcap/tidb-cluster    v1.1.0-alpha.3                  A Helm chart for TiDB Cluster
pingcap/tidb-cluster    v1.1.0-alpha.2                  A Helm chart for TiDB Cluster
pingcap/tidb-cluster    v1.1.0-alpha.1                  A Helm chart for TiDB Cluster
pingcap/tidb-cluster    v1.1.0-alpha.0                  A Helm chart for TiDB Cluster
pingcap/tidb-cluster    v1.0.1                          A Helm chart for TiDB Cluster
pingcap/tidb-cluster    v1.0.0                          A Helm chart for TiDB Cluster
pingcap/tidb-cluster    v1.0.0-rc.1                     A Helm chart for TiDB Cluster
pingcap/tidb-cluster    v1.0.0-beta.3                   A Helm chart for TiDB Cluster
pingcap/tidb-cluster    v1.0.0-beta.2                   A Helm chart for TiDB Cluster
NAME                    CHART VERSION   APP VERSION     DESCRIPTION                            
pingcap/tidb-operator   v1.1.0-alpha.3                  tidb-operator Helm chart for Kubernetes
pingcap/tidb-operator   v1.1.0-alpha.2                  tidb-operator Helm chart for Kubernetes
pingcap/tidb-operator   v1.1.0-alpha.1                  tidb-operator Helm chart for Kubernetes
pingcap/tidb-operator   v1.1.0-alpha.0                  tidb-operator Helm chart for Kubernetes
pingcap/tidb-operator   v1.0.1                          tidb-operator Helm chart for Kubernetes
pingcap/tidb-operator   v1.0.0                          tidb-operator Helm chart for Kubernetes
pingcap/tidb-operator   v1.0.0-rc.1                     tidb-operator Helm chart for Kubernetes
pingcap/tidb-operator   v1.0.0-beta.3                   tidb-operator Helm chart for Kubernetes
pingcap/tidb-operator   v1.0.0-beta.2                   tidb-operator Helm chart for Kubernetes
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="卸载-tiller-2"><a href="#卸载-tiller-2" class="header-anchor">#</a> 卸载 Tiller</h3> <p>如果希望卸载 Tiller ，请使用如下命令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>helm reset
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="配置本地持久化卷"><a href="#配置本地持久化卷" class="header-anchor">#</a> 配置本地持久化卷</h2> <blockquote><p><strong>注意：</strong> 以下步骤需要在所有 Node 节点分别执行</p></blockquote> <h3 id="为虚拟机添加新的磁盘"><a href="#为虚拟机添加新的磁盘" class="header-anchor">#</a> 为虚拟机添加新的磁盘</h3> <h3 id="查看新磁盘"><a href="#查看新磁盘" class="header-anchor">#</a> 查看新磁盘</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>fdisk -l
# 可以看到磁盘路径为 /dev/sdb
Disk /dev/sdb: 40 GiB, 42949672960 bytes, 83886080 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="格式化磁盘"><a href="#格式化磁盘" class="header-anchor">#</a> 格式化磁盘</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo mkfs.ext4 /dev/sdb
# 输出如下
mke2fs 1.44.1 (24-Mar-2018)
Creating filesystem with 10485760 4k blocks and 2621440 inodes
Filesystem UUID: 5ace0751-6870-4115-89d4-91e007d8b055
Superblock backups stored on blocks: 
        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
        4096000, 7962624
Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (65536 blocks): done
Writing superblocks and filesystem accounting information: done
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="挂载磁盘"><a href="#挂载磁盘" class="header-anchor">#</a> 挂载磁盘</h3> <ul><li>挂载 <code>/dev/sdb</code></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>DISK_UUID=$(blkid -s UUID -o value /dev/sdb)
sudo mkdir -p /mnt/$DISK_UUID
sudo mount -t ext4 /dev/sdb /mnt/$DISK_UUID
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>/etc/fstab</code> 持久化 <code>mount</code></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>echo UUID=`sudo blkid -s UUID -o value /dev/sdb` /mnt/$DISK_UUID ext4 defaults 0 2 | sudo tee -a /etc/fstab
# 输出如下
UUID=58759186-ffab-42a3-96ce-f9d3c355d4d1 /mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1 ext4 defaults 0 2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>创建多个目录并 <code>mount</code> 到 <code>discovery directory</code></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>for i in $(seq 1 10); do
  sudo mkdir -p /mnt/${DISK_UUID}/vol${i} /mnt/disks/${DISK_UUID}_vol${i}
  sudo mount --bind /mnt/${DISK_UUID}/vol${i} /mnt/disks/${DISK_UUID}_vol${i}
done
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>/etc/fstab</code> 自动挂载</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>for i in $(seq 1 10); do
  echo /mnt/${DISK_UUID}/vol${i} /mnt/disks/${DISK_UUID}_vol${i} none bind 0 0 | sudo tee -a /etc/fstab
done
# 输出如下
/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol1 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol1 none bind 0 0
/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol2 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol2 none bind 0 0
/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol3 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol3 none bind 0 0
/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol4 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol4 none bind 0 0
/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol5 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol5 none bind 0 0
/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol6 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol6 none bind 0 0
/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol7 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol7 none bind 0 0
/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol8 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol8 none bind 0 0
/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol9 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol9 none bind 0 0
/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol10 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol10 none bind 0 0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="准备本地卷"><a href="#准备本地卷" class="header-anchor">#</a> 准备本地卷</h2> <ul><li>下载并修改配置文件</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># 下载配置文件
wget https://raw.githubusercontent.com/pingcap/tidb-operator/master/manifests/local-dind/local-volume-provisioner.yaml
# 修改配置文件
vi local-volume-provisioner.yaml
## 找到第 41 行，修改 quay.io 为 quay.azk8s.cn
image: &quot;quay.azk8s.cn/external_storage/local-volume-provisioner:v2.3.2&quot;
## 找到第 55 行，修改 quay.io 为 quay.azk8s.cn
value: &quot;quay.azk8s.cn/external_storage/local-volume-provisioner:v2.3.2&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>部署 <code>local-volume-provisioner</code> 程序</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl apply -f local-volume-provisioner.yaml
# 输出如下
storageclass.storage.k8s.io/local-storage created
configmap/local-provisioner-config created
daemonset.extensions/local-volume-provisioner created
serviceaccount/local-storage-admin created
clusterrolebinding.rbac.authorization.k8s.io/local-storage-provisioner-pv-binding created
clusterrole.rbac.authorization.k8s.io/local-storage-provisioner-node-clusterrole created
clusterrolebinding.rbac.authorization.k8s.io/local-storage-provisioner-node-binding created
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>查看 Pod 和 PV 状态</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get po -n kube-system -l app=local-volume-provisioner &amp;&amp; \
kubectl get pv | grep local-storage
# 输出如下
NAME                             READY   STATUS    RESTARTS   AGE
local-volume-provisioner-fjbg4   1/1     Running   0          4m48s
local-volume-provisioner-l4568   1/1     Running   0          4m48s
local-volume-provisioner-vktfx   1/1     Running   0          4m48s
local-pv-1259baaf   39Gi       RWO            Delete           Available           local-storage            41s
local-pv-13b23035   39Gi       RWO            Delete           Available           local-storage            23s
local-pv-18b8b5e1   39Gi       RWO            Delete           Available           local-storage            4m29s
local-pv-251106de   39Gi       RWO            Delete           Available           local-storage            4m29s
local-pv-2b286509   39Gi       RWO            Delete           Available           local-storage            40s
local-pv-2cd32b41   39Gi       RWO            Delete           Available           local-storage            4m29s
local-pv-391470b4   39Gi       RWO            Delete           Available           local-storage            40s
...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="安装-tidb-operator-2"><a href="#安装-tidb-operator-2" class="header-anchor">#</a> 安装 TiDB Operator</h2> <h3 id="安装-crd"><a href="#安装-crd" class="header-anchor">#</a> 安装 CRD</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl apply -f https://raw.githubusercontent.com/pingcap/tidb-operator/master/manifests/crd.yaml &amp;&amp; \
kubectl get crd tidbclusters.pingcap.com
# 输出如下
customresourcedefinition.apiextensions.k8s.io/tidbclusters.pingcap.com created
customresourcedefinition.apiextensions.k8s.io/backups.pingcap.com created
customresourcedefinition.apiextensions.k8s.io/restores.pingcap.com created
customresourcedefinition.apiextensions.k8s.io/backupschedules.pingcap.com created
NAME                       CREATED AT
tidbclusters.pingcap.com   2019-10-12T11:54:24Z
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="获取并修改配置文件"><a href="#获取并修改配置文件" class="header-anchor">#</a> 获取并修改配置文件</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code># 获取配置文件
mkdir -p /usr/local/kubernetes/tidb-operator &amp;&amp; \
helm inspect values pingcap/tidb-operator --version=v1.0.1 &gt; /usr/local/kubernetes/tidb-operator/values-operator.yaml
# 修改配置文件
vi values-operator.yaml
## 找到第 75 行，k8s.gcr.io/kube-scheduler 修改为如下内容
kubeSchedulerImageName: registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="安装-operator"><a href="#安装-operator" class="header-anchor">#</a> 安装 Operator</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>helm install pingcap/tidb-operator --name=tidb-operator --namespace=tidb-admin --version=v1.0.1 -f /usr/local/kubernetes/tidb-operator/values-operator.yaml &amp;&amp; \
kubectl get po -n tidb-admin -l app.kubernetes.io/name=tidb-operator
# 输出如下
NAME:   tidb-operator
LAST DEPLOYED: Sun Oct 13 02:06:29 2019
NAMESPACE: tidb-admin
STATUS: DEPLOYED
RESOURCES:
==&gt; v1/ConfigMap
NAME                   DATA  AGE
tidb-scheduler-policy  1     0s
==&gt; v1/Pod(related)
NAME                                      READY  STATUS             RESTARTS  AGE
tidb-controller-manager-74478968df-tpd9s  0/1    ContainerCreating  0         0s
tidb-scheduler-78c5df4b67-rbb55           0/2    ContainerCreating  0         0s
==&gt; v1/ServiceAccount
NAME                     SECRETS  AGE
tidb-controller-manager  1        0s
tidb-scheduler           1        0s
==&gt; v1beta1/ClusterRole
NAME                                   AGE
tidb-operator:tidb-controller-manager  0s
tidb-operator:tidb-scheduler           0s
==&gt; v1beta1/ClusterRoleBinding
NAME                                   AGE
tidb-operator:tidb-controller-manager  0s
tidb-operator:tidb-scheduler           0s
==&gt; v1beta1/Deployment
NAME                     READY  UP-TO-DATE  AVAILABLE  AGE
tidb-controller-manager  0/1    1           0          0s
tidb-scheduler           0/1    1           0          0s
NOTES:
1. Make sure tidb-operator components are running
   kubectl get pods --namespace tidb-admin -l app.kubernetes.io/instance=tidb-operator
2. Install CRD
   kubectl apply -f https://raw.githubusercontent.com/pingcap/tidb-operator/master/manifests/crd.yaml
   kubectl get customresourcedefinitions
3. Modify tidb-cluster/values.yaml and create a TiDB cluster by installing tidb-cluster charts
   helm install tidb-cluster
NAME                                       READY   STATUS              RESTARTS   AGE
tidb-controller-manager-74478968df-tpd9s   0/1     ContainerCreating   0          0s
tidb-scheduler-78c5df4b67-rbb55            0/2     ContainerCreating   0          0s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h2 id="安装-tidb-cluster"><a href="#安装-tidb-cluster" class="header-anchor">#</a> 安装 TiDB Cluster</h2> <h3 id="获取配置文件"><a href="#获取配置文件" class="header-anchor">#</a> 获取配置文件</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>mkdir -p /usr/local/kubernetes/tidb-operator &amp;&amp; \
helm inspect values pingcap/tidb-cluster --version=v1.0.1 &gt; /usr/local/kubernetes/tidb-operator/values-cluster.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="安装-cluster"><a href="#安装-cluster" class="header-anchor">#</a> 安装 Cluster</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>helm install pingcap/tidb-cluster --name=tidb-cluster --namespace=tidb --version=v1.0.1 -f /usr/local/kubernetes/tidb-operator/values-cluster.yaml
# 输出如下
NAME:   tidb-cluster
LAST DEPLOYED: Sun Oct 13 02:13:27 2019
NAMESPACE: tidb
STATUS: DEPLOYED
RESOURCES:
==&gt; v1/ConfigMap
NAME                        DATA  AGE
tidb-cluster-monitor        3     2s
tidb-cluster-pd-aa6df71f    2     2s
tidb-cluster-tidb           2     2s
tidb-cluster-tidb-a4c4bb14  2     2s
tidb-cluster-tikv-9504381e  2     2s
==&gt; v1/Pod(related)
NAME                                    READY  STATUS             RESTARTS  AGE
tidb-cluster-discovery-d984745c5-cm42t  0/1    ContainerCreating  0         2s
tidb-cluster-monitor-6f67f8b68-v9d9x    0/3    Init:0/1           0         2s
==&gt; v1/Secret
NAME                  TYPE    DATA  AGE
tidb-cluster-monitor  Opaque  2     2s
==&gt; v1/Service
NAME                           TYPE       CLUSTER-IP      EXTERNAL-IP  PORT(S)                         AGE
tidb-cluster-discovery         ClusterIP  10.107.88.145   &lt;none&gt;       10261/TCP                       2s
tidb-cluster-grafana           NodePort   10.101.237.180  &lt;none&gt;       3000:31443/TCP                  2s
tidb-cluster-monitor-reloader  NodePort   10.101.51.196   &lt;none&gt;       9089:31189/TCP                  2s
tidb-cluster-prometheus        NodePort   10.98.26.239    &lt;none&gt;       9090:31440/TCP                  2s
tidb-cluster-tidb              NodePort   10.101.100.241  &lt;none&gt;       4000:32098/TCP,10080:31643/TCP  2s
==&gt; v1/ServiceAccount
NAME                    SECRETS  AGE
tidb-cluster-discovery  1        2s
tidb-cluster-monitor    1        2s
==&gt; v1alpha1/TidbCluster
NAME          AGE
tidb-cluster  2s
==&gt; v1beta1/Deployment
NAME                    READY  UP-TO-DATE  AVAILABLE  AGE
tidb-cluster-discovery  0/1    1           0          2s
tidb-cluster-monitor    0/1    1           0          2s
==&gt; v1beta1/Role
NAME                    AGE
tidb-cluster-discovery  2s
tidb-cluster-monitor    2s
==&gt; v1beta1/RoleBinding
NAME                    AGE
tidb-cluster-discovery  2s
tidb-cluster-monitor    2s
NOTES:
Cluster Startup
1. Watch tidb-cluster up and running
     watch kubectl get pods --namespace tidb -l app.kubernetes.io/instance=tidb-cluster -o wide
2. List services in the tidb-cluster
     kubectl get services --namespace tidb -l app.kubernetes.io/instance=tidb-cluster
Cluster access
* Access tidb-cluster using the MySQL client
    kubectl port-forward -n tidb svc/tidb-cluster-tidb 4000:4000 &amp;
    mysql -h 127.0.0.1 -P 4000 -u root -D test
  Set a password for your user
    SET PASSWORD FOR 'root'@'%' = '9vidP9kW7e'; FLUSH PRIVILEGES;
* View monitor dashboard for TiDB cluster
   kubectl port-forward -n tidb svc/tidb-cluster-grafana 3000:3000
   Open browser at http://localhost:3000. The default username and password is admin/admin.
   If you are running this from a remote machine, you must specify the server's external IP address.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><h3 id="查看-pod-状态"><a href="#查看-pod-状态" class="header-anchor">#</a> 查看 Pod 状态</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get po -n tidb -l app.kubernetes.io/instance=tidb-cluster
# 输出如下
NAME                                     READY   STATUS    RESTARTS   AGE
tidb-cluster-discovery-d984745c5-cm42t   1/1     Running   0          3m9s
tidb-cluster-monitor-6f67f8b68-v9d9x     3/3     Running   0          3m9s
tidb-cluster-pd-0                        1/1     Running   0          3m8s
tidb-cluster-pd-1                        1/1     Running   0          3m8s
tidb-cluster-pd-2                        1/1     Running   1          3m8s
tidb-cluster-tikv-0                      1/1     Running   0          109s
tidb-cluster-tikv-1                      1/1     Running   0          109s
tidb-cluster-tikv-2                      1/1     Running   0          109s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="访问数据库"><a href="#访问数据库" class="header-anchor">#</a> 访问数据库</h2> <p>通过 <code>kubectl port-forward</code> 暴露服务到主机，可以访问 TiDB 集群。命令中的端口格式为：<code>&lt;主机端口&gt;:</code></p> <blockquote><p><strong>注意：</strong></p> <ul><li>如果你不是在本地 PC 而是在远程主机上部署的 DinD 环境，可能无法通过 localhost 访问远程主机的服务。如果使用 <code>kubectl</code> 1.13 或者更高版本，可以在执行 <code>kubectl port-forward</code> 命令时添加 <code>--address 0.0.0.0</code> 选项，在 <code>0.0.0.0</code> 暴露端口而不是默认的 <code>127.0.0.1</code></li> <li>在实际生产环境中数据库是不会暴露到公网的，所以没必要永久映射，映射的目的只是用于调试而已</li></ul></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl port-forward svc/tidb-cluster-tidb 4000:4000 --namespace=tidb --address 0.0.0.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/0cfbf68468c6fc6.png" alt="img"></p> <ul><li>账号：root</li> <li>密码：空</li></ul> <h2 id="【补充】kubernetes-v1-16-安装-tidb-v1-0-x"><a href="#【补充】kubernetes-v1-16-安装-tidb-v1-0-x" class="header-anchor">#</a> 【补充】Kubernetes v1.16 安装 TiDB v1.0.x</h2> <h3 id="概述-3"><a href="#概述-3" class="header-anchor">#</a> 概述</h3> <p>由于 Kubernetes v1.16 版本对部分 API 做了更新和修改，导致无法顺利部署 TiDB v1.0.x 版本到集群，本章节仅作部署流程的参考，个人感觉当前版本在 K8S 上存在些许问题，我们还是等待官方修复吧</p> <h3 id="安装-helm-2"><a href="#安装-helm-2" class="header-anchor">#</a> 安装 Helm</h3> <h4 id="安装客户端-helm-3"><a href="#安装客户端-helm-3" class="header-anchor">#</a> 安装客户端 Helm</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code># 下载
wget https://get.helm.sh/helm-v2.14.3-linux-amd64.tar.gz
# 解压
tar -zxvf helm-v2.14.3-linux-amd64.tar.gz
# 复制客户端执行文件到 bin 目录下
cp linux-amd64/helm /usr/local/bin/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="安装服务端-tiller-3"><a href="#安装服务端-tiller-3" class="header-anchor">#</a> 安装服务端 Tiller</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>helm init --upgrade --tiller-image registry.cn-hangzhou.aliyuncs.com/google_containers/tiller:v2.14.3 --stable-repo-url http://mirror.azure.cn/kubernetes/charts/ --service-account tiller --override spec.selector.matchLabels.'name'='tiller',spec.selector.matchLabels.'app'='helm' --output yaml | sed 's@apiVersion: extensions/v1beta1@apiVersion: apps/v1@' | kubectl apply -f -
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="给-tiller-授权-3"><a href="#给-tiller-授权-3" class="header-anchor">#</a> 给 Tiller 授权</h4> <ul><li>创建一个名为 <code>tiller-adminuser.yaml</code> 的配置文件，为 Tiller 创建服务帐号和绑定角色</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>apiVersion: v1
kind: ServiceAccount
metadata:
  name: tiller
  namespace: kube-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: tiller-cluster-rule
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
- kind: ServiceAccount
  name: tiller
  namespace: kube-system
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl apply -f tiller-adminuser.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>为 Tiller 设置帐号</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl patch deploy --namespace kube-system tiller-deploy -p '{&quot;spec&quot;:{&quot;template&quot;:{&quot;spec&quot;:{&quot;serviceAccount&quot;:&quot;tiller&quot;}}}}'
# 输出如下
deployment.extensions/tiller-deploy patched
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>查看是否授权成功</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get deploy --namespace kube-system tiller-deploy --output yaml|grep  serviceAccount
# 输出如下
serviceAccount: tiller
serviceAccountName: tiller
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="验证安装是否成功-3"><a href="#验证安装是否成功-3" class="header-anchor">#</a> 验证安装是否成功</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl -n kube-system get pods|grep tiller
# 输出如下
tiller-deploy-7c7b67c9fd-w66c5              1/1     Running   3          13h
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>helm version
# 输出如下
Client: &amp;version.Version{SemVer:&quot;v2.14.3&quot;, GitCommit:&quot;0e7f3b6637f7af8fcfddb3d2941fcc7cbebb0085&quot;, GitTreeState:&quot;clean&quot;}
Server: &amp;version.Version{SemVer:&quot;v2.14.3&quot;, GitCommit:&quot;0e7f3b6637f7af8fcfddb3d2941fcc7cbebb0085&quot;, GitTreeState:&quot;clean&quot;}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="安装-pingcap-官方-chart-仓库-2"><a href="#安装-pingcap-官方-chart-仓库-2" class="header-anchor">#</a> 安装 PingCap 官方 chart 仓库</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>helm repo add pingcap http://charts.pingcap.org/ &amp;&amp; \
helm repo list &amp;&amp; \
helm repo update &amp;&amp; \
helm search tidb-cluster -l &amp;&amp; \
helm search tidb-operator -l
# 输出如下
NAME    URL                                      
stable  http://mirror.azure.cn/kubernetes/charts/
local   http://127.0.0.1:8879/charts             
pingcap http://charts.pingcap.org/               
Hang tight while we grab the latest from your chart repositories...
...Skip local chart repository
...Successfully got an update from the &quot;pingcap&quot; chart repository
...Successfully got an update from the &quot;stable&quot; chart repository
Update Complete.
NAME                    CHART VERSION   APP VERSION     DESCRIPTION                  
pingcap/tidb-cluster    v1.1.0-alpha.3                  A Helm chart for TiDB Cluster
pingcap/tidb-cluster    v1.1.0-alpha.2                  A Helm chart for TiDB Cluster
pingcap/tidb-cluster    v1.1.0-alpha.1                  A Helm chart for TiDB Cluster
pingcap/tidb-cluster    v1.1.0-alpha.0                  A Helm chart for TiDB Cluster
pingcap/tidb-cluster    v1.0.1                          A Helm chart for TiDB Cluster
pingcap/tidb-cluster    v1.0.0                          A Helm chart for TiDB Cluster
pingcap/tidb-cluster    v1.0.0-rc.1                     A Helm chart for TiDB Cluster
pingcap/tidb-cluster    v1.0.0-beta.3                   A Helm chart for TiDB Cluster
pingcap/tidb-cluster    v1.0.0-beta.2                   A Helm chart for TiDB Cluster
NAME                    CHART VERSION   APP VERSION     DESCRIPTION                            
pingcap/tidb-operator   v1.1.0-alpha.3                  tidb-operator Helm chart for Kubernetes
pingcap/tidb-operator   v1.1.0-alpha.2                  tidb-operator Helm chart for Kubernetes
pingcap/tidb-operator   v1.1.0-alpha.1                  tidb-operator Helm chart for Kubernetes
pingcap/tidb-operator   v1.1.0-alpha.0                  tidb-operator Helm chart for Kubernetes
pingcap/tidb-operator   v1.0.1                          tidb-operator Helm chart for Kubernetes
pingcap/tidb-operator   v1.0.0                          tidb-operator Helm chart for Kubernetes
pingcap/tidb-operator   v1.0.0-rc.1                     tidb-operator Helm chart for Kubernetes
pingcap/tidb-operator   v1.0.0-beta.3                   tidb-operator Helm chart for Kubernetes
pingcap/tidb-operator   v1.0.0-beta.2                   tidb-operator Helm chart for Kubernetes
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h4 id="卸载-tiller-3"><a href="#卸载-tiller-3" class="header-anchor">#</a> 卸载 Tiller</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>helm reset
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="配置本地持久化卷-2"><a href="#配置本地持久化卷-2" class="header-anchor">#</a> 配置本地持久化卷</h3> <blockquote><p><strong>注意：</strong> 以下步骤需要在所有 Node 节点分别执行</p></blockquote> <h4 id="为虚拟机添加新的磁盘-2"><a href="#为虚拟机添加新的磁盘-2" class="header-anchor">#</a> 为虚拟机添加新的磁盘</h4> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/e2a157961caee6b.png" alt="img"></p> <h4 id="查看新磁盘-2"><a href="#查看新磁盘-2" class="header-anchor">#</a> 查看新磁盘</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>fdisk -l
# 可以看到磁盘路径为 /dev/sdb
Disk /dev/sdb: 40 GiB, 42949672960 bytes, 83886080 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="格式化磁盘-2"><a href="#格式化磁盘-2" class="header-anchor">#</a> 格式化磁盘</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo mkfs.ext4 /dev/sdb
# 输出如下
mke2fs 1.44.1 (24-Mar-2018)
Creating filesystem with 10485760 4k blocks and 2621440 inodes
Filesystem UUID: 5ace0751-6870-4115-89d4-91e007d8b055
Superblock backups stored on blocks: 
        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
        4096000, 7962624
Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (65536 blocks): done
Writing superblocks and filesystem accounting information: done
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="挂载磁盘-2"><a href="#挂载磁盘-2" class="header-anchor">#</a> 挂载磁盘</h4> <ul><li>挂载 <code>/dev/sdb</code></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>DISK_UUID=$(blkid -s UUID -o value /dev/sdb)
sudo mkdir -p /mnt/$DISK_UUID
sudo mount -t ext4 /dev/sdb /mnt/$DISK_UUID
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>/etc/fstab</code> 持久化 <code>mount</code></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>echo UUID=`sudo blkid -s UUID -o value /dev/sdb` /mnt/$DISK_UUID ext4 defaults 0 2 | sudo tee -a /etc/fstab
# 输出如下
UUID=58759186-ffab-42a3-96ce-f9d3c355d4d1 /mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1 ext4 defaults 0 2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>创建多个目录并 <code>mount</code> 到 <code>discovery directory</code></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>for i in $(seq 1 10); do
  sudo mkdir -p /mnt/${DISK_UUID}/vol${i} /mnt/disks/${DISK_UUID}_vol${i}
  sudo mount --bind /mnt/${DISK_UUID}/vol${i} /mnt/disks/${DISK_UUID}_vol${i}
done
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>/etc/fstab</code> 自动挂载</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>for i in $(seq 1 10); do
  echo /mnt/${DISK_UUID}/vol${i} /mnt/disks/${DISK_UUID}_vol${i} none bind 0 0 | sudo tee -a /etc/fstab
done
# 输出如下
/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol1 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol1 none bind 0 0
/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol2 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol2 none bind 0 0
/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol3 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol3 none bind 0 0
/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol4 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol4 none bind 0 0
/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol5 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol5 none bind 0 0
/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol6 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol6 none bind 0 0
/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol7 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol7 none bind 0 0
/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol8 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol8 none bind 0 0
/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol9 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol9 none bind 0 0
/mnt/58759186-ffab-42a3-96ce-f9d3c355d4d1/vol10 /mnt/disks/58759186-ffab-42a3-96ce-f9d3c355d4d1_vol10 none bind 0 0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="克隆-tidb-operator-到本地"><a href="#克隆-tidb-operator-到本地" class="header-anchor">#</a> 克隆 TiDB Operator 到本地</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>git clone https://github.com/pingcap/tidb-operator.git
cd tidb-operator
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="准备本地卷-2"><a href="#准备本地卷-2" class="header-anchor">#</a> 准备本地卷</h3> <ul><li>修改本地 PV 配置文件</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>vi manifests/local-dind/local-volume-provisioner.yaml
# 找到第 23 行，修改 apiVersion 为 apps/v1
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: local-volume-provisioner
  namespace: kube-system
  labels:
    app: local-volume-provisioner
# 找到第 41 行，修改 quay.io 为 quay.azk8s.cn
image: &quot;quay.azk8s.cn/external_storage/local-volume-provisioner:v2.3.2&quot;
# 找到第 55 行，修改 quay.io 为 quay.azk8s.cn
value: &quot;quay.azk8s.cn/external_storage/local-volume-provisioner:v2.3.2&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>部署 <code>local-volume-provisioner</code> 程序</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl apply -f manifests/local-dind/local-volume-provisioner.yaml
# 输出如下
serviceaccount/local-storage-admin created
clusterrolebinding.rbac.authorization.k8s.io/local-storage-provisioner-pv-binding created
clusterrole.rbac.authorization.k8s.io/local-storage-provisioner-node-clusterrole created
clusterrolebinding.rbac.authorization.k8s.io/local-storage-provisioner-node-binding created
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>查看 POD 状态</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get po -n kube-system -l app=local-volume-provisioner
# 输出如下
NAME                             READY   STATUS    RESTARTS   AGE
local-volume-provisioner-dkhtd   1/1     Running   0          89s
local-volume-provisioner-gppff   1/1     Running   0          89s
local-volume-provisioner-hs2jl   1/1     Running   0          89s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>查看 PV 状态</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get pv | grep local-storage
# 输出如下
local-pv-3b22445d   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-3e2569c    39Gi       RWO            Delete           Available           local-storage            47m
local-pv-45b107ed   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-4750aca1   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-48c85c14   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-4c5691d8   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-57e90e1a   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-582af376   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-5ae8f15b   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-630f7363   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-648b05e0   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-6660203e   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-6dd84bcd   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-6e81399    39Gi       RWO            Delete           Available           local-storage            47m
local-pv-7a2a55cd   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-7dc1b612   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-80c827fb   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-859c1302   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-9b2c8dd8   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-aa5c20dc   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-adf5f776   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-af5c73b    39Gi       RWO            Delete           Available           local-storage            47m
local-pv-cd7a2cfa   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-d29e01e4   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-d4dd1095   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-d97212ff   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-dbeda53f   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-e91434ff   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-f3e461c5   39Gi       RWO            Delete           Available           local-storage            47m
local-pv-f53e519    39Gi       RWO            Delete           Available           local-storage            47m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="安装-tidb-operator-3"><a href="#安装-tidb-operator-3" class="header-anchor">#</a> 安装 TiDB Operator</h3> <h4 id="安装-crd-2"><a href="#安装-crd-2" class="header-anchor">#</a> 安装 CRD</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl apply -f manifests/crd.yaml &amp;&amp; \
kubectl get crd tidbclusters.pingcap.com
# 输出如下
customresourcedefinition.apiextensions.k8s.io/tidbclusters.pingcap.com created
customresourcedefinition.apiextensions.k8s.io/backups.pingcap.com created
customresourcedefinition.apiextensions.k8s.io/restores.pingcap.com created
customresourcedefinition.apiextensions.k8s.io/backupschedules.pingcap.com created
NAME                       CREATED AT
tidbclusters.pingcap.com   2019-10-12T11:54:24Z
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="修改相关配置文件"><a href="#修改相关配置文件" class="header-anchor">#</a> 修改相关配置文件</h4> <ul><li><code>vi charts/tidb-operator/values.yaml</code></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># 找到第 75 行，k8s.gcr.io/kube-scheduler 修改为如下内容
kubeSchedulerImageName: registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>vi charts/tidb-operator/templates/controller-manager-deployment.yaml</code></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># 修改 apiVersion 为 apps/v1
apiVersion: apps/v1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>vi charts/tidb-operator/templates/scheduler-deployment.yaml</code></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># 修改 apiVersion 为 apps/v1
apiVersion: apps/v1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="安装-operator-2"><a href="#安装-operator-2" class="header-anchor">#</a> 安装 Operator</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>helm install charts/tidb-operator --name=tidb-operator --namespace=tidb-admin --version=v1.0.1 &amp;&amp; \
kubectl get po -n tidb-admin -l app.kubernetes.io/name=tidb-operator
# 输出如下
NAME:   tidb-operator
LAST DEPLOYED: Sat Oct 12 20:23:46 2019
NAMESPACE: tidb-admin
STATUS: DEPLOYED
RESOURCES:
==&gt; v1/ConfigMap
NAME                   DATA  AGE
tidb-scheduler-policy  1     0s
==&gt; v1/Deployment
NAME                     READY  UP-TO-DATE  AVAILABLE  AGE
tidb-controller-manager  0/1    1           0          0s
tidb-scheduler           0/1    1           0          0s
==&gt; v1/Pod(related)
NAME                                      READY  STATUS             RESTARTS  AGE
tidb-controller-manager-8585475787-lnbcw  0/1    ContainerCreating  0         0s
tidb-scheduler-758cbd668c-tk2hv           0/2    ContainerCreating  0         0s
==&gt; v1/ServiceAccount
NAME                     SECRETS  AGE
tidb-controller-manager  1        0s
tidb-scheduler           1        0s
==&gt; v1beta1/ClusterRole
NAME                                   AGE
tidb-operator:tidb-controller-manager  0s
tidb-operator:tidb-scheduler           0s
==&gt; v1beta1/ClusterRoleBinding
NAME                                   AGE
tidb-operator:tidb-controller-manager  0s
tidb-operator:tidb-scheduler           0s
NOTES:
1. Make sure tidb-operator components are running
   kubectl get pods --namespace tidb-admin -l app.kubernetes.io/instance=tidb-operator
2. Install CRD
   kubectl apply -f https://raw.githubusercontent.com/pingcap/tidb-operator/master/manifests/crd.yaml
   kubectl get customresourcedefinitions
3. Modify tidb-cluster/values.yaml and create a TiDB cluster by installing tidb-cluster charts
   helm install tidb-cluster
NAME                                       READY   STATUS              RESTARTS   AGE
tidb-controller-manager-8585475787-lnbcw   0/1     ContainerCreating   0          1s
tidb-scheduler-758cbd668c-tk2hv            0/2     ContainerCreating   0          1s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h3 id="安装-tidb-cluster-2"><a href="#安装-tidb-cluster-2" class="header-anchor">#</a> 安装 TiDB Cluster</h3> <h4 id="修改相关配置文件-2"><a href="#修改相关配置文件-2" class="header-anchor">#</a> 修改相关配置文件</h4> <ul><li><code>vi charts/tidb-cluster/templates/discovery-deployment.yaml</code></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># 修改 apiVersion 为 apps/v1
apiVersion: apps/v1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>vi charts/tidb-cluster/templates/monitor-deployment.yaml</code></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># 修改 apiVersion 为 apps/v1
apiVersion: apps/v1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="安装-cluster-2"><a href="#安装-cluster-2" class="header-anchor">#</a> 安装 Cluster</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>helm install charts/tidb-cluster --name=tidb-cluster --namespace=tidb --version=v1.0.1 &amp;&amp; \
kubectl get po -n tidb -l app.kubernetes.io/instance=tidb-cluster
# 输出如下
NAME:   tidb-cluster
LAST DEPLOYED: Sat Oct 12 20:28:52 2019
NAMESPACE: tidb
STATUS: DEPLOYED
RESOURCES:
==&gt; v1/ConfigMap
NAME                        DATA  AGE
tidb-cluster-monitor        2     1s
tidb-cluster-pd-e7e2884d    2     1s
tidb-cluster-tidb           2     1s
tidb-cluster-tidb-a4c4bb14  2     1s
tidb-cluster-tikv-3ad7c4dd  2     1s
==&gt; v1/Deployment
NAME                    READY  UP-TO-DATE  AVAILABLE  AGE
tidb-cluster-discovery  0/1    1           0          0s
tidb-cluster-monitor    0/1    1           0          0s
==&gt; v1/Pod(related)
NAME                                     READY  STATUS             RESTARTS  AGE
tidb-cluster-discovery-5dc984f8ff-jdx25  0/1    ContainerCreating  0         0s
tidb-cluster-monitor-f9c856fc6-5rdlr     0/3    Init:0/1           0         0s
==&gt; v1/Secret
NAME                  TYPE    DATA  AGE
tidb-cluster-monitor  Opaque  2     1s
==&gt; v1/Service
NAME                           TYPE       CLUSTER-IP      EXTERNAL-IP  PORT(S)                         AGE
tidb-cluster-discovery         ClusterIP  10.108.183.223  &lt;none&gt;       10261/TCP                       1s
tidb-cluster-grafana           NodePort   10.96.88.60     &lt;none&gt;       3000:30415/TCP                  1s
tidb-cluster-monitor-reloader  NodePort   10.101.64.23    &lt;none&gt;       9089:31990/TCP                  1s
tidb-cluster-prometheus        NodePort   10.108.98.8     &lt;none&gt;       9090:32348/TCP                  1s
tidb-cluster-tidb              NodePort   10.103.103.154  &lt;none&gt;       4000:30941/TCP,10080:30070/TCP  1s
==&gt; v1/ServiceAccount
NAME                    SECRETS  AGE
tidb-cluster-discovery  1        1s
tidb-cluster-monitor    1        1s
==&gt; v1alpha1/TidbCluster
NAME          AGE
tidb-cluster  0s
==&gt; v1beta1/Role
NAME                    AGE
tidb-cluster-discovery  1s
tidb-cluster-monitor    1s
==&gt; v1beta1/RoleBinding
NAME                    AGE
tidb-cluster-discovery  1s
tidb-cluster-monitor    1s
NOTES:
Cluster Startup
1. Watch tidb-cluster up and running
     watch kubectl get pods --namespace tidb -l app.kubernetes.io/instance=tidb-cluster -o wide
2. List services in the tidb-cluster
     kubectl get services --namespace tidb -l app.kubernetes.io/instance=tidb-cluster
Cluster access
* Access tidb-cluster using the MySQL client
    kubectl port-forward -n tidb svc/tidb-cluster-tidb 4000:4000 &amp;
    mysql -h 127.0.0.1 -P 4000 -u root -D test
  Set a password for your user
    SET PASSWORD FOR 'root'@'%' = 'LeROGe2FNO'; FLUSH PRIVILEGES;
* View monitor dashboard for TiDB cluster
   kubectl port-forward -n tidb svc/tidb-cluster-grafana 3000:3000
   Open browser at http://localhost:3000. The default username and password is admin/admin.
   If you are running this from a remote machine, you must specify the server's external IP address.
NAME                                      READY   STATUS              RESTARTS   AGE
tidb-cluster-discovery-5dc984f8ff-jdx25   0/1     ContainerCreating   0          0s
tidb-cluster-monitor-f9c856fc6-5rdlr      0/3     Init:0/1            0          0s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><h2 id="myshopplus-创建项目工程"><a href="#myshopplus-创建项目工程" class="header-anchor">#</a> MyShopPlus 创建项目工程</h2> <h3 id="工程-pom"><a href="#工程-pom" class="header-anchor">#</a> 工程 POM</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;modules&gt;
        &lt;module&gt;dependencies&lt;/module&gt;
    &lt;/modules&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.1.6.RELEASE&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;com.rxt.myshop&lt;/groupId&gt;
    &lt;artifactId&gt;parent&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;
    &lt;url&gt;http://smxy.online&lt;/url&gt;

    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
        &lt;maven.compiler.source&gt;${java.version}&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;${java.version}&lt;/maven.compiler.target&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;
    &lt;/properties&gt;
    &lt;licenses&gt;
        &lt;license&gt;
            &lt;name&gt;Apache 2.0&lt;/name&gt;
            &lt;url&gt;https://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt;
        &lt;/license&gt;
    &lt;/licenses&gt;
    &lt;developers&gt;
        &lt;developer&gt;
            &lt;id&gt;Ruan.X.T&lt;/id&gt;
            &lt;name&gt;Liberty&lt;/name&gt;
            &lt;email&gt;958465427@qq.com&lt;/email&gt;
        &lt;/developer&gt;
    &lt;/developers&gt;
    &lt;dependencyManagement&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.rxt.myshop&lt;/groupId&gt;
                &lt;artifactId&gt;dependencies&lt;/artifactId&gt;
                &lt;version&gt;${project.version}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;
    &lt;profiles&gt;
        &lt;profile&gt;
            &lt;id&gt;default&lt;/id&gt;
            &lt;activation&gt;
                &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
            &lt;/activation&gt;
            &lt;properties&gt;
                &lt;spring-javaformat.version&gt;0.0.12&lt;/spring-javaformat.version&gt;
            &lt;/properties&gt;
            &lt;build&gt;
                &lt;plugins&gt;
                    &lt;plugin&gt;
                        &lt;groupId&gt;io.spring.javaformat&lt;/groupId&gt;
                        &lt;artifactId&gt;spring-javaformat-maven-plugin&lt;/artifactId&gt;
                        &lt;version&gt;${spring-javaformat.version}&lt;/version&gt;
                    &lt;/plugin&gt;
                    &lt;plugin&gt;
                        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                        &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
                        &lt;configuration&gt;
                            &lt;includes&gt;
                                &lt;include&gt;**/*Tests.java&lt;/include&gt;
                            &lt;/includes&gt;
                            &lt;excludes&gt;
                                &lt;exclude&gt;**/Abstract*.java&lt;/exclude&gt;
                            &lt;/excludes&gt;
                            &lt;systemPropertyVariables&gt;
                                &lt;java.security.egd&gt;file:/dev/./urandom&lt;/java.security.egd&gt;
                                &lt;java.awt.headless&gt;true&lt;/java.awt.headless&gt;
                            &lt;/systemPropertyVariables&gt;
                        &lt;/configuration&gt;
                    &lt;/plugin&gt;
                    &lt;plugin&gt;
                        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                        &lt;artifactId&gt;maven-enforcer-plugin&lt;/artifactId&gt;
                        &lt;executions&gt;
                            &lt;execution&gt;
                                &lt;id&gt;enforce-rules&lt;/id&gt;
                                &lt;goals&gt;
                                    &lt;goal&gt;enforce&lt;/goal&gt;
                                &lt;/goals&gt;
                                &lt;configuration&gt;
                                    &lt;rules&gt;
                                        &lt;bannedDependencies&gt;
                                            &lt;excludes&gt;
                                                &lt;exclude&gt;commons-logging:*:*&lt;/exclude&gt;
                                            &lt;/excludes&gt;
                                            &lt;searchTransitive&gt;true&lt;/searchTransitive&gt;
                                        &lt;/bannedDependencies&gt;
                                    &lt;/rules&gt;
                                    &lt;fail&gt;true&lt;/fail&gt;
                                &lt;/configuration&gt;
                            &lt;/execution&gt;
                        &lt;/executions&gt;
                    &lt;/plugin&gt;
                    &lt;plugin&gt;
                        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                        &lt;artifactId&gt;maven-install-plugin&lt;/artifactId&gt;
                        &lt;configuration&gt;
                            &lt;skip&gt;true&lt;/skip&gt;
                        &lt;/configuration&gt;
                    &lt;/plugin&gt;
                    &lt;plugin&gt;
                        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                        &lt;artifactId&gt;maven-javadoc-plugin&lt;/artifactId&gt;
                        &lt;configuration&gt;
                            &lt;skip&gt;true&lt;/skip&gt;
                        &lt;/configuration&gt;
                        &lt;inherited&gt;true&lt;/inherited&gt;
                    &lt;/plugin&gt;
                &lt;/plugins&gt;
            &lt;/build&gt;
        &lt;/profile&gt;
    &lt;/profiles&gt;
    &lt;repositories&gt;
        &lt;repository&gt;
            &lt;id&gt;spring-milestone&lt;/id&gt;
            &lt;name&gt;Spring Milestone&lt;/name&gt;
            &lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt;
            &lt;snapshots&gt;
                &lt;enabled&gt;false&lt;/enabled&gt;
            &lt;/snapshots&gt;
        &lt;/repository&gt;
        &lt;repository&gt;
            &lt;id&gt;spring-snapshot&lt;/id&gt;
            &lt;name&gt;Spring Snapshot&lt;/name&gt;
            &lt;url&gt;https://repo.spring.io/snapshot&lt;/url&gt;
            &lt;snapshots&gt;
                &lt;enabled&gt;true&lt;/enabled&gt;
            &lt;/snapshots&gt;
        &lt;/repository&gt;
    &lt;/repositories&gt;
    &lt;pluginRepositories&gt;
        &lt;pluginRepository&gt;
            &lt;id&gt;spring-milestone&lt;/id&gt;
            &lt;name&gt;Spring Milestone&lt;/name&gt;
            &lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt;
            &lt;snapshots&gt;
                &lt;enabled&gt;false&lt;/enabled&gt;
            &lt;/snapshots&gt;
        &lt;/pluginRepository&gt;
        &lt;pluginRepository&gt;
            &lt;id&gt;spring-snapshot&lt;/id&gt;
            &lt;name&gt;Spring Snapshot&lt;/name&gt;
            &lt;url&gt;https://repo.spring.io/snapshot&lt;/url&gt;
            &lt;snapshots&gt;
                &lt;enabled&gt;true&lt;/enabled&gt;
            &lt;/snapshots&gt;
        &lt;/pluginRepository&gt;
    &lt;/pluginRepositories&gt;
&lt;/project&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br></div></div><h3 id="依赖管理-pom"><a href="#依赖管理-pom" class="header-anchor">#</a> 依赖管理 POM</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;com.rxt.myshop&lt;/groupId&gt;
    &lt;artifactId&gt;dependencies&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;
    &lt;url&gt;http://smxy.online&lt;/url&gt;
    &lt;properties&gt;
        &lt;dubbo.version&gt;2.7.2&lt;/dubbo.version&gt;
        &lt;dubbo-kryo.version&gt;2.7.2&lt;/dubbo-kryo.version&gt;
        &lt;dubbo-actuator.version&gt;2.7.1&lt;/dubbo-actuator.version&gt;
        &lt;spring-boot-mapper.version&gt;2.1.5&lt;/spring-boot-mapper.version&gt;
        &lt;spring-cloud.version&gt;Greenwich.RELEASE&lt;/spring-cloud.version&gt;
        &lt;spring-cloud-alibaba.verion&gt;0.9.0.RELEASE&lt;/spring-cloud-alibaba.verion&gt;
        &lt;alibaba-spring-context-support.version&gt;1.0.2&lt;/alibaba-spring-context-support.version&gt;
    &lt;/properties&gt;
    &lt;licenses&gt;
        &lt;license&gt;
            &lt;name&gt;Apache 2.0&lt;/name&gt;
            &lt;url&gt;https://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt;
        &lt;/license&gt;
    &lt;/licenses&gt;
    &lt;developers&gt;
        &lt;developer&gt;
            &lt;id&gt;Ruan.X.T&lt;/id&gt;
            &lt;name&gt;Liberty&lt;/name&gt;
            &lt;email&gt;958465427@qq.com&lt;/email&gt;
        &lt;/developer&gt;
    &lt;/developers&gt;
    &lt;dependencyManagement&gt;
        &lt;dependencies&gt;
            &lt;!-- Spring Cloud --&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
                &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
                &lt;version&gt;${spring-cloud.version}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
                &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt;
                &lt;version&gt;${spring-cloud-alibaba.verion}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
            &lt;!-- Apache Dubbo --&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
                &lt;artifactId&gt;dubbo&lt;/artifactId&gt;
                &lt;version&gt;${dubbo.version}&lt;/version&gt;
                &lt;exclusions&gt;
                    &lt;exclusion&gt;
                        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
                        &lt;artifactId&gt;spring&lt;/artifactId&gt;
                    &lt;/exclusion&gt;
                    &lt;exclusion&gt;
                        &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
                        &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
                    &lt;/exclusion&gt;
                    &lt;exclusion&gt;
                        &lt;groupId&gt;log4j&lt;/groupId&gt;
                        &lt;artifactId&gt;log4j&lt;/artifactId&gt;
                    &lt;/exclusion&gt;
                &lt;/exclusions&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
                &lt;artifactId&gt;dubbo-spring-boot-actuator&lt;/artifactId&gt;
                &lt;version&gt;${dubbo-actuator.version}&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
                &lt;artifactId&gt;dubbo-serialization-kryo&lt;/artifactId&gt;
                &lt;version&gt;${dubbo-kryo.version}&lt;/version&gt;
                &lt;exclusions&gt;
                    &lt;exclusion&gt;
                        &lt;groupId&gt;log4j&lt;/groupId&gt;
                        &lt;artifactId&gt;log4j&lt;/artifactId&gt;
                    &lt;/exclusion&gt;
                    &lt;exclusion&gt;
                        &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
                        &lt;artifactId&gt;dubbo-common&lt;/artifactId&gt;
                    &lt;/exclusion&gt;
                &lt;/exclusions&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.alibaba.spring&lt;/groupId&gt;
                &lt;artifactId&gt;spring-context-support&lt;/artifactId&gt;
                &lt;version&gt;${alibaba-spring-context-support.version}&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;!-- DataSource --&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.zaxxer&lt;/groupId&gt;
                &lt;artifactId&gt;HikariCP&lt;/artifactId&gt;
                &lt;version&gt;${hikaricp.version}&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;
                &lt;exclusions&gt;
                    &lt;!-- 排除 tomcat-jdbc 以使用 HikariCP --&gt;
                    &lt;exclusion&gt;
                        &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;
                        &lt;artifactId&gt;tomcat-jdbc&lt;/artifactId&gt;
                    &lt;/exclusion&gt;
                &lt;/exclusions&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;tk.mybatis&lt;/groupId&gt;
                &lt;artifactId&gt;mapper-spring-boot-starter&lt;/artifactId&gt;
                &lt;version&gt;${spring-boot-mapper.version}&lt;/version&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;
    &lt;repositories&gt;
        &lt;repository&gt;
            &lt;id&gt;spring-milestone&lt;/id&gt;
            &lt;name&gt;Spring Milestone&lt;/name&gt;
            &lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt;
            &lt;snapshots&gt;
                &lt;enabled&gt;false&lt;/enabled&gt;
            &lt;/snapshots&gt;
        &lt;/repository&gt;
        &lt;repository&gt;
            &lt;id&gt;spring-snapshot&lt;/id&gt;
            &lt;name&gt;Spring Snapshot&lt;/name&gt;
            &lt;url&gt;https://repo.spring.io/snapshot&lt;/url&gt;
            &lt;snapshots&gt;
                &lt;enabled&gt;true&lt;/enabled&gt;
            &lt;/snapshots&gt;
        &lt;/repository&gt;
    &lt;/repositories&gt;
    &lt;pluginRepositories&gt;
        &lt;pluginRepository&gt;
            &lt;id&gt;spring-milestone&lt;/id&gt;
            &lt;name&gt;Spring Milestone&lt;/name&gt;
            &lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt;
            &lt;snapshots&gt;
                &lt;enabled&gt;false&lt;/enabled&gt;
            &lt;/snapshots&gt;
        &lt;/pluginRepository&gt;
        &lt;pluginRepository&gt;
            &lt;id&gt;spring-snapshot&lt;/id&gt;
            &lt;name&gt;Spring Snapshot&lt;/name&gt;
            &lt;url&gt;https://repo.spring.io/snapshot&lt;/url&gt;
            &lt;snapshots&gt;
                &lt;enabled&gt;true&lt;/enabled&gt;
            &lt;/snapshots&gt;
        &lt;/pluginRepository&gt;
    &lt;/pluginRepositories&gt;
&lt;/project&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br></div></div><h3 id="初始化数据库"><a href="#初始化数据库" class="header-anchor">#</a> 初始化数据库</h3> <p>略...</p> <h2 id="myshopplus-部署注册中心"><a href="#myshopplus-部署注册中心" class="header-anchor">#</a> MyShopPlus 部署注册中心</h2> <h3 id="准备-nfs"><a href="#准备-nfs" class="header-anchor">#</a> 准备 NFS</h3> <blockquote><p><strong>注意：</strong> 以下步骤需要在 NFS 服务端操作</p></blockquote> <ul><li>创建 Nacos 所需共享目录</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>mkdir -p /data/nfs-share
mkdir -p /data/mysql-master
mkdir -p /data/mysql-slave
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>给目录增加读写权限</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>chmod a+rw /data/nfs-share
chmod a+rw /data/mysql-master
chmod a+rw /data/mysql-slave
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>配置 NFS 服务目录</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>vi /etc/exports
# 底部增加
/data/nfs-share *(rw,sync,no_subtree_check,no_root_squash)
/data/mysql-master *(rw,sync,no_subtree_check,no_root_squash)
/data/mysql-slave *(rw,sync,no_subtree_check,no_root_squash)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>重启服务，使配置生效</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>/etc/init.d/nfs-kernel-server restart
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="克隆-nacos"><a href="#克隆-nacos" class="header-anchor">#</a> 克隆 Nacos</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>git clone https://github.com/nacos-group/nacos-k8s.git
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="部署-nfs"><a href="#部署-nfs" class="header-anchor">#</a> 部署 NFS</h3> <ul><li>创建角色</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl create -f deploy/nfs/rbac.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>创建 <code>ServiceAccount</code> 和部署 <code>NFS-Client Provisioner</code></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>vi deploy/nfs/deployment.yaml
# 进行如下修改
apiVersion: v1
kind: ServiceAccount
metadata:
  name: nfs-client-provisioner
---
kind: Deployment
apiVersion: extensions/v1beta1
metadata:
  name: nfs-client-provisioner
spec:
  replicas: 1
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: nfs-client-provisioner
    spec:
      serviceAccount: nfs-client-provisioner
      containers:
      - name: nfs-client-provisioner
        image: quay.io/external_storage/nfs-client-provisioner:latest
        volumeMounts:
        - name: nfs-client-root
          mountPath: /persistentvolumes
        env:
        - name: PROVISIONER_NAME
          value: fuseim.pri/ifs
        - name: NFS_SERVER
          # 修改为 NFS 服务端 IP
          value: 192.168.141.130
        - name: NFS_PATH
          # 修改为 NFS 服务端共享目录
          value: /data/nfs-share
      volumes:
      - name: nfs-client-root
        nfs:
          # 修改为 NFS 服务端 IP
          server: 192.168.141.130
          # 修改为 NFS 服务端共享目录
          path: /data/nfs-share
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl create -f deploy/nfs/deployment.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>创建 <code>NFS StorageClass</code></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl create -f deploy/nfs/class.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>验证 NFS 部署成功</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get pod -l app=nfs-client-provisioner
# 输出如下
NAME                                      READY   STATUS    RESTARTS   AGE
nfs-client-provisioner-5f9f96c4dc-mrzr6   1/1     Running   0          177m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="部署数据库"><a href="#部署数据库" class="header-anchor">#</a> 部署数据库</h3> <ul><li>部署主库</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>vi deploy/mysql/mysql-master-nfs.yaml
# 进行如下修改
apiVersion: v1
kind: ReplicationController
metadata:
  name: mysql-master
  labels:
    name: mysql-master
spec:
  replicas: 1
  selector:
    name: mysql-master
  template:
    metadata:
      labels:
        name: mysql-master
    spec:
      containers:
      - name: master
        image: nacos/nacos-mysql-master:latest
        ports:
        - containerPort: 3306
        volumeMounts:
        - name: mysql-master-data
          mountPath: /var/lib/mysql
        env:
        - name: MYSQL_ROOT_PASSWORD
          value: &quot;root&quot;
        - name: MYSQL_DATABASE
          value: &quot;nacos_devtest&quot;
        - name: MYSQL_USER
          value: &quot;nacos&quot;
        - name: MYSQL_PASSWORD
          value: &quot;nacos&quot;
        - name: MYSQL_REPLICATION_USER
          value: 'nacos_ru'
        - name: MYSQL_REPLICATION_PASSWORD
          value: 'nacos_ru'
      volumes:
      - name: mysql-master-data
        nfs:
          # 修改为 NFS 服务端 IP
          server: 192.168.141.130
          # 修改为 NFS 服务端共享目录
          path: /data/mysql-master
---
apiVersion: v1
kind: Service
metadata:
  name: mysql-master
  labels:
    name: mysql-master
spec:
  ports:
  - port: 3306
    targetPort: 3306
  selector:
    name: mysql-master
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl create -f deploy/mysql/mysql-master-nfs.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>部署从库</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>vi deploy/mysql/mysql-slave-nfs.yaml
# 进行如下修改
apiVersion: v1
kind: ReplicationController
metadata:
  name: mysql-slave
  labels:
    name: mysql-slave
spec:
  replicas: 1
  selector:
    name: mysql-slave
  template:
    metadata:
      labels:
        name: mysql-slave
    spec:
      containers:
      - name: slave
        image: nacos/nacos-mysql-slave:latest
        ports:
        - containerPort: 3306
        volumeMounts:
        - name: mysql-slave-data
          mountPath: /var/lib/mysql
        env:
        - name: MYSQL_ROOT_PASSWORD
          value: &quot;root&quot;
        - name: MYSQL_REPLICATION_USER
          value: 'nacos_ru'
        - name: MYSQL_REPLICATION_PASSWORD
          value: 'nacos_ru'
      volumes:
      - name: mysql-slave-data
        nfs:
          # 修改为 NFS 服务端 IP
          server: 192.168.141.130
          # 修改为 NFS 服务端共享目录
          path: /data/mysql-slave
---
apiVersion: v1
kind: Service
metadata:
  name: mysql-slave
  labels:
    name: mysql-slave
spec:
  ports:
  - port: 3306
    targetPort: 3306
  selector:
    name: mysql-slave
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl create -f deploy/mysql/mysql-slave-nfs.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>验证数据库是否正常工作</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get pod
# 输出如下
NAME                                      READY   STATUS    RESTARTS   AGE
mysql-master-82tk4                        1/1     Running   1          176m
mysql-slave-2pbkk                         1/1     Running   0          174m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="部署-nacos"><a href="#部署-nacos" class="header-anchor">#</a> 部署 Nacos</h3> <ul><li>创建 Nacos</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl create -f deploy/nacos/nacos-pvc-nfs.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>验证 Nacos 节点启动成功</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get pod -l app=nacos
# 输出如下
NAME      READY   STATUS    RESTARTS   AGE
nacos-0   1/1     Running   0          174m
nacos-1   1/1     Running   0          171m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="路由-nacos"><a href="#路由-nacos" class="header-anchor">#</a> 路由 Nacos</h3> <ul><li>创建一个名为 <code>nacos.yml</code> 的 Ingress 配置文件</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  name: nacos-web
  annotations:
    kubernetes.io/ingress.class: &quot;nginx&quot;
    nginx.ingress.kubernetes.io/use-regex: &quot;true&quot;
    nginx.ingress.kubernetes.io/proxy-connect-timeout: &quot;600&quot;
    nginx.ingress.kubernetes.io/proxy-send-timeout: &quot;600&quot;
    nginx.ingress.kubernetes.io/proxy-read-timeout: &quot;600&quot;
    nginx.ingress.kubernetes.io/proxy-body-size: &quot;10m&quot;
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
  - host: nacos.funtl.com
    http:
      paths:
      - path:
        backend:
          serviceName: nacos-headless
          servicePort: 8848
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><ul><li>部署 Ingress</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl apply -f nacos.yml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>验证是否成功（<strong>别忘记修改 Hosts</strong>）</li></ul> <p>打开浏览器访问 <a href="http://nacos.rxt.com/nacos/#/login" target="_blank" rel="noopener noreferrer">http://nacos.rxt.com/nacos/#/login<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/39abd4513b986b5.png" alt="img"></p> <h3 id="扩容选举-leader"><a href="#扩容选举-leader" class="header-anchor">#</a> 扩容选举 Leader</h3> <blockquote><p><strong>注意：</strong> StatefulSet 控制器根据其序数索引为每个 Pod 提供唯一的主机名。 主机名采用 <code>-</code> 的形式。 因为 nacos StatefulSet 的副本字段设置为 2，所以当前集群文件中只有两个 Nacos 节点地址，故无法选举出 Leader，此时我们就需要手动扩容了</p></blockquote> <ul><li>在扩容前，使用 <code>kubectl exec</code> 获取在 pod 中的 Nacos 集群配置文件信息</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>for i in 0 1; do echo nacos-$i; kubectl exec nacos-$i cat conf/cluster.conf; done
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>使用 <code>kubectl scale</code> 对 Nacos 动态扩容</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl scale sts nacos --replicas=3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>在扩容后，使用 <code>kubectl exec</code> 获取在 pod 中的 Nacos 集群配置文件信息</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>for i in 0 1 2; do echo nacos-$i; kubectl exec nacos-$i cat conf/cluster.conf; done
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl delete pods nacos-0
kubectl exec -it nacos-0 /bin/bash
cd logs
tail -f naming-raft.log
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>使用 <code>kubectl exec</code> 执行 Nacos API 在每台节点上获取当前 Leader 是否一致</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>for i in 0 1 2; do echo nacos-$i; kubectl exec nacos-$i curl GET &quot;http://localhost:8848/nacos/v1/ns/raft/state&quot;; done
#暴露端口
kubectl port-forward svc/nacos-headless 8848:8848 --address 0.0.0.0
http://192.168.12.110:8848/nacos/v1/ns/raft/state
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p><strong>注意：</strong> 扩容后可能依然无法正确选举出 Leader，使用 <code>kubectl delete pods nacos-$i</code> 的形式手动删除 Pod ，让 k8s 自动恢复，再观察 <code>naming-raft.log</code>日志</p></blockquote> <h3 id="附：其它小记"><a href="#附：其它小记" class="header-anchor">#</a> 附：其它小记</h3> <h4 id="限制"><a href="#限制" class="header-anchor">#</a> 限制</h4> <p>必须要使用持久卷，否则会出现数据丢失的情况</p> <h4 id="项目目录"><a href="#项目目录" class="header-anchor">#</a> 项目目录</h4> <table><thead><tr><th style="text-align:left;">目录</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>plugin</code></td> <td style="text-align:left;">帮助 Nacos 集群进行动态扩容的插件 Docker 镜像源码</td></tr> <tr><td style="text-align:left;"><code>deploy</code></td> <td style="text-align:left;">K8s 部署文件</td></tr></tbody></table> <h4 id="配置属性"><a href="#配置属性" class="header-anchor">#</a> 配置属性</h4> <ul><li><code>nacos-pvc-nfs.yaml</code> or <code>nacos-quick-start.yaml</code></li></ul> <table><thead><tr><th style="text-align:left;">名称</th> <th style="text-align:left;">必要</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>mysql.master.db.name</code></td> <td style="text-align:left;">Y</td> <td style="text-align:left;">主库名称</td></tr> <tr><td style="text-align:left;"><code>mysql.master.port</code></td> <td style="text-align:left;">N</td> <td style="text-align:left;">主库端口</td></tr> <tr><td style="text-align:left;"><code>mysql.slave.port</code></td> <td style="text-align:left;">N</td> <td style="text-align:left;">从库端口</td></tr> <tr><td style="text-align:left;"><code>mysql.master.user</code></td> <td style="text-align:left;">Y</td> <td style="text-align:left;">主库用户名</td></tr> <tr><td style="text-align:left;"><code>mysql.master.password</code></td> <td style="text-align:left;">Y</td> <td style="text-align:left;">主库密码</td></tr> <tr><td style="text-align:left;"><code>NACOS_REPLICAS</code></td> <td style="text-align:left;">N</td> <td style="text-align:left;">确定执行 Nacos 启动节点数量，如果不适用动态扩容插件，就必须配置这个属性，否则使用扩容插件后不会生效</td></tr> <tr><td style="text-align:left;"><code>NACOS_SERVER_PORT</code></td> <td style="text-align:left;">N</td> <td style="text-align:left;">Nacos 端口</td></tr> <tr><td style="text-align:left;"><code>PREFER_HOST_MODE</code></td> <td style="text-align:left;">Y</td> <td style="text-align:left;">启动 Nacos 集群按域名解析</td></tr></tbody></table> <ul><li>nfs <code>deployment.yaml</code></li></ul> <table><thead><tr><th style="text-align:left;">名称</th> <th style="text-align:left;">必要</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>NFS_SERVER</code></td> <td style="text-align:left;">Y</td> <td style="text-align:left;">NFS 服务端地址</td></tr> <tr><td style="text-align:left;"><code>NFS_PATH</code></td> <td style="text-align:left;">Y</td> <td style="text-align:left;">NFS 共享目录</td></tr> <tr><td style="text-align:left;"><code>server</code></td> <td style="text-align:left;">Y</td> <td style="text-align:left;">NFS 服务端地址</td></tr> <tr><td style="text-align:left;"><code>path</code></td> <td style="text-align:left;">Y</td> <td style="text-align:left;">NFS 共享目录</td></tr></tbody></table> <ul><li>mysql</li></ul> <table><thead><tr><th style="text-align:left;">名称</th> <th style="text-align:left;">必要</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>MYSQL_ROOT_PASSWORD</code></td> <td style="text-align:left;">N</td> <td style="text-align:left;">ROOT 密码</td></tr> <tr><td style="text-align:left;"><code>MYSQL_DATABASE</code></td> <td style="text-align:left;">Y</td> <td style="text-align:left;">数据库名称</td></tr> <tr><td style="text-align:left;"><code>MYSQL_USER</code></td> <td style="text-align:left;">Y</td> <td style="text-align:left;">数据库用户名</td></tr> <tr><td style="text-align:left;"><code>MYSQL_PASSWORD</code></td> <td style="text-align:left;">Y</td> <td style="text-align:left;">数据库密码</td></tr> <tr><td style="text-align:left;"><code>MYSQL_REPLICATION_USER</code></td> <td style="text-align:left;">Y</td> <td style="text-align:left;">数据库复制用户</td></tr> <tr><td style="text-align:left;"><code>MYSQL_REPLICATION_PASSWORD</code></td> <td style="text-align:left;">Y</td> <td style="text-align:left;">数据库复制用户密码</td></tr> <tr><td style="text-align:left;"><code>Nfs:server</code></td> <td style="text-align:left;">N</td> <td style="text-align:left;">NFS 服务端地址，如果使用本地部署不需要配置</td></tr> <tr><td style="text-align:left;"><code>Nfs:path</code></td> <td style="text-align:left;">N</td> <td style="text-align:left;">NFS 共享目录，如果使用本地部署不需要配置</td></tr></tbody></table> <h2 id="myshopplus-用户服务提供者"><a href="#myshopplus-用户服务提供者" class="header-anchor">#</a> MyShopPlus 用户服务提供者</h2> <h3 id="概述-4"><a href="#概述-4" class="header-anchor">#</a> 概述</h3> <p>通常，提供者服务是直接和数据库打交道的，可以理解成三层架构中的数据访问层</p> <h3 id="创建提供者模块"><a href="#创建提供者模块" class="header-anchor">#</a> 创建提供者模块</h3> <p>创建一个名为 <code>provider</code> 的模块，POM 配置如下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
        &lt;artifactId&gt;parent&lt;/artifactId&gt;
        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;artifactId&gt;provider&lt;/artifactId&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;
    &lt;url&gt;http://www.funtl.com&lt;/url&gt;
    &lt;inceptionYear&gt;2018-Now&lt;/inceptionYear&gt;
    &lt;licenses&gt;
        &lt;license&gt;
            &lt;name&gt;Apache 2.0&lt;/name&gt;
            &lt;url&gt;https://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt;
        &lt;/license&gt;
    &lt;/licenses&gt;
    &lt;developers&gt;
        &lt;developer&gt;
            &lt;id&gt;liwemin&lt;/id&gt;
            &lt;name&gt;Lusifer Lee&lt;/name&gt;
            &lt;email&gt;lee.lusifer@gmail.com&lt;/email&gt;
        &lt;/developer&gt;
    &lt;/developers&gt;
&lt;/project&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="创建用户服务接口"><a href="#创建用户服务接口" class="header-anchor">#</a> 创建用户服务接口</h3> <p>由于本次是第一次在 k8s 中注册，所以先测试是否能够成功注册到 Naocs，成功后再进行后续编码工作</p> <h4 id="pom"><a href="#pom" class="header-anchor">#</a> POM</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
        &lt;artifactId&gt;provider&lt;/artifactId&gt;
        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;artifactId&gt;ums-admin-provider-api&lt;/artifactId&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;
    &lt;url&gt;http://www.funtl.com&lt;/url&gt;
    &lt;inceptionYear&gt;2018-Now&lt;/inceptionYear&gt;
    &lt;licenses&gt;
        &lt;license&gt;
            &lt;name&gt;Apache 2.0&lt;/name&gt;
            &lt;url&gt;https://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt;
        &lt;/license&gt;
    &lt;/licenses&gt;
    &lt;developers&gt;
        &lt;developer&gt;
            &lt;id&gt;liwemin&lt;/id&gt;
            &lt;name&gt;Lusifer Lee&lt;/name&gt;
            &lt;email&gt;lee.lusifer@gmail.com&lt;/email&gt;
        &lt;/developer&gt;
    &lt;/developers&gt;
&lt;/project&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h4 id="定义接口"><a href="#定义接口" class="header-anchor">#</a> 定义接口</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.funtl.myshop.plus.provider.api;
public interface EchoService {
    String echo(String string);
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="创建用户服务实现"><a href="#创建用户服务实现" class="header-anchor">#</a> 创建用户服务实现</h3> <h4 id="pom-2"><a href="#pom-2" class="header-anchor">#</a> POM</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
        &lt;artifactId&gt;provider&lt;/artifactId&gt;
        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;artifactId&gt;ums-admin-provider-service&lt;/artifactId&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;
    &lt;url&gt;http://www.funtl.com&lt;/url&gt;
    &lt;inceptionYear&gt;2018-Now&lt;/inceptionYear&gt;
    &lt;licenses&gt;
        &lt;license&gt;
            &lt;name&gt;Apache 2.0&lt;/name&gt;
            &lt;url&gt;https://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt;
        &lt;/license&gt;
    &lt;/licenses&gt;
    &lt;developers&gt;
        &lt;developer&gt;
            &lt;id&gt;liwemin&lt;/id&gt;
            &lt;name&gt;Lusifer Lee&lt;/name&gt;
            &lt;email&gt;lee.lusifer@gmail.com&lt;/email&gt;
        &lt;/developer&gt;
    &lt;/developers&gt;
    &lt;dependencies&gt;
        &lt;!-- Spring Boot Begin --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;!-- Spring Boot End --&gt;
        &lt;!-- Spring Cloud Begin --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-oauth2&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- Spring Cloud End --&gt;
        &lt;!-- Apache Dubbo Begin --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo&lt;/artifactId&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
                    &lt;artifactId&gt;spring&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
                    &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;log4j&lt;/groupId&gt;
                    &lt;artifactId&gt;log4j&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-registry-nacos&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;
            &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.spring&lt;/groupId&gt;
            &lt;artifactId&gt;spring-context-support&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-serialization-kryo&lt;/artifactId&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;log4j&lt;/groupId&gt;
                    &lt;artifactId&gt;log4j&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
                    &lt;artifactId&gt;dubbo-common&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;!-- Apache Dubbo End --&gt;
        &lt;!-- DataSource Begin --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.zaxxer&lt;/groupId&gt;
            &lt;artifactId&gt;HikariCP&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;
            &lt;exclusions&gt;
                &lt;!-- 排除 tomcat-jdbc 以使用 HikariCP --&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;
                    &lt;artifactId&gt;tomcat-jdbc&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;tk.mybatis&lt;/groupId&gt;
            &lt;artifactId&gt;mapper-spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- DataSource End --&gt;
        &lt;!-- Projects Begin --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
            &lt;artifactId&gt;ums-admin-provider-api&lt;/artifactId&gt;
            &lt;version&gt;${project.parent.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- Projects End --&gt;
    &lt;/dependencies&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;mainClass&gt;com.funtl.myshop.plus.provider.UmsAdminProviderApplication&lt;/mainClass&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br></div></div><h4 id="application-yml"><a href="#application-yml" class="header-anchor">#</a> application.yml</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>spring:
  application:
    name: ums-admin-provider
  main:
    allow-bean-definition-overriding: true
  datasource:
    type: com.zaxxer.hikari.HikariDataSource
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://192.168.141.110:4000/mplus_ums_admin?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false
    username: root
    password:
    hikari:
      minimum-idle: 5
      idle-timeout: 600000
      maximum-pool-size: 10
      auto-commit: true
      pool-name: MyHikariCP
      max-lifetime: 1800000
      connection-timeout: 30000
      connection-test-query: SELECT 1
dubbo:
  scan:
    base-packages: com.funtl.myshop.plus.provider.service
  protocol:
    name: dubbo
    port: -1
    serialization: kryo
  registry:
    address: nacos://nacos.funtl.com
    port: 80
mybatis:
  type-aliases-package: com.funtl.myshop.plus.provider.domain
  mapper-locations: classpath:mapper/*.xml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h4 id="application"><a href="#application" class="header-anchor">#</a> Application</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.funtl.myshop.plus.provider;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import tk.mybatis.spring.annotation.MapperScan;
@SpringBootApplication
@MapperScan(basePackages = &quot;com.funtl.myshop.plus.provider.mapper&quot;)
public class UmsAdminProviderApplication {
    public static void main(String[] args) {
        SpringApplication.run(UmsAdminProviderApplication.class, args);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="service"><a href="#service" class="header-anchor">#</a> Service</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.funtl.myshop.plus.provider.service;
import com.funtl.myshop.plus.provider.api.EchoService;
import org.apache.dubbo.config.annotation.Service;
@Service(version = &quot;1.0.0&quot;)
public class EchoServiceImpl implements EchoService {
    @Override
    public String echo(String string) {
        return &quot;Echo Hello Dubbo &quot; + string;
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="验证是否成功"><a href="#验证是否成功" class="header-anchor">#</a> 验证是否成功</h4> <p>通过浏览器访问：<a href="http://www.qfdmy.com/wp-content/themes/quanbaike/go.php?url=aHR0cDovL25hY29zLmZ1bnRsLmNvbS9uYWNvcw==" target="_blank" rel="noopener noreferrer">http://nacos.funtl.com/nacos<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ，你会发现一个服务已经注册在服务中了，服务名为：<code>providers:com.funtl.myshop.plus.provider.api.EchoService:1.0.0:</code></p> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/f6c9d13faffd2bb.png" alt="img"></p> <h2 id="myshopplus-用户注册服务"><a href="#myshopplus-用户注册服务" class="header-anchor">#</a> MyShopPlus 用户注册服务</h2> <h3 id="概述-5"><a href="#概述-5" class="header-anchor">#</a> 概述</h3> <p>服务本身既可以是提供者也可以是消费者，DUBBO 的服务提供者我们当成数据访问层，新创建的业务服务既是 DUBBO 的服务消费者又提供 RESTful 服务，此时可以理解成三层架构中的业务逻辑层</p> <h3 id="创建业务服务模块"><a href="#创建业务服务模块" class="header-anchor">#</a> 创建业务服务模块</h3> <p>创建一个名为 <code>business</code> 的模块，POM 配置如下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
        &lt;artifactId&gt;parent&lt;/artifactId&gt;
        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;artifactId&gt;business&lt;/artifactId&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;
    &lt;url&gt;http://www.funtl.com&lt;/url&gt;
    &lt;inceptionYear&gt;2018-Now&lt;/inceptionYear&gt;
    &lt;licenses&gt;
        &lt;license&gt;
            &lt;name&gt;Apache 2.0&lt;/name&gt;
            &lt;url&gt;https://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt;
        &lt;/license&gt;
    &lt;/licenses&gt;
    &lt;developers&gt;
        &lt;developer&gt;
            &lt;id&gt;liwemin&lt;/id&gt;
            &lt;name&gt;Lusifer Lee&lt;/name&gt;
            &lt;email&gt;lee.lusifer@gmail.com&lt;/email&gt;
        &lt;/developer&gt;
    &lt;/developers&gt;
    &lt;modules&gt;
        &lt;module&gt;business-reg&lt;/module&gt;
    &lt;/modules&gt;
&lt;/project&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="修改用户服务提供者"><a href="#修改用户服务提供者" class="header-anchor">#</a> 修改用户服务提供者</h3> <p>由于代码量较大，此处仅列出关键代码</p> <h3 id="创建资源配置类"><a href="#创建资源配置类" class="header-anchor">#</a> 创建资源配置类</h3> <p>目前该类的主要作用是注入 <code>BCryptPasswordEncoder</code> 用户注册时的密码加密</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.funtl.myshop.plus.provider.configure;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
/**
 * 资源配置服务器
 * &lt;p&gt;
 * Description:
 * &lt;/p&gt;
 *
 * @author Lusifer
 * @version v1.0.0
 * @date 2019-07-26 04:27:07
 * @see com.funtl.myshop.plus.provider.configure
 */
@Configuration
public class UmsAdminResourceConfiguration {
    @Bean
    public BCryptPasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="创建通用类模块"><a href="#创建通用类模块" class="header-anchor">#</a> 创建通用类模块</h3> <p>创建一个名为 <code>commons</code> 的模块，POM 配置如下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
        &lt;artifactId&gt;parent&lt;/artifactId&gt;
        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;artifactId&gt;commons&lt;/artifactId&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;
    &lt;url&gt;http://www.funtl.com&lt;/url&gt;
    &lt;inceptionYear&gt;2018-Now&lt;/inceptionYear&gt;
    &lt;licenses&gt;
        &lt;license&gt;
            &lt;name&gt;Apache 2.0&lt;/name&gt;
            &lt;url&gt;https://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt;
        &lt;/license&gt;
    &lt;/licenses&gt;
    &lt;developers&gt;
        &lt;developer&gt;
            &lt;id&gt;liwemin&lt;/id&gt;
            &lt;name&gt;Lusifer Lee&lt;/name&gt;
            &lt;email&gt;lee.lusifer@gmail.com&lt;/email&gt;
        &lt;/developer&gt;
    &lt;/developers&gt;
    &lt;modules&gt;
        &lt;module&gt;commons-dto&lt;/module&gt;
    &lt;/modules&gt;
&lt;/project&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="创建通用传输对象模块"><a href="#创建通用传输对象模块" class="header-anchor">#</a> 创建通用传输对象模块</h3> <h4 id="pom-3"><a href="#pom-3" class="header-anchor">#</a> POM</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
        &lt;artifactId&gt;commons&lt;/artifactId&gt;
        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;artifactId&gt;commons-dto&lt;/artifactId&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;
    &lt;url&gt;http://www.funtl.com&lt;/url&gt;
    &lt;inceptionYear&gt;2018-Now&lt;/inceptionYear&gt;
    &lt;licenses&gt;
        &lt;license&gt;
            &lt;name&gt;Apache 2.0&lt;/name&gt;
            &lt;url&gt;https://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt;
        &lt;/license&gt;
    &lt;/licenses&gt;
    &lt;developers&gt;
        &lt;developer&gt;
            &lt;id&gt;liwemin&lt;/id&gt;
            &lt;name&gt;Lusifer Lee&lt;/name&gt;
            &lt;email&gt;lee.lusifer@gmail.com&lt;/email&gt;
        &lt;/developer&gt;
    &lt;/developers&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h4 id="responseresult"><a href="#responseresult" class="header-anchor">#</a> ResponseResult</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.funtl.myshop.plus.commons.dto;
import lombok.Data;
import java.io.Serializable;
/**
 * 通用数据传输对象
 * &lt;p&gt;
 * Description:
 * &lt;/p&gt;
 *
 * @author Lusifer
 * @version v1.0.0
 * @date 2019-07-26 04:43:54
 * @see com.funtl.myshop.plus.commons.dto
 *
 */
@Data
public class ResponseResult&lt;T&gt; implements Serializable {
    private static final long serialVersionUID = 3468352004150968551L;
    /**
     * 状态码
     */
    private Integer state;
    /**
     * 消息
     */
    private String message;
    /**
     * 返回对象
     */
    private T data;
    public ResponseResult() {
        super();
    }
    public ResponseResult(Integer state) {
        super();
        this.state = state;
    }
    public ResponseResult(Integer state, String message) {
        super();
        this.state = state;
        this.message = message;
    }
    public ResponseResult(Integer state, Throwable throwable) {
        super();
        this.state = state;
        this.message = throwable.getMessage();
    }
    public ResponseResult(Integer state, T data) {
        super();
        this.state = state;
        this.data = data;
    }
    public ResponseResult(Integer state, String message, T data) {
        super();
        this.state = state;
        this.message = message;
        this.data = data;
    }
    public Integer getState() {
        return state;
    }
    public void setState(Integer state) {
        this.state = state;
    }
    public String getMessage() {
        return message;
    }
    public void setMessage(String message) {
        this.message = message;
    }
    public T getData() {
        return data;
    }
    public void setData(T data) {
        this.data = data;
    }
    @Override
    public int hashCode() {
        final int prime = 31;
        int result = 1;
        result = prime * result + ((data == null) ? 0 : data.hashCode());
        result = prime * result + ((message == null) ? 0 : message.hashCode());
        result = prime * result + ((state == null) ? 0 : state.hashCode());
        return result;
    }
    @Override
    public boolean equals(Object obj) {
        if (this == obj) {
            return true;
        }
        if (obj == null) {
            return false;
        }
        if (getClass() != obj.getClass()) {
            return false;
        }
        ResponseResult&lt;?&gt; other = (ResponseResult&lt;?&gt;) obj;
        if (data == null) {
            if (other.data != null) {
                return false;
            }
        } else if (!data.equals(other.data)) {
            return false;
        }
        if (message == null) {
            if (other.message != null) {
                return false;
            }
        } else if (!message.equals(other.message)) {
            return false;
        }
        if (state == null) {
            if (other.state != null) {
                return false;
            }
        } else if (!state.equals(other.state)) {
            return false;
        }
        return true;
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br></div></div><h3 id="创建用户注册服务"><a href="#创建用户注册服务" class="header-anchor">#</a> 创建用户注册服务</h3> <h4 id="pom-4"><a href="#pom-4" class="header-anchor">#</a> POM</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
        &lt;artifactId&gt;business&lt;/artifactId&gt;
        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;artifactId&gt;business-reg&lt;/artifactId&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;
    &lt;url&gt;http://www.funtl.com&lt;/url&gt;
    &lt;inceptionYear&gt;2018-Now&lt;/inceptionYear&gt;
    &lt;licenses&gt;
        &lt;license&gt;
            &lt;name&gt;Apache 2.0&lt;/name&gt;
            &lt;url&gt;https://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt;
        &lt;/license&gt;
    &lt;/licenses&gt;
    &lt;developers&gt;
        &lt;developer&gt;
            &lt;id&gt;liwemin&lt;/id&gt;
            &lt;name&gt;Lusifer Lee&lt;/name&gt;
            &lt;email&gt;lee.lusifer@gmail.com&lt;/email&gt;
        &lt;/developer&gt;
    &lt;/developers&gt;
    &lt;dependencies&gt;
        &lt;!-- Spring Boot Begin --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;!-- Spring Boot End --&gt;
        &lt;!-- Spring Cloud Begin --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- Spring Cloud End --&gt;
        &lt;!-- Apache Dubbo Begin --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo&lt;/artifactId&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
                    &lt;artifactId&gt;spring&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
                    &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;log4j&lt;/groupId&gt;
                    &lt;artifactId&gt;log4j&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-registry-nacos&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;
            &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.spring&lt;/groupId&gt;
            &lt;artifactId&gt;spring-context-support&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-serialization-kryo&lt;/artifactId&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;log4j&lt;/groupId&gt;
                    &lt;artifactId&gt;log4j&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
                    &lt;artifactId&gt;dubbo-common&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;!-- Apache Dubbo End --&gt;
        &lt;!-- Projects Begin --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
            &lt;artifactId&gt;commons-dto&lt;/artifactId&gt;
            &lt;version&gt;${project.parent.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
            &lt;artifactId&gt;ums-admin-provider-api&lt;/artifactId&gt;
            &lt;version&gt;${project.parent.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- Projects End --&gt;
    &lt;/dependencies&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;mainClass&gt;com.funtl.myshop.plus.business.BusinessRegApplication&lt;/mainClass&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br></div></div><h4 id="application-yml-2"><a href="#application-yml-2" class="header-anchor">#</a> application.yml</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>spring:
  application:
    name: business-reg
  main:
    allow-bean-definition-overriding: true
  jackson:
    time-zone: GMT+8
    date-format: yyyy-MM-dd HH:mm:ss
  cloud:
    nacos:
      discovery:
        server-addr: nacos.funtl.com:80
dubbo:
  scan:
    base-packages: com.funtl.myshop.plus.business.controller
  protocol:
    name: dubbo
    port: -1
    serialization: kryo
  registry:
    address: nacos://nacos.funtl.com
    port: 80
server:
  # ${random.int[9000,9999]} 随机端口
  port: 9000
management:
  endpoints:
    web:
      exposure:
        include: &quot;*&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h4 id="application-2"><a href="#application-2" class="header-anchor">#</a> Application</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.funtl.myshop.plus.business;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
@SpringBootApplication
public class BusinessRegApplication {
    public static void main(String[] args) {
        SpringApplication.run(BusinessRegApplication.class, args);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="controller"><a href="#controller" class="header-anchor">#</a> Controller</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.funtl.myshop.plus.business.controller;
import com.funtl.myshop.plus.commons.dto.ResponseResult;
import com.funtl.myshop.plus.provider.api.UmsAdminService;
import com.funtl.myshop.plus.provider.domain.UmsAdmin;
import org.apache.dubbo.config.annotation.Reference;
import org.springframework.http.HttpStatus;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
/**
 * 用户注册
 * &lt;p&gt;
 * Description:
 * &lt;/p&gt;
 *
 * @author Lusifer
 * @version v1.0.0
 * @date 2019-07-26 04:38:50
 * @see com.funtl.myshop.plus.business.controller
 */
@CrossOrigin(origins = &quot;*&quot;, maxAge = 3600)
@RestController
@RequestMapping(value = &quot;reg&quot;)
public class RegController {
    @Reference(version = &quot;1.0.0&quot;)
    private UmsAdminService umsAdminService;
    /**
     * 用户注册
     *
     * @param umsAdmin {@link UmsAdmin}
     * @return 成功则返回新注册用户信息
     */
    @PostMapping(value = &quot;&quot;)
    public ResponseResult&lt;UmsAdmin&gt; reg(@RequestBody UmsAdmin umsAdmin) {
        String message = validateReg(umsAdmin);
        // 验证通过
        if (message == null) {
            int result = umsAdminService.insert(umsAdmin);
            // 注册成功
            if (result &gt; 0) {
                UmsAdmin admin = umsAdminService.get(umsAdmin.getUsername());
                return new ResponseResult&lt;UmsAdmin&gt;(HttpStatus.OK.value(), &quot;新用户注册成功&quot;, admin);
            }
        }
        return new ResponseResult&lt;UmsAdmin&gt;(HttpStatus.NOT_ACCEPTABLE.value(), message != null ? message : &quot;新用户注册失败&quot;);
    }
    /**
     * 验证注册信息
     * @param umsAdmin {@link UmsAdmin}
     * @return 错误信息
     */
    private String validateReg(UmsAdmin umsAdmin) {
        UmsAdmin admin = umsAdminService.get(umsAdmin.getUsername());
        if (admin != null) {
            return &quot;用户名已存在，请重新输入&quot;;
        }
        return null;
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div><h2 id="myshopplus-创建认证服务"><a href="#myshopplus-创建认证服务" class="header-anchor">#</a> MyShopPlus 创建认证服务</h2> <h3 id="概述-6"><a href="#概述-6" class="header-anchor">#</a> 概述</h3> <p>之前的课程中我们介绍过 Spring Security oAuth2 的四种授权模式（简单模式、密码模式、授权码模式、客户端模式），一般情况下相同产品线我们采用密码模式</p> <blockquote><p><strong>注意：</strong> 当前案例采用内存模式以便快速演示效果</p></blockquote> <h3 id="pom-5"><a href="#pom-5" class="header-anchor">#</a> POM</h3> <p>在 <code>business</code> 模块下创建一个名为 <code>business-oauth2</code> 的服务模块，POM 配置如下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
        &lt;artifactId&gt;business&lt;/artifactId&gt;
        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;artifactId&gt;business-oauth2&lt;/artifactId&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;
    &lt;url&gt;http://www.funtl.com&lt;/url&gt;
    &lt;inceptionYear&gt;2018-Now&lt;/inceptionYear&gt;
    &lt;licenses&gt;
        &lt;license&gt;
            &lt;name&gt;Apache 2.0&lt;/name&gt;
            &lt;url&gt;https://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt;
        &lt;/license&gt;
    &lt;/licenses&gt;
    &lt;developers&gt;
        &lt;developer&gt;
            &lt;id&gt;liwemin&lt;/id&gt;
            &lt;name&gt;Lusifer Lee&lt;/name&gt;
            &lt;email&gt;lee.lusifer@gmail.com&lt;/email&gt;
        &lt;/developer&gt;
    &lt;/developers&gt;
    &lt;dependencies&gt;
        &lt;!-- Spring Boot Begin --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;!-- Spring Boot End --&gt;
        &lt;!-- Spring Cloud Begin --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-oauth2&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- Spring Cloud End --&gt;
        &lt;!-- Apache Dubbo Begin --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo&lt;/artifactId&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
                    &lt;artifactId&gt;spring&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
                    &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;log4j&lt;/groupId&gt;
                    &lt;artifactId&gt;log4j&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-registry-nacos&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;
            &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.spring&lt;/groupId&gt;
            &lt;artifactId&gt;spring-context-support&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-serialization-kryo&lt;/artifactId&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;log4j&lt;/groupId&gt;
                    &lt;artifactId&gt;log4j&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
                    &lt;artifactId&gt;dubbo-common&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;!-- Apache Dubbo End --&gt;
        &lt;!-- Projects Begin --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
            &lt;artifactId&gt;commons-dto&lt;/artifactId&gt;
            &lt;version&gt;${project.parent.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
            &lt;artifactId&gt;ums-admin-provider-api&lt;/artifactId&gt;
            &lt;version&gt;${project.parent.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- Projects End --&gt;
    &lt;/dependencies&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;mainClass&gt;com.funtl.myshop.plus.business.BusinessOAuth2Application&lt;/mainClass&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br></div></div><h3 id="application-yml-3"><a href="#application-yml-3" class="header-anchor">#</a> application.yml</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>spring:
  application:
    name: business-oauth2
  main:
    allow-bean-definition-overriding: true
  jackson:
    time-zone: GMT+8
    date-format: yyyy-MM-dd HH:mm:ss
  cloud:
    nacos:
      discovery:
        server-addr: nacos.funtl.com:80
dubbo:
  scan:
    base-packages: com.funtl.myshop.plus.business.controller
  protocol:
    name: dubbo
    port: -1
    serialization: kryo
  registry:
    address: nacos://nacos.funtl.com
    port: 80
server:
  port: 9001
management:
  endpoints:
    web:
      exposure:
        include: &quot;*&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="application-3"><a href="#application-3" class="header-anchor">#</a> Application</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.funtl.myshop.plus.business;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
@SpringBootApplication
public class BusinessOAuth2Application {
    public static void main(String[] args) {
        SpringApplication.run(BusinessOAuth2Application.class, args);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="自定义认证授权"><a href="#自定义认证授权" class="header-anchor">#</a> 自定义认证授权</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.funtl.myshop.plus.business.service;
import com.google.common.collect.Lists;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Service;
import java.util.List;
/**
 * 自定义认证授权
 * &lt;p&gt;
 * Description:
 * &lt;/p&gt;
 *
 * @author Lusifer
 * @version v1.0.0
 * @date 2019-07-28 17:57:14
 * @see com.funtl.myshop.plus.business.service
 *
 */
@Service
public class UserDetailsServiceImpl implements UserDetailsService {
    private static final String USERNAME = &quot;admin&quot;;
    private static final String PASSWORD = &quot;$2a$10$WhCuqmyCsYdqtJvM0/J4seCU.xZQHe2snNE5VFUuBGUZWPbtdl3GG&quot;;
    @Override
    public UserDetails loadUserByUsername(String s) throws UsernameNotFoundException {
        List&lt;GrantedAuthority&gt; grantedAuthorities = Lists.newArrayList();
        return new User(USERNAME, PASSWORD, grantedAuthorities);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="服务器安全配置"><a href="#服务器安全配置" class="header-anchor">#</a> 服务器安全配置</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.funtl.myshop.plus.business.configure;
import com.funtl.myshop.plus.business.service.UserDetailsServiceImpl;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
/**
 * 认证服务器安全配置
 * &lt;p&gt;
 * Description:
 * &lt;/p&gt;
 *
 * @author Lusifer
 * @version v1.0.0
 * @date 2019-07-28 17:56:56
 * @see com.funtl.myshop.plus.business.configure
 */
@Configuration
@EnableWebSecurity
@EnableGlobalMethodSecurity(prePostEnabled = true, securedEnabled = true, jsr250Enabled = true)
public class WebSecurityConfiguration extends WebSecurityConfigurerAdapter {
    @Bean
    public BCryptPasswordEncoder passwordEncoder() {
        // 配置默认的加密方式
        return new BCryptPasswordEncoder();
    }
    @Bean
    @Override
    protected UserDetailsService userDetailsService() {
        return new UserDetailsServiceImpl();
    }
    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        auth.userDetailsService(userDetailsService());
    }
    /**
     * 用于支持 password 模式
     *
     * @return
     * @throws Exception
     */
    @Bean
    @Override
    public AuthenticationManager authenticationManagerBean() throws Exception {
        return super.authenticationManagerBean();
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h3 id="认证服务器配置"><a href="#认证服务器配置" class="header-anchor">#</a> 认证服务器配置</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.funtl.myshop.plus.business.configure;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.oauth2.config.annotation.configurers.ClientDetailsServiceConfigurer;
import org.springframework.security.oauth2.config.annotation.web.configuration.AuthorizationServerConfigurerAdapter;
import org.springframework.security.oauth2.config.annotation.web.configuration.EnableAuthorizationServer;
import org.springframework.security.oauth2.config.annotation.web.configurers.AuthorizationServerEndpointsConfigurer;
import org.springframework.security.oauth2.config.annotation.web.configurers.AuthorizationServerSecurityConfigurer;
/**
 * 配置认证服务器
 * &lt;p&gt;
 * Description:
 * &lt;/p&gt;
 *
 * @author Lusifer
 * @version v1.0.0
 * @date 2019-07-28 17:55:49
 * @see com.funtl.myshop.plus.business.configure
 *
 */
@Configuration
@EnableAuthorizationServer
public class AuthorizationServerConfiguration extends AuthorizationServerConfigurerAdapter {
    @Autowired
    private BCryptPasswordEncoder passwordEncoder;
    /**
     * 注入用于支持 password 模式
     */
    @Autowired
    private AuthenticationManager authenticationManager;
    @Override
    public void configure(AuthorizationServerEndpointsConfigurer endpoints) throws Exception {
        // 用于支持密码模式
        endpoints.authenticationManager(authenticationManager);
    }
    @Override
    public void configure(AuthorizationServerSecurityConfigurer security) throws Exception {
        security
                // 允许客户端访问 /oauth/check_token 检查 token
                .checkTokenAccess(&quot;isAuthenticated()&quot;)
                .allowFormAuthenticationForClients();
    }
    /**
     * 配置客户端
     * @param clients
     * @throws Exception
     */
    @Override
    public void configure(ClientDetailsServiceConfigurer clients) throws Exception {
        clients
                // 使用内存设置
                .inMemory()
                // client_id
                .withClient(&quot;client&quot;)
                // client_secret
                .secret(passwordEncoder.encode(&quot;secret&quot;))
                // 授权类型，密码模式和刷新令牌
                .authorizedGrantTypes(&quot;password&quot;, &quot;refresh_token&quot;)
                // 授权范围
                .scopes(&quot;backend&quot;)
                // 可以设置对哪些资源有访问权限，不设置则全部资源都可以访问
                .resourceIds(&quot;backend-resources&quot;)
                // 设置访问令牌的有效期，这里是 1 天
                .accessTokenValiditySeconds(60 * 60 * 24)
                // 设置刷新令牌的有效期，这里是 30 天
                .refreshTokenValiditySeconds(60 * 60 * 24 * 30);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br></div></div><h3 id="登录获取令牌"><a href="#登录获取令牌" class="header-anchor">#</a> 登录获取令牌</h3> <ul><li>通过 CURL 或是 Postman 请求</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>curl -i -X POST -d &quot;username=admin&amp;password=123456&amp;grant_type=password&amp;client_id=client&amp;client_secret=secret&quot; http://localhost:9001/oauth/token
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/a1ad4e9dc20b7c4.png" alt="img"></p> <ul><li>得到响应结果如下</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
    &quot;access_token&quot;: &quot;54ef21a8-209b-46d1-b491-9e1cb60ddf2b&quot;,
    &quot;token_type&quot;: &quot;bearer&quot;,
    &quot;refresh_token&quot;: &quot;67822a82-68aa-4236-82c4-e51b8f580447&quot;,
    &quot;expires_in&quot;: 86114,
    &quot;scope&quot;: &quot;backend&quot;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="myshopplus-创建后台客户端"><a href="#myshopplus-创建后台客户端" class="header-anchor">#</a> MyShopPlus 创建后台客户端</h2> <h3 id="概述-7"><a href="#概述-7" class="header-anchor">#</a> 概述</h3> <p>创建了微服务以后，我们就可以使用 Vue 开发的客户端来访问我们的服务了，这里采用 <a href="https://github.com/PanJiaChen/vue-element-admin" target="_blank" rel="noopener noreferrer">Vue Element Admin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 作为我们的客户端模板，开发过程中我们使用 <a href="https://github.com/PanJiaChen/vue-admin-template" target="_blank" rel="noopener noreferrer">基础模板<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 创建项目并在实际开发中不断完善相关功能</p> <h3 id="构建步骤"><a href="#构建步骤" class="header-anchor">#</a> 构建步骤</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code># 克隆项目
git clone https://github.com/PanJiaChen/vue-admin-template.git
# 进入项目目录
cd vue-admin-template
# 安装依赖
npm install --registry=https://registry.npm.taobao.org
# 启动服务
npm run dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>浏览器访问 <a href="http://localhost:9528" target="_blank" rel="noopener noreferrer">http://localhost:9528<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="发布"><a href="#发布" class="header-anchor">#</a> 发布</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code># 构建测试环境
npm run build:stage
# 构建生产环境
npm run build:prod
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="其它"><a href="#其它" class="header-anchor">#</a> 其它</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code># 预览发布环境效果
npm run preview
# 预览发布环境效果 + 静态资源分析
npm run preview -- --report
# 代码格式检查
npm run lint
# 代码格式检查并自动修复
npm run lint -- --fix
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="myshopplus-okhttp3"><a href="#myshopplus-okhttp3" class="header-anchor">#</a> MyShopPlus OKHttp3</h2> <h3 id="概述-8"><a href="#概述-8" class="header-anchor">#</a> 概述</h3> <p>OKHttp 是一个当前主流的网络请求的开源框架，由 Square 公司开发，用于替代 <strong>HttpUrlConnection</strong> 和 <strong>Apache HttpClient</strong></p> <h3 id="特性"><a href="#特性" class="header-anchor">#</a> 特性</h3> <ul><li>支持 HTTP2，对一台机器的所有请求共享同一个 Socket</li> <li>内置连接池，支持连接复用，减少延迟</li> <li>支持透明的 gzip 压缩响应体</li> <li>通过缓存避免重复的请求</li> <li>请求失败时自动重试主机的其他 IP，自动重定向</li></ul> <h3 id="功能"><a href="#功能" class="header-anchor">#</a> 功能</h3> <ul><li>PUT，DELETE，POST，GET 等请求</li> <li>文件的上传下载</li> <li>加载图片 (内部会图片大小自动压缩)</li> <li>支持请求回调，直接返回对象、对象集合</li> <li>支持 Session 的保持</li></ul> <h3 id="依赖"><a href="#依赖" class="header-anchor">#</a> 依赖</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;dependency&gt;
    &lt;groupId&gt;com.squareup.okhttp3&lt;/groupId&gt;
    &lt;artifactId&gt;okhttp&lt;/artifactId&gt;
    &lt;version&gt;4.0.1&lt;/version&gt;
&lt;/dependency&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="测试请求"><a href="#测试请求" class="header-anchor">#</a> 测试请求</h3> <h4 id="get"><a href="#get" class="header-anchor">#</a> GET</h4> <p>测试 Get 请求</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>@Test
public void testGet() {
    String url = &quot;https://www.baidu.com&quot;;
    OkHttpClient client = new OkHttpClient();
    Request request = new Request.Builder()
        .url(url)
        .build();
    Call call = client.newCall(request);
    try {
        Response response = call.execute();
        System.out.println(response.body().string());
    } catch (IOException e) {
        e.printStackTrace();
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="post"><a href="#post" class="header-anchor">#</a> POST</h4> <p>测试 POST 请求</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>@Test
public void testPost() {
    String url = &quot;http://localhost:9001/oauth/token&quot;;
    OkHttpClient client = new OkHttpClient();
    RequestBody body = new FormBody.Builder()
        .add(&quot;username&quot;, &quot;admin&quot;)
        .add(&quot;password&quot;, &quot;123456&quot;)
        .add(&quot;grant_type&quot;, &quot;password&quot;)
        .add(&quot;client_id&quot;, &quot;client&quot;)
        .add(&quot;client_secret&quot;, &quot;secret&quot;)
        .build();
    Request request = new Request.Builder()
        .url(url)
        .post(body)
        .build();
    Call call = client.newCall(request);
    try {
        Response response = call.execute();
        System.out.println(response.body().string());
    } catch (IOException e) {
        e.printStackTrace();
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="工具类"><a href="#工具类" class="header-anchor">#</a> 工具类</h3> <h4 id="okhttp"><a href="#okhttp" class="header-anchor">#</a> OKHttp</h4> <p>为了简化我们的构建过程，可以封装如下工具类</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.funtl.myshop.plus.commons.utils;
import okhttp3.Call;
import okhttp3.Callback;
import okhttp3.MediaType;
import okhttp3.OkHttpClient;
import okhttp3.Request;
import okhttp3.RequestBody;
import okhttp3.Response;
import java.io.IOException;
import java.util.Iterator;
import java.util.Map;
import java.util.concurrent.TimeUnit;
/**
 * OKHttp3
 * &lt;p&gt;
 * Description:
 * &lt;/p&gt;
 *
 * @author Lusifer
 * @version v1.0.0
 * @date 2019-07-29 14:05:08
 * @see com.funtl.myshop.plus.commons.utils
 */
public class OkHttpClientUtil {
    private static final int READ_TIMEOUT = 100;
    private static final int CONNECT_TIMEOUT = 60;
    private static final int WRITE_TIMEOUT = 60;
    private static final MediaType JSON = MediaType.parse(&quot;application/json; charset=utf-8&quot;);
    private static final byte[] LOCKER = new byte[0];
    private static OkHttpClientUtil mInstance;
    private OkHttpClient okHttpClient;
    private OkHttpClientUtil() {
        okhttp3.OkHttpClient.Builder clientBuilder = new okhttp3.OkHttpClient.Builder();
        // 读取超时
        clientBuilder.readTimeout(READ_TIMEOUT, TimeUnit.SECONDS);
        // 连接超时
        clientBuilder.connectTimeout(CONNECT_TIMEOUT, TimeUnit.SECONDS);
        //写入超时
        clientBuilder.writeTimeout(WRITE_TIMEOUT, TimeUnit.SECONDS);
        okHttpClient = clientBuilder.build();
    }
    /**
     * 单例模式获取 NetUtils
     *
     * @return {@link OkHttpClientUtil}
     */
    public static OkHttpClientUtil getInstance() {
        if (mInstance == null) {
            synchronized (LOCKER) {
                if (mInstance == null) {
                    mInstance = new OkHttpClientUtil();
                }
            }
        }
        return mInstance;
    }
    /**
     * GET，同步方式，获取网络数据
     *
     * @param url 请求地址
     * @return {@link Response}
     */
    public Response getData(String url) {
        // 构造 Request
        Request.Builder builder = new Request.Builder();
        Request request = builder.get().url(url).build();
        // 将 Request 封装为 Call
        Call call = okHttpClient.newCall(request);
        // 执行 Call，得到 Response
        Response response = null;
        try {
            response = call.execute();
        } catch (IOException e) {
            e.printStackTrace();
        }
        return response;
    }
    /**
     * POST 请求，同步方式，提交数据
     *
     * @param url        请求地址
     * @param bodyParams 请求参数
     * @return {@link Response}
     */
    public Response postData(String url, Map&lt;String, String&gt; bodyParams) {
        // 构造 RequestBody
        RequestBody body = setRequestBody(bodyParams);
        // 构造 Request
        Request.Builder requestBuilder = new Request.Builder();
        Request request = requestBuilder.post(body).url(url).build();
        // 将 Request 封装为 Call
        Call call = okHttpClient.newCall(request);
        // 执行 Call，得到 Response
        Response response = null;
        try {
            response = call.execute();
        } catch (IOException e) {
            e.printStackTrace();
        }
        return response;
    }
    /**
     * GET 请求，异步方式，获取网络数据
     *
     * @param url       请求地址
     * @param myNetCall 回调函数
     */
    public void getDataAsync(String url, final MyNetCall myNetCall) {
        // 构造 Request
        Request.Builder builder = new Request.Builder();
        Request request = builder.get().url(url).build();
        // 将 Request 封装为 Call
        Call call = okHttpClient.newCall(request);
        // 执行 Call
        call.enqueue(new Callback() {
            @Override
            public void onFailure(Call call, IOException e) {
                myNetCall.failed(call, e);
            }
            @Override
            public void onResponse(Call call, Response response) throws IOException {
                myNetCall.success(call, response);
            }
        });
    }
    /**
     * POST 请求，异步方式，提交数据
     *
     * @param url        请求地址
     * @param bodyParams 请求参数
     * @param myNetCall  回调函数
     */
    public void postDataAsync(String url, Map&lt;String, String&gt; bodyParams, final MyNetCall myNetCall) {
        // 构造 RequestBody
        RequestBody body = setRequestBody(bodyParams);
        // 构造 Request
        buildRequest(url, myNetCall, body);
    }
    /**
     * 同步 POST 请求，使用 JSON 格式作为参数
     *
     * @param url  请求地址
     * @param json JSON 格式参数
     * @return 响应结果
     * @throws IOException 异常
     */
    public String postJson(String url, String json) throws IOException {
        RequestBody body = RequestBody.create(json, JSON);
        Request request = new Request.Builder()
                .url(url)
                .post(body)
                .build();
        Response response = okHttpClient.newCall(request).execute();
        if (response.isSuccessful()) {
            return response.body().string();
        } else {
            throw new IOException(&quot;Unexpected code &quot; + response);
        }
    }
    /**
     * 异步 POST 请求，使用 JSON 格式作为参数
     *
     * @param url       请求地址
     * @param json      JSON 格式参数
     * @param myNetCall 回调函数
     * @throws IOException 异常
     */
    public void postJsonAsync(String url, String json, final MyNetCall myNetCall) throws IOException {
        RequestBody body = RequestBody.create(json, JSON);
        // 构造 Request
        buildRequest(url, myNetCall, body);
    }
    /**
     * 构造 POST 请求参数
     *
     * @param bodyParams 请求参数
     * @return {@link RequestBody}
     */
    private RequestBody setRequestBody(Map&lt;String, String&gt; bodyParams) {
        RequestBody body = null;
        okhttp3.FormBody.Builder formEncodingBuilder = new okhttp3.FormBody.Builder();
        if (bodyParams != null) {
            Iterator&lt;String&gt; iterator = bodyParams.keySet().iterator();
            String key = &quot;&quot;;
            while (iterator.hasNext()) {
                key = iterator.next().toString();
                formEncodingBuilder.add(key, bodyParams.get(key));
            }
        }
        body = formEncodingBuilder.build();
        return body;
    }
    /**
     * 构造 Request 发起异步请求
     *
     * @param url       请求地址
     * @param myNetCall 回调函数
     * @param body      {@link RequestBody}
     */
    private void buildRequest(String url, MyNetCall myNetCall, RequestBody body) {
        Request.Builder requestBuilder = new Request.Builder();
        Request request = requestBuilder.post(body).url(url).build();
        // 将 Request 封装为 Call
        Call call = okHttpClient.newCall(request);
        // 执行 Call
        call.enqueue(new Callback() {
            @Override
            public void onFailure(Call call, IOException e) {
                myNetCall.failed(call, e);
            }
            @Override
            public void onResponse(Call call, Response response) throws IOException {
                myNetCall.success(call, response);
            }
        });
    }
    /**
     * 自定义网络回调接口
     */
    public interface MyNetCall {
        /**
         * 请求成功的回调处理
         *
         * @param call     {@link Call}
         * @param response {@link Response}
         * @throws IOException 异常
         */
        void success(Call call, Response response) throws IOException;
        /**
         * 请求失败的回调处理
         *
         * @param call {@link Call}
         * @param e    异常
         */
        void failed(Call call, IOException e);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br></div></div><h4 id="jackson"><a href="#jackson" class="header-anchor">#</a> Jackson</h4> <p>请求的响应结果通常是 JSON 数据格式，此时我们还可以封装一个 Jackson 工具类，简化我们的 JSON 解析过程</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.funtl.myshop.plus.commons.utils;
import com.fasterxml.jackson.annotation.JsonInclude;
import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.DeserializationFeature;
import com.fasterxml.jackson.databind.JavaType;
import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
/**
 * Jackson 工具类
 * &lt;p&gt;Title: MapperUtils&lt;/p&gt;
 * &lt;p&gt;Description: &lt;/p&gt;
 *
 * @author Lusifer
 * @version 1.0.0
 * @date 2018/3/4 21:50
 */
public class MapperUtils {
    private final static ObjectMapper objectMapper = new ObjectMapper();
    public static ObjectMapper getInstance() {
        return objectMapper;
    }
    /**
     * 转换为 JSON 字符串
     *
     * @param obj
     * @return
     * @throws Exception
     */
    public static String obj2json(Object obj) throws Exception {
        return objectMapper.writeValueAsString(obj);
    }
    /**
     * 转换为 JSON 字符串，忽略空值
     *
     * @param obj
     * @return
     * @throws Exception
     */
    public static String obj2jsonIgnoreNull(Object obj) throws Exception {
        ObjectMapper mapper = new ObjectMapper();
        mapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);
        return mapper.writeValueAsString(obj);
    }
    /**
     * 转换为 JavaBean
     *
     * @param jsonString
     * @param clazz
     * @return
     * @throws Exception
     */
    public static &lt;T&gt; T json2pojo(String jsonString, Class&lt;T&gt; clazz) throws Exception {
        objectMapper.configure(DeserializationFeature.ACCEPT_SINGLE_VALUE_AS_ARRAY, true);
        return objectMapper.readValue(jsonString, clazz);
    }
    /**
     * 字符串转换为 Map&lt;String, Object&gt;
     *
     * @param jsonString
     * @return
     * @throws Exception
     */
    public static &lt;T&gt; Map&lt;String, Object&gt; json2map(String jsonString) throws Exception {
        ObjectMapper mapper = new ObjectMapper();
        mapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);
        return mapper.readValue(jsonString, Map.class);
    }
    /**
     * 字符串转换为 Map&lt;String, T&gt;
     */
    public static &lt;T&gt; Map&lt;String, T&gt; json2map(String jsonString, Class&lt;T&gt; clazz) throws Exception {
        Map&lt;String, Map&lt;String, Object&gt;&gt; map = objectMapper.readValue(jsonString, new TypeReference&lt;Map&lt;String, T&gt;&gt;() {
        });
        Map&lt;String, T&gt; result = new HashMap&lt;String, T&gt;();
        for (Map.Entry&lt;String, Map&lt;String, Object&gt;&gt; entry : map.entrySet()) {
            result.put(entry.getKey(), map2pojo(entry.getValue(), clazz));
        }
        return result;
    }
    /**
     * 深度转换 JSON 成 Map
     *
     * @param json
     * @return
     */
    public static Map&lt;String, Object&gt; json2mapDeeply(String json) throws Exception {
        return json2MapRecursion(json, objectMapper);
    }
    /**
     * 把 JSON 解析成 List，如果 List 内部的元素存在 jsonString，继续解析
     *
     * @param json
     * @param mapper 解析工具
     * @return
     * @throws Exception
     */
    private static List&lt;Object&gt; json2ListRecursion(String json, ObjectMapper mapper) throws Exception {
        if (json == null) {
            return null;
        }
        List&lt;Object&gt; list = mapper.readValue(json, List.class);
        for (Object obj : list) {
            if (obj != null &amp;&amp; obj instanceof String) {
                String str = (String) obj;
                if (str.startsWith(&quot;[&quot;)) {
                    obj = json2ListRecursion(str, mapper);
                } else if (obj.toString().startsWith(&quot;{&quot;)) {
                    obj = json2MapRecursion(str, mapper);
                }
            }
        }
        return list;
    }
    /**
     * 把 JSON 解析成 Map，如果 Map 内部的 Value 存在 jsonString，继续解析
     *
     * @param json
     * @param mapper
     * @return
     * @throws Exception
     */
    private static Map&lt;String, Object&gt; json2MapRecursion(String json, ObjectMapper mapper) throws Exception {
        if (json == null) {
            return null;
        }
        Map&lt;String, Object&gt; map = mapper.readValue(json, Map.class);
        for (Map.Entry&lt;String, Object&gt; entry : map.entrySet()) {
            Object obj = entry.getValue();
            if (obj != null &amp;&amp; obj instanceof String) {
                String str = ((String) obj);
                if (str.startsWith(&quot;[&quot;)) {
                    List&lt;?&gt; list = json2ListRecursion(str, mapper);
                    map.put(entry.getKey(), list);
                } else if (str.startsWith(&quot;{&quot;)) {
                    Map&lt;String, Object&gt; mapRecursion = json2MapRecursion(str, mapper);
                    map.put(entry.getKey(), mapRecursion);
                }
            }
        }
        return map;
    }
    /**
     * 将 JSON 数组转换为集合
     *
     * @param jsonArrayStr
     * @param clazz
     * @return
     * @throws Exception
     */
    public static &lt;T&gt; List&lt;T&gt; json2list(String jsonArrayStr, Class&lt;T&gt; clazz) throws Exception {
        JavaType javaType = getCollectionType(ArrayList.class, clazz);
        List&lt;T&gt; list = (List&lt;T&gt;) objectMapper.readValue(jsonArrayStr, javaType);
        return list;
    }
    /**
     * 获取泛型的 Collection Type
     *
     * @param collectionClass 泛型的Collection
     * @param elementClasses  元素类
     * @return JavaType Java类型
     * @since 1.0
     */
    public static JavaType getCollectionType(Class&lt;?&gt; collectionClass, Class&lt;?&gt;... elementClasses) {
        return objectMapper.getTypeFactory().constructParametricType(collectionClass, elementClasses);
    }
    /**
     * 将 Map 转换为 JavaBean
     *
     * @param map
     * @param clazz
     * @return
     */
    public static &lt;T&gt; T map2pojo(Map map, Class&lt;T&gt; clazz) {
        return objectMapper.convertValue(map, clazz);
    }
    /**
     * 将 Map 转换为 JSON
     *
     * @param map
     * @return
     */
    public static String mapToJson(Map map) {
        try {
            return objectMapper.writeValueAsString(map);
        } catch (Exception e) {
            e.printStackTrace();
        }
        return &quot;&quot;;
    }
    /**
     * 将 JSON 对象转换为 JavaBean
     *
     * @param obj
     * @param clazz
     * @return
     */
    public static &lt;T&gt; T obj2pojo(Object obj, Class&lt;T&gt; clazz) {
        return objectMapper.convertValue(obj, clazz);
    }
    /**
     * 将指定节点的 JSON 数据转换为 JavaBean
     *
     * @param jsonString
     * @param clazz
     * @return
     * @throws Exception
     */
    public static &lt;T&gt; T json2pojoByTree(String jsonString, String treeNode, Class&lt;T&gt; clazz) throws Exception {
        JsonNode jsonNode = objectMapper.readTree(jsonString);
        JsonNode data = jsonNode.findPath(treeNode);
        return json2pojo(data.toString(), clazz);
    }
    /**
     * 将指定节点的 JSON 数组转换为集合
     *
     * @param jsonStr  JSON 字符串
     * @param treeNode 查找 JSON 中的节点
     * @return
     * @throws Exception
     */
    public static &lt;T&gt; List&lt;T&gt; json2listByTree(String jsonStr, String treeNode, Class&lt;T&gt; clazz) throws Exception {
        JsonNode jsonNode = objectMapper.readTree(jsonStr);
        JsonNode data = jsonNode.findPath(treeNode);
        return json2list(data.toString(), clazz);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br></div></div><h2 id="myshopplus-完善登录和注销"><a href="#myshopplus-完善登录和注销" class="header-anchor">#</a> MyShopPlus 完善登录和注销</h2> <h3 id="概述-9"><a href="#概述-9" class="header-anchor">#</a> 概述</h3> <p>本章节依然使用内存模式处理登录请求并增加注销功能，由于代码量较大，仅列出关键代码</p> <h3 id="websecurity"><a href="#websecurity" class="header-anchor">#</a> WebSecurity</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.funtl.myshop.plus.business.configure;
import com.funtl.myshop.plus.business.service.UserDetailsServiceImpl;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.builders.WebSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.oauth2.config.annotation.web.configuration.EnableResourceServer;
@Configuration
@EnableWebSecurity
// 增加了资源服务器配置
@EnableResourceServer
@EnableGlobalMethodSecurity(prePostEnabled = true, securedEnabled = true, jsr250Enabled = true)
public class WebSecurityConfiguration extends WebSecurityConfigurerAdapter {
    @Bean
    public BCryptPasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
    @Bean
    @Override
    public UserDetailsService userDetailsServiceBean() throws Exception {
        return new UserDetailsServiceImpl();
    }
    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        auth.userDetailsService(userDetailsServiceBean());
    }
    @Bean
    @Override
    public AuthenticationManager authenticationManagerBean() throws Exception {
        return super.authenticationManagerBean();
    }
    @Override
    public void configure(WebSecurity web) throws Exception {
        web.ignoring()
                .antMatchers(&quot;/user/login&quot;);
    }
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.exceptionHandling()
                .and()
                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)
                .and()
                .authorizeRequests()
                // 增加了授权访问配置
                .antMatchers(&quot;/user/info&quot;).hasAuthority(&quot;USER&quot;)
                .antMatchers(&quot;/user/logout&quot;).hasAuthority(&quot;USER&quot;);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><h3 id="authorizationserver"><a href="#authorizationserver" class="header-anchor">#</a> AuthorizationServer</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.funtl.myshop.plus.business.configure;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.oauth2.config.annotation.configurers.ClientDetailsServiceConfigurer;
import org.springframework.security.oauth2.config.annotation.web.configuration.AuthorizationServerConfigurerAdapter;
import org.springframework.security.oauth2.config.annotation.web.configuration.EnableAuthorizationServer;
import org.springframework.security.oauth2.config.annotation.web.configurers.AuthorizationServerEndpointsConfigurer;
import org.springframework.security.oauth2.config.annotation.web.configurers.AuthorizationServerSecurityConfigurer;
import org.springframework.security.oauth2.provider.token.TokenStore;
import org.springframework.security.oauth2.provider.token.store.InMemoryTokenStore;
@Configuration
@EnableAuthorizationServer
public class AuthorizationServerConfiguration extends AuthorizationServerConfigurerAdapter {
    @Autowired
    private BCryptPasswordEncoder passwordEncoder;
    @Autowired
    private AuthenticationManager authenticationManager;
    // 增加 TokenStore 配置
    @Bean
    public TokenStore tokenStore() {
        return new InMemoryTokenStore();
    }
    @Override
    public void configure(AuthorizationServerEndpointsConfigurer endpoints) throws Exception {
        endpoints
                .authenticationManager(authenticationManager)
                // 增加 TokenStore 配置
                .tokenStore(tokenStore());
    }
    @Override
    public void configure(AuthorizationServerSecurityConfigurer security) throws Exception {
        security
                .checkTokenAccess(&quot;isAuthenticated()&quot;)
                .allowFormAuthenticationForClients();
    }
    @Override
    public void configure(ClientDetailsServiceConfigurer clients) throws Exception {
        clients
                .inMemory()
                .withClient(&quot;client&quot;)
                .secret(passwordEncoder.encode(&quot;secret&quot;))
                .authorizedGrantTypes(&quot;password&quot;, &quot;refresh_token&quot;)
                .scopes(&quot;backend&quot;)
                .resourceIds(&quot;backend-resources&quot;)
                .accessTokenValiditySeconds(60 * 60 * 24)
                .refreshTokenValiditySeconds(60 * 60 * 24 * 30);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><h3 id="userdetailsservice"><a href="#userdetailsservice" class="header-anchor">#</a> UserDetailsService</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.funtl.myshop.plus.business.service;
import com.google.common.collect.Lists;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Component;
import java.util.List;
// 优化了认证逻辑
@Component
public class UserDetailsServiceImpl implements UserDetailsService {
    private static final String USERNAME = &quot;admin&quot;;
    private static final String PASSWORD = &quot;$2a$10$YNUV/BtCel2orbhgrxyPJeljdKVty6yTAL.Cj4v3XhwHWXBkgyPYW&quot;;
    @Override
    public UserDetails loadUserByUsername(String s) throws UsernameNotFoundException {
        // 用户名匹配
        if (s.equals(USERNAME)) {
            List&lt;GrantedAuthority&gt; grantedAuthorities = Lists.newArrayList();
            GrantedAuthority grantedAuthority = new SimpleGrantedAuthority(&quot;USER&quot;);
            grantedAuthorities.add(grantedAuthority);
            return new User(USERNAME, PASSWORD, grantedAuthorities);
        }
        // 用户名不匹配
        else {
            return null;
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="logincontroller"><a href="#logincontroller" class="header-anchor">#</a> LoginController</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.funtl.myshop.plus.business.controller;
import com.funtl.myshop.plus.business.dto.LoginInfo;
import com.funtl.myshop.plus.business.dto.LoginParam;
import com.funtl.myshop.plus.commons.dto.ResponseResult;
import com.funtl.myshop.plus.commons.utils.MapperUtils;
import com.funtl.myshop.plus.commons.utils.OkHttpClientUtil;
import com.google.common.collect.Maps;
import okhttp3.Response;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.oauth2.common.OAuth2AccessToken;
import org.springframework.security.oauth2.provider.token.TokenStore;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;
import javax.annotation.Resource;
import javax.servlet.http.HttpServletRequest;
import java.util.Map;
import java.util.Objects;
/**
 * 登录管理
 * &lt;p&gt;
 * Description:
 * &lt;/p&gt;
 *
 * @author Lusifer
 * @version v1.0.0
 * @date 2019-07-29 11:14:58
 * @see com.funtl.myshop.plus.business.controller
 */
@CrossOrigin(origins = &quot;*&quot;, maxAge = 3600)
@RestController
public class LoginController {
    private static final String URL_OAUTH_TOKEN = &quot;http://localhost:9001/oauth/token&quot;;
    @Value(&quot;${business.oauth2.grant_type}&quot;)
    public String oauth2GrantType;
    @Value(&quot;${business.oauth2.client_id}&quot;)
    public String oauth2ClientId;
    @Value(&quot;${business.oauth2.client_secret}&quot;)
    public String oauth2ClientSecret;
    @Resource(name = &quot;userDetailsServiceBean&quot;)
    public UserDetailsService userDetailsService;
    @Resource
    public BCryptPasswordEncoder passwordEncoder;
    @Resource
    public TokenStore tokenStore;
    /**
     * 登录
     *
     * @param loginParam 登录参数
     * @return {@link ResponseResult}
     */
    @PostMapping(value = &quot;/user/login&quot;)
    public ResponseResult&lt;Map&lt;String, Object&gt;&gt; login(@RequestBody LoginParam loginParam) {
        // 封装返回的结果集
        Map&lt;String, Object&gt; result = Maps.newHashMap();
        // 验证密码是否正确
        UserDetails userDetails = userDetailsService.loadUserByUsername(loginParam.getUsername());
        if (userDetails == null || !passwordEncoder.matches(loginParam.getPassword(), userDetails.getPassword())) {
            return new ResponseResult&lt;Map&lt;String, Object&gt;&gt;(ResponseResult.CodeStatus.ILLEGAL_REQUEST, &quot;账号或密码错误&quot;, null);
        }
        // 通过 HTTP 客户端请求登录接口
        Map&lt;String, String&gt; params = Maps.newHashMap();
        params.put(&quot;username&quot;, loginParam.getUsername());
        params.put(&quot;password&quot;, loginParam.getPassword());
        params.put(&quot;grant_type&quot;, oauth2GrantType);
        params.put(&quot;client_id&quot;, oauth2ClientId);
        params.put(&quot;client_secret&quot;, oauth2ClientSecret);
        try {
            // 解析响应结果封装并返回
            Response response = OkHttpClientUtil.getInstance().postData(URL_OAUTH_TOKEN, params);
            String jsonString = Objects.requireNonNull(response.body()).string();
            Map&lt;String, Object&gt; jsonMap = MapperUtils.json2map(jsonString);
            String token = String.valueOf(jsonMap.get(&quot;access_token&quot;));
            result.put(&quot;token&quot;, token);
        } catch (Exception e) {
            e.printStackTrace();
        }
        return new ResponseResult&lt;Map&lt;String, Object&gt;&gt;(ResponseResult.CodeStatus.OK, &quot;登录成功&quot;, result);
    }
    /**
     * 获取用户信息
     *
     * @return {@link ResponseResult}
     */
    @GetMapping(value = &quot;/user/info&quot;)
    public ResponseResult&lt;LoginInfo&gt; info(HttpServletRequest request) {
        // 获取 token
        String token = request.getParameter(&quot;access_token&quot;);
        // 获取认证信息
        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
        // 封装并返回结果
        LoginInfo loginInfo = new LoginInfo();
        loginInfo.setName(authentication.getName());
        loginInfo.setAvatar(&quot;&quot;);
        loginInfo.setToken(token);
        return new ResponseResult&lt;LoginInfo&gt;(ResponseResult.CodeStatus.OK, &quot;获取用户信息&quot;, loginInfo);
    }
    /**
     * 注销
     *
     * @return {@link ResponseResult}
     */
    @PostMapping(value = &quot;/user/logout&quot;)
    public ResponseResult&lt;Void&gt; logout(HttpServletRequest request) {
        // 获取 token
        String token = request.getParameter(&quot;access_token&quot;);
        // 删除 token 以注销
        OAuth2AccessToken oAuth2AccessToken = tokenStore.readAccessToken(token);
        tokenStore.removeAccessToken(oAuth2AccessToken);
        return new ResponseResult&lt;Void&gt;(ResponseResult.CodeStatus.OK, &quot;用户已注销&quot;);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br></div></div><h2 id="myshopplus-创建路由网关"><a href="#myshopplus-创建路由网关" class="header-anchor">#</a> MyShopPlus 创建路由网关</h2> <h3 id="spring-cloud-gateway"><a href="#spring-cloud-gateway" class="header-anchor">#</a> Spring Cloud Gateway</h3> <p>Spring Cloud Gateway 是 Spring 官方基于 Spring 5.0，Spring Boot 2.0 和 Project Reactor 等技术开发的网关，Spring Cloud Gateway 旨在为微服务架构提供一种简单而有效的统一的 API 路由管理方式。<strong>Spring Cloud Gateway 作为 Spring Cloud 生态系中的网关，目标是替代 Netflix Zuul</strong>，其不仅提供统一的路由方式，并且基于 Filter 链的方式提供了网关基本的功能，例如：安全，监控 / 埋点，和限流等。</p> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/01446c1235bf3d1.jpg" alt="img"></p> <h3 id="功能特征"><a href="#功能特征" class="header-anchor">#</a> 功能特征</h3> <ul><li>基于 Spring Framework 5，Project Reactor 和 Spring Boot 2.0</li> <li>动态路由</li> <li>Predicates 和 Filters 作用于特定路由</li> <li>集成 Hystrix 断路器</li> <li>集成 Spring Cloud DiscoveryClient</li> <li>易于编写的 Predicates 和 Filters</li> <li>限流</li> <li>路径重写</li></ul> <h3 id="工程流程"><a href="#工程流程" class="header-anchor">#</a> 工程流程</h3> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/07f4283ae547807.jpg" alt="img"></p> <p>客户端向 Spring Cloud Gateway 发出请求。然后在 Gateway Handler Mapping 中找到与请求相匹配的路由，将其发送到 Gateway Web Handler。Handler 再通过指定的过滤器链来将请求发送到我们实际的服务执行业务逻辑，然后返回。</p> <p>过滤器之间用虚线分开是因为过滤器可能会在发送代理请求之前（<code>pre</code>）或之后（<code>post</code>）执行业务逻辑。</p> <h3 id="创建网关服务"><a href="#创建网关服务" class="header-anchor">#</a> 创建网关服务</h3> <p>创建一个名为 <code>gateway</code> 的服务，专门提供路由网关功能</p> <h4 id="pom-6"><a href="#pom-6" class="header-anchor">#</a> POM</h4> <p>主要增加了 <code>org.springframework.cloud:spring-cloud-starter-gateway</code> 依赖</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
        &lt;artifactId&gt;parent&lt;/artifactId&gt;
        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;artifactId&gt;gateway&lt;/artifactId&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;
    &lt;url&gt;http://www.funtl.com&lt;/url&gt;
    &lt;inceptionYear&gt;2018-Now&lt;/inceptionYear&gt;
    &lt;licenses&gt;
        &lt;license&gt;
            &lt;name&gt;Apache 2.0&lt;/name&gt;
            &lt;url&gt;https://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt;
        &lt;/license&gt;
    &lt;/licenses&gt;
    &lt;developers&gt;
        &lt;developer&gt;
            &lt;id&gt;liwemin&lt;/id&gt;
            &lt;name&gt;Lusifer Lee&lt;/name&gt;
            &lt;email&gt;lee.lusifer@gmail.com&lt;/email&gt;
        &lt;/developer&gt;
    &lt;/developers&gt;
    &lt;dependencies&gt;
        &lt;!-- Spring Boot Begin --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;!-- Spring Boot End --&gt;
        &lt;!-- Spring Cloud Begin --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- Spring Cloud End --&gt;
        &lt;!-- Commons Begin --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
            &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- Commons Begin --&gt;
    &lt;/dependencies&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;mainClass&gt;com.funtl.myshop.plus.gateway.GatewayApplication&lt;/mainClass&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><blockquote><p><strong>注意：</strong> Spring Cloud Gateway 不使用 Web 作为服务器，而是 <strong>使用 WebFlux 作为服务器</strong> ，Gateway 项目已经依赖了 <code>starter-webflux</code>，所以这里 千万不要依赖 <code>starter-web</code></p> <p><strong>注意：</strong> 由于过滤器等功能依然需要 Servlet 支持，故这里还需要依赖 <code>javax.servlet:javax.servlet-api</code></p></blockquote> <h4 id="application-4"><a href="#application-4" class="header-anchor">#</a> Application</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>package com.funtl.myshop.plus.gateway;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.DiscoveryClient;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;
import org.springframework.cloud.gateway.discovery.DiscoveryClientRouteDefinitionLocator;
import org.springframework.cloud.gateway.discovery.DiscoveryLocatorProperties;
import org.springframework.cloud.gateway.route.RouteDefinitionLocator;
import org.springframework.context.annotation.Bean;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.HttpStatus;
import org.springframework.http.codec.ServerCodecConfigurer;
import org.springframework.http.codec.support.DefaultServerCodecConfigurer;
import org.springframework.http.server.reactive.ServerHttpRequest;
import org.springframework.http.server.reactive.ServerHttpResponse;
import org.springframework.web.cors.reactive.CorsUtils;
import org.springframework.web.server.ServerWebExchange;
import org.springframework.web.server.WebFilter;
import org.springframework.web.server.WebFilterChain;
import reactor.core.publisher.Mono;
/**
 * Spring Cloud Gateway
 * &lt;p&gt;
 * Description:
 * &lt;/p&gt;
 *
 * @author Lusifer
 * @version v1.0.0
 * @date 2019-08-01 11:14:35
 * @see com.funtl.myshop.plus.gateway
 */
@SpringBootApplication
@EnableDiscoveryClient
public class GatewayApplication {
    // ----------------------------- 解决跨域 Begin -----------------------------
    private static final String ALL = &quot;*&quot;;
    private static final String MAX_AGE = &quot;3600L&quot;;
    @Bean
    public RouteDefinitionLocator discoveryClientRouteDefinitionLocator(DiscoveryClient discoveryClient, DiscoveryLocatorProperties properties) {
        return new DiscoveryClientRouteDefinitionLocator(discoveryClient, properties);
    }
    @Bean
    public ServerCodecConfigurer serverCodecConfigurer() {
        return new DefaultServerCodecConfigurer();
    }
    @Bean
    public WebFilter corsFilter() {
        return (ServerWebExchange ctx, WebFilterChain chain) -&gt; {
            ServerHttpRequest request = ctx.getRequest();
            if (!CorsUtils.isCorsRequest(request)) {
                return chain.filter(ctx);
            }
            HttpHeaders requestHeaders = request.getHeaders();
            ServerHttpResponse response = ctx.getResponse();
            HttpMethod requestMethod = requestHeaders.getAccessControlRequestMethod();
            HttpHeaders headers = response.getHeaders();
            headers.add(HttpHeaders.ACCESS_CONTROL_ALLOW_ORIGIN, requestHeaders.getOrigin());
            headers.addAll(HttpHeaders.ACCESS_CONTROL_ALLOW_HEADERS, requestHeaders.getAccessControlRequestHeaders());
            if (requestMethod != null) {
                headers.add(HttpHeaders.ACCESS_CONTROL_ALLOW_METHODS, requestMethod.name());
            }
            headers.add(HttpHeaders.ACCESS_CONTROL_ALLOW_CREDENTIALS, &quot;true&quot;);
            headers.add(HttpHeaders.ACCESS_CONTROL_EXPOSE_HEADERS, ALL);
            headers.add(HttpHeaders.ACCESS_CONTROL_MAX_AGE, MAX_AGE);
            if (request.getMethod() == HttpMethod.OPTIONS) {
                response.setStatusCode(HttpStatus.OK);
                return Mono.empty();
            }
            return chain.filter(ctx);
        };
    }
    // ----------------------------- 解决跨域 End -----------------------------
    public static void main(String[] args) {
        SpringApplication.run(GatewayApplication.class, args);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div><h4 id="application-yml-4"><a href="#application-yml-4" class="header-anchor">#</a> application.yml</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>base:
  config:
    nacos:
      hostname: nacos.funtl.com
      port: 80
spring:
  application:
    # 应用名称
    name: gateway
  main:
    allow-bean-definition-overriding: true
  cloud:
    # 使用 Nacos 作为服务注册发现
    nacos:
      discovery:
        server-addr: ${base.config.nacos.hostname}:${base.config.nacos.port}
    # 路由网关配置
    gateway:
      # 设置与服务注册发现组件结合，这样可以采用服务名的路由策略
      discovery:
        locator:
          enabled: true
      # 配置路由规则
      routes:
        # 采用自定义路由 ID（有固定用法，不同的 id 有不同的功能，详见：https://cloud.spring.io/spring-cloud-gateway/2.0.x/single/spring-cloud-gateway.html#gateway-route-filters）
        - id: BUSINESS-OAUTH2
          # 采用 LoadBalanceClient 方式请求，以 lb:// 开头，后面的是注册在 Nacos 上的服务名
          uri: lb://business-oauth2
          # Predicate 翻译过来是“谓词”的意思，必须，主要作用是匹配用户的请求，有很多种用法
          predicates:
            # 路径匹配，以 api 开头，直接配置是不生效的，看 filters 配置
            - Path=/api/user/**
          filters:
            # 前缀过滤，默认配置下，我们的请求路径是 http://localhost:8888/business-oauth2/** 这时会路由到指定的服务
            # 此处配置去掉 1 个路径前缀，再配置上面的 Path=/api/**，就能按照 http://localhost:8888/api/** 的方式访问了
            - StripPrefix=1
        - id: BUSINESS-PROFILE
          uri: lb://business-profile
          predicates:
            - Path=/api/profile/**
          filters:
            - StripPrefix=1
server:
  port: 8888
# 配置日志级别，方别调试
logging:
  level:
    org.springframework.cloud.gateway: debug
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>此时网关请求登录接口路径如：<a href="http://localhost:8888/api/user/login" target="_blank" rel="noopener noreferrer">http://localhost:8888/api/user/login<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <blockquote><p><strong>注意：</strong> 由于之前的 <code>RestController</code> 代码中使用了 <code>@CrossOrigin(value = &quot;*&quot;, maxAge = 3600)</code> 注解解决跨域问题，此时我们的网关已经一并处理了跨域请将之前的注解删除，否则会报 <code>The 'Access-Control-Allow-Origin' header contains multiple values '*, *', but only one is allowed.</code> 错误，表示配置了多个跨域</p></blockquote> <h2 id="myshopplus-番外-更新版本号"><a href="#myshopplus-番外-更新版本号" class="header-anchor">#</a> MyShopPlus 番外-更新版本号</h2> <h3 id="概述-10"><a href="#概述-10" class="header-anchor">#</a> 概述</h3> <p><strong>Spring Cloud Alibaba 已于 2019 年 7 月 30 日</strong> 从 Spring Cloud 孵化器中正式毕业并迎来了毕业的第一个版本，孵化器中的 Spring Cloud Alibaba 仓库迁移回 Alibaba 官方仓库，进行正式的毕业发布，对原有使用 Spring Cloud Alibaba 开发的项目比较大的影响是 <strong>更新了 Maven 坐标</strong>，在此我们需要将坐标同步顺便将已更新的版本一同更新，具体变更内容请参考 <a href="http://www.qfdmy.com/wp-content/themes/quanbaike/go.php?url=aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvc3ByaW5nLWNsb3VkLWFsaWJhYmEvaXNzdWVzLzczNA==" target="_blank" rel="noopener noreferrer">Update package name &amp; maven coordinates<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="工程"><a href="#工程" class="header-anchor">#</a> 工程</h3> <ul><li><strong>更新 Spring Boot (2.1.6.RELEASE -&gt; 2.1.7.RELEASE)</strong></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.1.7.RELEASE&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
    &lt;artifactId&gt;parent&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;
    &lt;url&gt;http://www.funtl.com&lt;/url&gt;
    &lt;modules&gt;
        &lt;module&gt;dependencies&lt;/module&gt;
        &lt;module&gt;commons&lt;/module&gt;
        &lt;module&gt;configuration&lt;/module&gt;
        &lt;module&gt;provider&lt;/module&gt;
        &lt;module&gt;business&lt;/module&gt;
        &lt;module&gt;gateway&lt;/module&gt;
    &lt;/modules&gt;
    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
        &lt;maven.compiler.source&gt;${java.version}&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;${java.version}&lt;/maven.compiler.target&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;
    &lt;/properties&gt;
    &lt;licenses&gt;
        &lt;license&gt;
            &lt;name&gt;Apache 2.0&lt;/name&gt;
            &lt;url&gt;https://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt;
        &lt;/license&gt;
    &lt;/licenses&gt;
    &lt;developers&gt;
        &lt;developer&gt;
            &lt;id&gt;liwemin&lt;/id&gt;
            &lt;name&gt;Lusifer Lee&lt;/name&gt;
            &lt;email&gt;lee.lusifer@gmail.com&lt;/email&gt;
        &lt;/developer&gt;
    &lt;/developers&gt;
    &lt;dependencyManagement&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
                &lt;artifactId&gt;dependencies&lt;/artifactId&gt;
                &lt;version&gt;${project.version}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;
    &lt;profiles&gt;
        &lt;profile&gt;
            &lt;id&gt;default&lt;/id&gt;
            &lt;activation&gt;
                &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
            &lt;/activation&gt;
            &lt;properties&gt;
                &lt;spring-javaformat.version&gt;0.0.12&lt;/spring-javaformat.version&gt;
            &lt;/properties&gt;
            &lt;build&gt;
                &lt;plugins&gt;
                    &lt;plugin&gt;
                        &lt;groupId&gt;io.spring.javaformat&lt;/groupId&gt;
                        &lt;artifactId&gt;spring-javaformat-maven-plugin&lt;/artifactId&gt;
                        &lt;version&gt;${spring-javaformat.version}&lt;/version&gt;
                    &lt;/plugin&gt;
                    &lt;plugin&gt;
                        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                        &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
                        &lt;version&gt;3.0.0-M3&lt;/version&gt;
                        &lt;configuration&gt;
                            &lt;!-- 设置默认跳过测试 --&gt;
                            &lt;skip&gt;true&lt;/skip&gt;
                            &lt;includes&gt;
                                &lt;include&gt;**/*Tests.java&lt;/include&gt;
                            &lt;/includes&gt;
                            &lt;excludes&gt;
                                &lt;exclude&gt;**/Abstract*.java&lt;/exclude&gt;
                            &lt;/excludes&gt;
                            &lt;systemPropertyVariables&gt;
                                &lt;java.security.egd&gt;file:/dev/./urandom&lt;/java.security.egd&gt;
                                &lt;java.awt.headless&gt;true&lt;/java.awt.headless&gt;
                            &lt;/systemPropertyVariables&gt;
                        &lt;/configuration&gt;
                    &lt;/plugin&gt;
                    &lt;plugin&gt;
                        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                        &lt;artifactId&gt;maven-enforcer-plugin&lt;/artifactId&gt;
                        &lt;version&gt;1.4.1&lt;/version&gt;
                        &lt;executions&gt;
                            &lt;execution&gt;
                                &lt;id&gt;enforce-rules&lt;/id&gt;
                                &lt;goals&gt;
                                    &lt;goal&gt;enforce&lt;/goal&gt;
                                &lt;/goals&gt;
                                &lt;configuration&gt;
                                    &lt;rules&gt;
                                        &lt;bannedDependencies&gt;
                                            &lt;excludes&gt;
                                                &lt;exclude&gt;commons-logging:*:*&lt;/exclude&gt;
                                            &lt;/excludes&gt;
                                            &lt;searchTransitive&gt;true&lt;/searchTransitive&gt;
                                        &lt;/bannedDependencies&gt;
                                    &lt;/rules&gt;
                                    &lt;fail&gt;true&lt;/fail&gt;
                                &lt;/configuration&gt;
                            &lt;/execution&gt;
                        &lt;/executions&gt;
                    &lt;/plugin&gt;
                    &lt;plugin&gt;
                        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                        &lt;artifactId&gt;maven-install-plugin&lt;/artifactId&gt;
                        &lt;configuration&gt;
                            &lt;skip&gt;true&lt;/skip&gt;
                        &lt;/configuration&gt;
                    &lt;/plugin&gt;
                    &lt;plugin&gt;
                        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                        &lt;artifactId&gt;maven-javadoc-plugin&lt;/artifactId&gt;
                        &lt;configuration&gt;
                            &lt;skip&gt;true&lt;/skip&gt;
                        &lt;/configuration&gt;
                        &lt;inherited&gt;true&lt;/inherited&gt;
                    &lt;/plugin&gt;
                &lt;/plugins&gt;
            &lt;/build&gt;
        &lt;/profile&gt;
    &lt;/profiles&gt;
    &lt;repositories&gt;
        &lt;repository&gt;
            &lt;id&gt;spring-milestone&lt;/id&gt;
            &lt;name&gt;Spring Milestone&lt;/name&gt;
            &lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt;
            &lt;snapshots&gt;
                &lt;enabled&gt;false&lt;/enabled&gt;
            &lt;/snapshots&gt;
        &lt;/repository&gt;
        &lt;repository&gt;
            &lt;id&gt;spring-snapshot&lt;/id&gt;
            &lt;name&gt;Spring Snapshot&lt;/name&gt;
            &lt;url&gt;https://repo.spring.io/snapshot&lt;/url&gt;
            &lt;snapshots&gt;
                &lt;enabled&gt;true&lt;/enabled&gt;
            &lt;/snapshots&gt;
        &lt;/repository&gt;
    &lt;/repositories&gt;
    &lt;pluginRepositories&gt;
        &lt;pluginRepository&gt;
            &lt;id&gt;spring-milestone&lt;/id&gt;
            &lt;name&gt;Spring Milestone&lt;/name&gt;
            &lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt;
            &lt;snapshots&gt;
                &lt;enabled&gt;false&lt;/enabled&gt;
            &lt;/snapshots&gt;
        &lt;/pluginRepository&gt;
        &lt;pluginRepository&gt;
            &lt;id&gt;spring-snapshot&lt;/id&gt;
            &lt;name&gt;Spring Snapshot&lt;/name&gt;
            &lt;url&gt;https://repo.spring.io/snapshot&lt;/url&gt;
            &lt;snapshots&gt;
                &lt;enabled&gt;true&lt;/enabled&gt;
            &lt;/snapshots&gt;
        &lt;/pluginRepository&gt;
    &lt;/pluginRepositories&gt;
&lt;/project&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br></div></div><h3 id="依赖管理项目"><a href="#依赖管理项目" class="header-anchor">#</a> 依赖管理项目</h3> <ul><li><strong>更新 OKHttp3 (4.0.1 -&gt; 4.1.0)</strong></li> <li><strong>更新 Dubbo (2.7.2 -&gt; 2.7.3)</strong></li> <li><strong>更新 Spring Cloud (Greenwich.RELEASE -&gt; Greenwich.SR2)</strong></li> <li><strong>更新 Spring Cloud Alibaba (0.9.0.RELEASE -&gt; 2.1.0.RELEASE)</strong></li> <li><strong>更新 Alibaba 相关坐标，调整 Maven 结构</strong></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
    &lt;artifactId&gt;dependencies&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;
    &lt;url&gt;http://www.funtl.com&lt;/url&gt;
    &lt;properties&gt;
        &lt;!-- Commons --&gt;
        &lt;okhttp3.version&gt;4.1.0&lt;/okhttp3.version&gt;
        &lt;feign-okhttp.version&gt;10.3.0&lt;/feign-okhttp.version&gt;
        &lt;!-- Native Cloud --&gt;
        &lt;dubbo.version&gt;2.7.3&lt;/dubbo.version&gt;
        &lt;dubbo-nacos.version&gt;1.1.3&lt;/dubbo-nacos.version&gt;
        &lt;spring-boot-mapper.version&gt;2.1.5&lt;/spring-boot-mapper.version&gt;
        &lt;spring-cloud.version&gt;Greenwich.SR2&lt;/spring-cloud.version&gt;
        &lt;spring-cloud-alibaba.verion&gt;2.1.0.RELEASE&lt;/spring-cloud-alibaba.verion&gt;
        &lt;alibaba-spring-context-support.version&gt;1.0.2&lt;/alibaba-spring-context-support.version&gt;
    &lt;/properties&gt;
    &lt;licenses&gt;
        &lt;license&gt;
            &lt;name&gt;Apache 2.0&lt;/name&gt;
            &lt;url&gt;https://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt;
        &lt;/license&gt;
    &lt;/licenses&gt;
    &lt;developers&gt;
        &lt;developer&gt;
            &lt;id&gt;liwemin&lt;/id&gt;
            &lt;name&gt;Lusifer Lee&lt;/name&gt;
            &lt;email&gt;lee.lusifer@gmail.com&lt;/email&gt;
        &lt;/developer&gt;
    &lt;/developers&gt;
    &lt;dependencyManagement&gt;
        &lt;dependencies&gt;
            &lt;!-- Spring Cloud --&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
                &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
                &lt;version&gt;${spring-cloud.version}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
            &lt;!-- Spring Cloud Alibaba --&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
                &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt;
                &lt;version&gt;${spring-cloud-alibaba.verion}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
            &lt;!-- Apache Dubbo --&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;
                &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;
                &lt;version&gt;${dubbo-nacos.version}&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
                &lt;artifactId&gt;dubbo-registry-nacos&lt;/artifactId&gt;
                &lt;version&gt;${dubbo.version}&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
                &lt;artifactId&gt;dubbo-spring-boot-actuator&lt;/artifactId&gt;
                &lt;version&gt;${dubbo.version}&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
                &lt;artifactId&gt;dubbo&lt;/artifactId&gt;
                &lt;version&gt;${dubbo.version}&lt;/version&gt;
                &lt;exclusions&gt;
                    &lt;exclusion&gt;
                        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
                        &lt;artifactId&gt;spring&lt;/artifactId&gt;
                    &lt;/exclusion&gt;
                    &lt;exclusion&gt;
                        &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
                        &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
                    &lt;/exclusion&gt;
                    &lt;exclusion&gt;
                        &lt;groupId&gt;log4j&lt;/groupId&gt;
                        &lt;artifactId&gt;log4j&lt;/artifactId&gt;
                    &lt;/exclusion&gt;
                &lt;/exclusions&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
                &lt;artifactId&gt;dubbo-serialization-kryo&lt;/artifactId&gt;
                &lt;version&gt;${dubbo.version}&lt;/version&gt;
                &lt;exclusions&gt;
                    &lt;exclusion&gt;
                        &lt;groupId&gt;log4j&lt;/groupId&gt;
                        &lt;artifactId&gt;log4j&lt;/artifactId&gt;
                    &lt;/exclusion&gt;
                    &lt;exclusion&gt;
                        &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
                        &lt;artifactId&gt;dubbo-common&lt;/artifactId&gt;
                    &lt;/exclusion&gt;
                &lt;/exclusions&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.alibaba.spring&lt;/groupId&gt;
                &lt;artifactId&gt;spring-context-support&lt;/artifactId&gt;
                &lt;version&gt;${alibaba-spring-context-support.version}&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;!-- DataSource --&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.zaxxer&lt;/groupId&gt;
                &lt;artifactId&gt;HikariCP&lt;/artifactId&gt;
                &lt;version&gt;${hikaricp.version}&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;
                &lt;exclusions&gt;
                    &lt;!-- 排除 tomcat-jdbc 以使用 HikariCP --&gt;
                    &lt;exclusion&gt;
                        &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;
                        &lt;artifactId&gt;tomcat-jdbc&lt;/artifactId&gt;
                    &lt;/exclusion&gt;
                &lt;/exclusions&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;tk.mybatis&lt;/groupId&gt;
                &lt;artifactId&gt;mapper-spring-boot-starter&lt;/artifactId&gt;
                &lt;version&gt;${spring-boot-mapper.version}&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;!-- Commons --&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.squareup.okhttp3&lt;/groupId&gt;
                &lt;artifactId&gt;okhttp&lt;/artifactId&gt;
                &lt;version&gt;${okhttp3.version}&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt;
                &lt;artifactId&gt;feign-okhttp&lt;/artifactId&gt;
                &lt;version&gt;${feign-okhttp.version}&lt;/version&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;
    &lt;repositories&gt;
        &lt;repository&gt;
            &lt;id&gt;spring-milestone&lt;/id&gt;
            &lt;name&gt;Spring Milestone&lt;/name&gt;
            &lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt;
            &lt;snapshots&gt;
                &lt;enabled&gt;false&lt;/enabled&gt;
            &lt;/snapshots&gt;
        &lt;/repository&gt;
        &lt;repository&gt;
            &lt;id&gt;spring-snapshot&lt;/id&gt;
            &lt;name&gt;Spring Snapshot&lt;/name&gt;
            &lt;url&gt;https://repo.spring.io/snapshot&lt;/url&gt;
            &lt;snapshots&gt;
                &lt;enabled&gt;true&lt;/enabled&gt;
            &lt;/snapshots&gt;
        &lt;/repository&gt;
    &lt;/repositories&gt;
    &lt;pluginRepositories&gt;
        &lt;pluginRepository&gt;
            &lt;id&gt;spring-milestone&lt;/id&gt;
            &lt;name&gt;Spring Milestone&lt;/name&gt;
            &lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt;
            &lt;snapshots&gt;
                &lt;enabled&gt;false&lt;/enabled&gt;
            &lt;/snapshots&gt;
        &lt;/pluginRepository&gt;
        &lt;pluginRepository&gt;
            &lt;id&gt;spring-snapshot&lt;/id&gt;
            &lt;name&gt;Spring Snapshot&lt;/name&gt;
            &lt;url&gt;https://repo.spring.io/snapshot&lt;/url&gt;
            &lt;snapshots&gt;
                &lt;enabled&gt;true&lt;/enabled&gt;
            &lt;/snapshots&gt;
        &lt;/pluginRepository&gt;
    &lt;/pluginRepositories&gt;
&lt;/project&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br></div></div><h3 id="网关服务"><a href="#网关服务" class="header-anchor">#</a> 网关服务</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
        &lt;artifactId&gt;parent&lt;/artifactId&gt;
        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;artifactId&gt;gateway&lt;/artifactId&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;
    &lt;url&gt;http://www.funtl.com&lt;/url&gt;
    &lt;inceptionYear&gt;2018-Now&lt;/inceptionYear&gt;
    &lt;licenses&gt;
        &lt;license&gt;
            &lt;name&gt;Apache 2.0&lt;/name&gt;
            &lt;url&gt;https://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt;
        &lt;/license&gt;
    &lt;/licenses&gt;
    &lt;developers&gt;
        &lt;developer&gt;
            &lt;id&gt;liwemin&lt;/id&gt;
            &lt;name&gt;Lusifer Lee&lt;/name&gt;
            &lt;email&gt;lee.lusifer@gmail.com&lt;/email&gt;
        &lt;/developer&gt;
    &lt;/developers&gt;
    &lt;dependencies&gt;
        &lt;!-- Spring Boot --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;!-- Spring Cloud --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- Spring Cloud Alibaba --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- Commons --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
            &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;mainClass&gt;com.funtl.myshop.plus.gateway.GatewayApplication&lt;/mainClass&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br></div></div><h3 id="用户管理服务提供者"><a href="#用户管理服务提供者" class="header-anchor">#</a> 用户管理服务提供者</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
        &lt;artifactId&gt;provider&lt;/artifactId&gt;
        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;artifactId&gt;ums-admin-provider-service&lt;/artifactId&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;
    &lt;url&gt;http://www.funtl.com&lt;/url&gt;
    &lt;inceptionYear&gt;2018-Now&lt;/inceptionYear&gt;
    &lt;licenses&gt;
        &lt;license&gt;
            &lt;name&gt;Apache 2.0&lt;/name&gt;
            &lt;url&gt;https://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt;
        &lt;/license&gt;
    &lt;/licenses&gt;
    &lt;developers&gt;
        &lt;developer&gt;
            &lt;id&gt;liwemin&lt;/id&gt;
            &lt;name&gt;Lusifer Lee&lt;/name&gt;
            &lt;email&gt;lee.lusifer@gmail.com&lt;/email&gt;
        &lt;/developer&gt;
    &lt;/developers&gt;
    &lt;dependencies&gt;
        &lt;!-- Spring Boot --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;!-- Spring Cloud --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-oauth2&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- Apache Dubbo --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;
            &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-registry-nacos&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-spring-boot-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo&lt;/artifactId&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
                    &lt;artifactId&gt;spring&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
                    &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;log4j&lt;/groupId&gt;
                    &lt;artifactId&gt;log4j&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-serialization-kryo&lt;/artifactId&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;log4j&lt;/groupId&gt;
                    &lt;artifactId&gt;log4j&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
                    &lt;artifactId&gt;dubbo-common&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.spring&lt;/groupId&gt;
            &lt;artifactId&gt;spring-context-support&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- DataSource --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.zaxxer&lt;/groupId&gt;
            &lt;artifactId&gt;HikariCP&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;
            &lt;exclusions&gt;
                &lt;!-- 排除 tomcat-jdbc 以使用 HikariCP --&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;
                    &lt;artifactId&gt;tomcat-jdbc&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;tk.mybatis&lt;/groupId&gt;
            &lt;artifactId&gt;mapper-spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- Projects --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
            &lt;artifactId&gt;ums-admin-provider-api&lt;/artifactId&gt;
            &lt;version&gt;${project.parent.version}&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;mainClass&gt;com.funtl.myshop.plus.provider.UmsAdminProviderApplication&lt;/mainClass&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br></div></div><h3 id="注册服务"><a href="#注册服务" class="header-anchor">#</a> 注册服务</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
        &lt;artifactId&gt;business&lt;/artifactId&gt;
        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;artifactId&gt;business-reg&lt;/artifactId&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;
    &lt;url&gt;http://www.funtl.com&lt;/url&gt;
    &lt;inceptionYear&gt;2018-Now&lt;/inceptionYear&gt;
    &lt;licenses&gt;
        &lt;license&gt;
            &lt;name&gt;Apache 2.0&lt;/name&gt;
            &lt;url&gt;https://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt;
        &lt;/license&gt;
    &lt;/licenses&gt;
    &lt;developers&gt;
        &lt;developer&gt;
            &lt;id&gt;liwemin&lt;/id&gt;
            &lt;name&gt;Lusifer Lee&lt;/name&gt;
            &lt;email&gt;lee.lusifer@gmail.com&lt;/email&gt;
        &lt;/developer&gt;
    &lt;/developers&gt;
    &lt;dependencies&gt;
        &lt;!-- Spring Boot --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;!-- Spring Cloud Alibaba --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- Apache Dubbo --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;
            &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-registry-nacos&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-spring-boot-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo&lt;/artifactId&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
                    &lt;artifactId&gt;spring&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
                    &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;log4j&lt;/groupId&gt;
                    &lt;artifactId&gt;log4j&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-serialization-kryo&lt;/artifactId&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;log4j&lt;/groupId&gt;
                    &lt;artifactId&gt;log4j&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
                    &lt;artifactId&gt;dubbo-common&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.spring&lt;/groupId&gt;
            &lt;artifactId&gt;spring-context-support&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- Projects --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
            &lt;artifactId&gt;commons-dto&lt;/artifactId&gt;
            &lt;version&gt;${project.parent.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
            &lt;artifactId&gt;ums-admin-provider-api&lt;/artifactId&gt;
            &lt;version&gt;${project.parent.version}&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;mainClass&gt;com.funtl.myshop.plus.business.BusinessRegApplication&lt;/mainClass&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br></div></div><h3 id="认证服务"><a href="#认证服务" class="header-anchor">#</a> 认证服务</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
        &lt;artifactId&gt;business&lt;/artifactId&gt;
        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;artifactId&gt;business-oauth2&lt;/artifactId&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;
    &lt;url&gt;http://www.funtl.com&lt;/url&gt;
    &lt;inceptionYear&gt;2018-Now&lt;/inceptionYear&gt;
    &lt;licenses&gt;
        &lt;license&gt;
            &lt;name&gt;Apache 2.0&lt;/name&gt;
            &lt;url&gt;https://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt;
        &lt;/license&gt;
    &lt;/licenses&gt;
    &lt;developers&gt;
        &lt;developer&gt;
            &lt;id&gt;liwemin&lt;/id&gt;
            &lt;name&gt;Lusifer Lee&lt;/name&gt;
            &lt;email&gt;lee.lusifer@gmail.com&lt;/email&gt;
        &lt;/developer&gt;
    &lt;/developers&gt;
    &lt;dependencies&gt;
        &lt;!-- Spring Boot --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;!-- Spring Cloud --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-oauth2&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- Spring Cloud Alibaba --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- Apache Dubbo --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;
            &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-registry-nacos&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-spring-boot-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo&lt;/artifactId&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
                    &lt;artifactId&gt;spring&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
                    &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;log4j&lt;/groupId&gt;
                    &lt;artifactId&gt;log4j&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-serialization-kryo&lt;/artifactId&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;log4j&lt;/groupId&gt;
                    &lt;artifactId&gt;log4j&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
                    &lt;artifactId&gt;dubbo-common&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.spring&lt;/groupId&gt;
            &lt;artifactId&gt;spring-context-support&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- Commons --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.squareup.okhttp3&lt;/groupId&gt;
            &lt;artifactId&gt;okhttp&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt;
            &lt;artifactId&gt;feign-okhttp&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- Projects --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
            &lt;artifactId&gt;commons-dto&lt;/artifactId&gt;
            &lt;version&gt;${project.parent.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
            &lt;artifactId&gt;commons-utils&lt;/artifactId&gt;
            &lt;version&gt;${project.parent.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
            &lt;artifactId&gt;configuration-feign&lt;/artifactId&gt;
            &lt;version&gt;${project.parent.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
            &lt;artifactId&gt;business-profile-feign&lt;/artifactId&gt;
            &lt;version&gt;${project.parent.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
            &lt;artifactId&gt;ums-admin-provider-api&lt;/artifactId&gt;
            &lt;version&gt;${project.parent.version}&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;mainClass&gt;com.funtl.myshop.plus.business.BusinessOAuth2Application&lt;/mainClass&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br></div></div><h3 id="个人信息服务"><a href="#个人信息服务" class="header-anchor">#</a> 个人信息服务</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
        &lt;artifactId&gt;business-profile&lt;/artifactId&gt;
        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;artifactId&gt;business-profile-service&lt;/artifactId&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;
    &lt;url&gt;http://www.funtl.com&lt;/url&gt;
    &lt;inceptionYear&gt;2018-Now&lt;/inceptionYear&gt;
    &lt;licenses&gt;
        &lt;license&gt;
            &lt;name&gt;Apache 2.0&lt;/name&gt;
            &lt;url&gt;https://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt;
        &lt;/license&gt;
    &lt;/licenses&gt;
    &lt;developers&gt;
        &lt;developer&gt;
            &lt;id&gt;liwemin&lt;/id&gt;
            &lt;name&gt;Lusifer Lee&lt;/name&gt;
            &lt;email&gt;lee.lusifer@gmail.com&lt;/email&gt;
        &lt;/developer&gt;
    &lt;/developers&gt;
    &lt;dependencies&gt;
        &lt;!-- Spring Boot --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;!-- Spring Cloud --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-oauth2&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- Spring Cloud Alibaba --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- Apache Dubbo --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;
            &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-registry-nacos&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-spring-boot-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo&lt;/artifactId&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
                    &lt;artifactId&gt;spring&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
                    &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;log4j&lt;/groupId&gt;
                    &lt;artifactId&gt;log4j&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-serialization-kryo&lt;/artifactId&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;log4j&lt;/groupId&gt;
                    &lt;artifactId&gt;log4j&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
                    &lt;artifactId&gt;dubbo-common&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.spring&lt;/groupId&gt;
            &lt;artifactId&gt;spring-context-support&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- Projects --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
            &lt;artifactId&gt;commons-dto&lt;/artifactId&gt;
            &lt;version&gt;${project.parent.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
            &lt;artifactId&gt;business-profile-feign&lt;/artifactId&gt;
            &lt;version&gt;${project.parent.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.funtl.myshop.plus&lt;/groupId&gt;
            &lt;artifactId&gt;ums-admin-provider-api&lt;/artifactId&gt;
            &lt;version&gt;${project.parent.version}&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;mainClass&gt;com.funtl.myshop.plus.business.BusinessProfileApplication&lt;/mainClass&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br></div></div></div> <footer class="page-edit" style="display:none;"><!----> <!----></footer> <!----> <!----></main> <!----> <div class="comments-wrapper" data-v-4698c43e><!----></div></div></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-a81d141e data-v-a81d141e><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-a81d141e><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-a81d141e></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-a81d141e></path></svg></div></div></div>
    <script src="/assets/js/app.20e080e3.js" defer></script><script src="/assets/js/3.69b4042a.js" defer></script><script src="/assets/js/1.c4c6ad86.js" defer></script><script src="/assets/js/41.79742567.js" defer></script>
  </body>
</html>
