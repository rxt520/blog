<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kubernetes教程 | blog</title>
    <meta name="description" content="blog">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="/favicon.ico">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.29b4407c.css" as="style"><link rel="preload" href="/assets/js/app.20e080e3.js" as="script"><link rel="preload" href="/assets/js/3.69b4042a.js" as="script"><link rel="preload" href="/assets/js/1.c4c6ad86.js" as="script"><link rel="preload" href="/assets/js/17.6a344db1.js" as="script"><link rel="prefetch" href="/assets/js/10.fbf5bf0b.js"><link rel="prefetch" href="/assets/js/11.89c72eac.js"><link rel="prefetch" href="/assets/js/12.8f3fc90e.js"><link rel="prefetch" href="/assets/js/13.606381d5.js"><link rel="prefetch" href="/assets/js/14.7a61181a.js"><link rel="prefetch" href="/assets/js/15.2595a1ba.js"><link rel="prefetch" href="/assets/js/16.3a0abb52.js"><link rel="prefetch" href="/assets/js/18.4bf78878.js"><link rel="prefetch" href="/assets/js/19.8f00e0c6.js"><link rel="prefetch" href="/assets/js/20.260311cc.js"><link rel="prefetch" href="/assets/js/21.8578208c.js"><link rel="prefetch" href="/assets/js/22.20e75bd8.js"><link rel="prefetch" href="/assets/js/23.363521a2.js"><link rel="prefetch" href="/assets/js/24.15a014dc.js"><link rel="prefetch" href="/assets/js/25.f74701fe.js"><link rel="prefetch" href="/assets/js/26.9805c56f.js"><link rel="prefetch" href="/assets/js/27.c059cd71.js"><link rel="prefetch" href="/assets/js/28.04fb7d74.js"><link rel="prefetch" href="/assets/js/29.b1ef7687.js"><link rel="prefetch" href="/assets/js/30.5fb4a460.js"><link rel="prefetch" href="/assets/js/31.860de359.js"><link rel="prefetch" href="/assets/js/32.d40511a0.js"><link rel="prefetch" href="/assets/js/33.abe76948.js"><link rel="prefetch" href="/assets/js/34.c95627c4.js"><link rel="prefetch" href="/assets/js/35.884b7ac2.js"><link rel="prefetch" href="/assets/js/36.ce4ffc06.js"><link rel="prefetch" href="/assets/js/37.ed7666d7.js"><link rel="prefetch" href="/assets/js/38.6efa9d7f.js"><link rel="prefetch" href="/assets/js/39.ff98a367.js"><link rel="prefetch" href="/assets/js/4.295bb786.js"><link rel="prefetch" href="/assets/js/40.040344ed.js"><link rel="prefetch" href="/assets/js/41.79742567.js"><link rel="prefetch" href="/assets/js/42.bea47c85.js"><link rel="prefetch" href="/assets/js/43.14107803.js"><link rel="prefetch" href="/assets/js/44.f793a44c.js"><link rel="prefetch" href="/assets/js/45.293deda9.js"><link rel="prefetch" href="/assets/js/46.025ac826.js"><link rel="prefetch" href="/assets/js/47.9857334e.js"><link rel="prefetch" href="/assets/js/48.4d7aeb19.js"><link rel="prefetch" href="/assets/js/5.6ab23509.js"><link rel="prefetch" href="/assets/js/6.a01c80cf.js"><link rel="prefetch" href="/assets/js/7.6ced6a0e.js"><link rel="prefetch" href="/assets/js/8.3a631268.js"><link rel="prefetch" href="/assets/js/9.09f4064e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.29b4407c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container" data-v-4698c43e><div data-v-4698c43e><div id="loader-wrapper" class="loading-wrapper" data-v-4b73742e data-v-4698c43e data-v-4698c43e><div class="loader-main" data-v-4b73742e><div data-v-4b73742e></div><div data-v-4b73742e></div><div data-v-4b73742e></div><div data-v-4b73742e></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-6cbeab0a data-v-4698c43e data-v-4698c43e><h3 class="title" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a>blog</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><input type="password" value="" data-v-6cbeab0a> <span data-v-6cbeab0a>Konck! Knock!</span> <button data-v-6cbeab0a>OK</button></label> <div class="footer" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><span data-v-6cbeab0a><i class="iconfont reco-theme" data-v-6cbeab0a></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-6cbeab0a>vuePress-theme-reco</a></span> <span data-v-6cbeab0a><i class="iconfont reco-copyright" data-v-6cbeab0a></i> <a data-v-6cbeab0a><span data-v-6cbeab0a>blog</span>
            
          <span data-v-6cbeab0a>2019 - </span>
          2020
        </a></span></div></div> <div class="hide" data-v-4698c43e><header class="navbar" data-v-4698c43e><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="blog" class="logo"> <span class="site-name">blog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Linux/" class="nav-link"><i class="iconfont undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/categories/java/" class="nav-link"><i class="iconfont undefined"></i>
  java
</a></li><li class="dropdown-item"><!----> <a href="/categories/java 后端/" class="nav-link"><i class="iconfont undefined"></i>
  java 后端
</a></li><li class="dropdown-item"><!----> <a href="/categories/typora/" class="nav-link"><i class="iconfont undefined"></i>
  typora
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue/" class="nav-link"><i class="iconfont undefined"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/categories/java 基础/" class="nav-link"><i class="iconfont undefined"></i>
  java 基础
</a></li><li class="dropdown-item"><!----> <a href="/categories/编程方法/" class="nav-link"><i class="iconfont undefined"></i>
  编程方法
</a></li><li class="dropdown-item"><!----> <a href="/categories/Mysql/" class="nav-link"><i class="iconfont undefined"></i>
  Mysql
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-npm"></i>
      在线工具
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://smallpdf.com/cn/pdf-to-word" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  PDF 转换器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.bejson.com/jsoneditoronline" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  JSON 编辑器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://tableconvert.com/?output=text" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  MD 表格生成器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://cron.qqe2.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  CRON 表达式
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://tool.oschina.net/codeformat/html" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  代码格式化
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://zh.numberempire.com/latexequationeditor.php" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  公式编辑器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://cli.im/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  二维码生成器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://tool.chinaz.com/tools/native_ascii.aspx" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  在线编码转换
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.toyaml.com" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  YAML &lt;-&gt; Properties
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://jsfiddle.net/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  在线 Web 练习
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.github.com/rxt520" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/views/%E6%8C%87%E5%8D%97/Linux/.html" class="nav-link"><i class="iconfont reco-jianshu"></i>
  简书
</a></li><li class="dropdown-item"><!----> <a href="/views/%E6%8C%87%E5%8D%97/Linux/.html" class="nav-link"><i class="iconfont reco-csdn"></i>
  CSDN
</a></li><li class="dropdown-item"><!----> <a href="/views/%E6%8C%87%E5%8D%97/Linux/.html" class="nav-link"><i class="iconfont reco-bokeyuan"></i>
  博客圆
</a></li><li class="dropdown-item"><!----> <a href="/views/%E6%8C%87%E5%8D%97/Linux/.html" class="nav-link"><i class="iconfont reco-wechat"></i>
  WeChat
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-4698c43e></div> <aside class="sidebar" data-v-4698c43e><div class="personal-info-wrapper" data-v-6c8ffc9c><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-6c8ffc9c> <h3 class="name" data-v-6c8ffc9c>
    blog
  </h3> <div class="num" data-v-6c8ffc9c><div data-v-6c8ffc9c><h3 data-v-6c8ffc9c>23</h3> <h6 data-v-6c8ffc9c>文章</h6></div> <div data-v-6c8ffc9c><h3 data-v-6c8ffc9c>16</h3> <h6 data-v-6c8ffc9c>标签</h6></div></div> <hr data-v-6c8ffc9c></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Linux/" class="nav-link"><i class="iconfont undefined"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/categories/java/" class="nav-link"><i class="iconfont undefined"></i>
  java
</a></li><li class="dropdown-item"><!----> <a href="/categories/java 后端/" class="nav-link"><i class="iconfont undefined"></i>
  java 后端
</a></li><li class="dropdown-item"><!----> <a href="/categories/typora/" class="nav-link"><i class="iconfont undefined"></i>
  typora
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue/" class="nav-link"><i class="iconfont undefined"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/categories/java 基础/" class="nav-link"><i class="iconfont undefined"></i>
  java 基础
</a></li><li class="dropdown-item"><!----> <a href="/categories/编程方法/" class="nav-link"><i class="iconfont undefined"></i>
  编程方法
</a></li><li class="dropdown-item"><!----> <a href="/categories/Mysql/" class="nav-link"><i class="iconfont undefined"></i>
  Mysql
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-npm"></i>
      在线工具
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://smallpdf.com/cn/pdf-to-word" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  PDF 转换器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.bejson.com/jsoneditoronline" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  JSON 编辑器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://tableconvert.com/?output=text" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  MD 表格生成器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://cron.qqe2.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  CRON 表达式
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://tool.oschina.net/codeformat/html" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  代码格式化
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://zh.numberempire.com/latexequationeditor.php" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  公式编辑器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://cli.im/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  二维码生成器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://tool.chinaz.com/tools/native_ascii.aspx" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  在线编码转换
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.toyaml.com" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  YAML &lt;-&gt; Properties
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://jsfiddle.net/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  在线 Web 练习
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.github.com/rxt520" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/views/%E6%8C%87%E5%8D%97/Linux/.html" class="nav-link"><i class="iconfont reco-jianshu"></i>
  简书
</a></li><li class="dropdown-item"><!----> <a href="/views/%E6%8C%87%E5%8D%97/Linux/.html" class="nav-link"><i class="iconfont reco-csdn"></i>
  CSDN
</a></li><li class="dropdown-item"><!----> <a href="/views/%E6%8C%87%E5%8D%97/Linux/.html" class="nav-link"><i class="iconfont reco-bokeyuan"></i>
  博客圆
</a></li><li class="dropdown-item"><!----> <a href="/views/%E6%8C%87%E5%8D%97/Linux/.html" class="nav-link"><i class="iconfont reco-wechat"></i>
  WeChat
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Kubernetes教程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#kubernetes-简介" class="sidebar-link">Kubernetes 简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#特点" class="sidebar-link">特点</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#从传统到容器化部署" class="sidebar-link">从传统到容器化部署</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#为什么需要-kubernetes" class="sidebar-link">为什么需要 Kubernetes</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#kubernetes-安装前的准备" class="sidebar-link">Kubernetes 安装前的准备</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#概述-2" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#节点配置" class="sidebar-link">节点配置</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#统一环境配置" class="sidebar-link">统一环境配置</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#单独节点配置" class="sidebar-link">单独节点配置</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#kubernetes-安装集群" class="sidebar-link">Kubernetes 安装集群</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#概述-3" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#创建并修改配置" class="sidebar-link">创建并修改配置</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#查看所需镜像" class="sidebar-link">查看所需镜像</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#拉取所需镜像" class="sidebar-link">拉取所需镜像</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#安装主节点" class="sidebar-link">安装主节点</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#安装从节点" class="sidebar-link">安装从节点</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#附：扩展阅读" class="sidebar-link">附：扩展阅读</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#kubernetes-配置网络" class="sidebar-link">Kubernetes 配置网络</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#概述-4" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#什么是-cni" class="sidebar-link">什么是 CNI</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#kubernetes-中的-cni-插件" class="sidebar-link">Kubernetes 中的 CNI 插件</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#什么是-calico" class="sidebar-link">什么是 Calico</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#下载-calico-配置文件并修改" class="sidebar-link">下载 Calico 配置文件并修改</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#安装网络插件-calico" class="sidebar-link">安装网络插件 Calico</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#验证安装是否成功" class="sidebar-link">验证安装是否成功</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#kubernetes-第一个容器" class="sidebar-link">Kubernetes 第一个容器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#检查组件运行状态" class="sidebar-link">检查组件运行状态</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#检查-master-状态" class="sidebar-link">检查 Master 状态</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#检查-nodes-状态" class="sidebar-link">检查 Nodes 状态</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#运行第一个容器实例" class="sidebar-link">运行第一个容器实例</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#查看全部-pods-的状态" class="sidebar-link">查看全部 Pods 的状态</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#查看已部署的服务" class="sidebar-link">查看已部署的服务</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#发布服务" class="sidebar-link">发布服务</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#查看已发布的服务" class="sidebar-link">查看已发布的服务</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#查看服务详情" class="sidebar-link">查看服务详情</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#验证是否成功-3" class="sidebar-link">验证是否成功</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#停止服务" class="sidebar-link">停止服务</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#kubernetes-概念总结" class="sidebar-link">Kubernetes 概念总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#什么是-kubernetes" class="sidebar-link">什么是 Kubernetes</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#kubernetes-master" class="sidebar-link">Kubernetes Master</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#kubernetes-node" class="sidebar-link">Kubernetes Node</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#kubernetes-架构" class="sidebar-link">Kubernetes 架构</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#kubernetes-通过资源配置运行容器" class="sidebar-link">Kubernetes 通过资源配置运行容器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#概述-5" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#创建-yaml-配置文件" class="sidebar-link">创建 YAML 配置文件</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#验证是否生效" class="sidebar-link">验证是否生效</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#集成环境部署" class="sidebar-link">集成环境部署</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#附：扩展阅读-2" class="sidebar-link">附：扩展阅读</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#kubernetes-ingress-简介" class="sidebar-link">Kubernetes Ingress 简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#术语" class="sidebar-link">术语</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#内部访问方式-clusterip" class="sidebar-link">内部访问方式 ClusterIP</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#三种外部访问方式" class="sidebar-link">三种外部访问方式</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#什么是-ingress" class="sidebar-link">什么是 Ingress</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#nginx-虚拟主机" class="sidebar-link">Nginx 虚拟主机</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#什么是-nginx" class="sidebar-link">什么是 Nginx</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#nginx-的应用场景" class="sidebar-link">Nginx 的应用场景</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#nginx-虚拟主机-2" class="sidebar-link">Nginx 虚拟主机</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#基于-docker-部署-nginx" class="sidebar-link">基于 Docker 部署 Nginx</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#nginx-反向代理" class="sidebar-link">Nginx 反向代理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#什么是代理服务器" class="sidebar-link">什么是代理服务器</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#为什么要使用代理服务器" class="sidebar-link">为什么要使用代理服务器</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#什么是正向代理" class="sidebar-link">什么是正向代理</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#什么是反向代理" class="sidebar-link">什么是反向代理</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#反向代理有哪些主要应用" class="sidebar-link">反向代理有哪些主要应用</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#使用-nginx-反向代理-tomcat" class="sidebar-link">使用 Nginx 反向代理 Tomcat</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#nginx-负载均衡" class="sidebar-link">Nginx 负载均衡</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#什么是负载均衡" class="sidebar-link">什么是负载均衡</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#nginx-实现负载均衡" class="sidebar-link">Nginx 实现负载均衡</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#相关配置说明" class="sidebar-link">相关配置说明</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#nginx-ingress-controller" class="sidebar-link">Nginx Ingress Controller</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#概述-6" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#安装-ingress" class="sidebar-link">安装 Ingress</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#部署-ingress" class="sidebar-link">部署 Ingress</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#部署-tomcat" class="sidebar-link">部署 Tomcat</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#验证是否成功-4" class="sidebar-link">验证是否成功</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#kubernetes-准备数据卷" class="sidebar-link">Kubernetes 准备数据卷</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#概述-7" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#什么是-nfs" class="sidebar-link">什么是 NFS</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#安装-nfs-服务端" class="sidebar-link">安装 NFS 服务端</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#安装-nfs-客户端" class="sidebar-link">安装 NFS 客户端</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#验证-nfs-服务" class="sidebar-link">验证 NFS 服务</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#取消-nfs-客户端挂载" class="sidebar-link">取消 NFS 客户端挂载</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#kubernetes-使用数据卷" class="sidebar-link">Kubernetes 使用数据卷</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#概述-8" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#pv-与-pvc" class="sidebar-link">PV 与 PVC</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#定义-pv" class="sidebar-link">定义 PV</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#定义-pvc" class="sidebar-link">定义 PVC</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#部署-mysql8" class="sidebar-link">部署 MySQL8</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#kubernetes-configmap" class="sidebar-link">Kubernetes ConfigMap</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#概述-9" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#使用-configmap-配置-mysql" class="sidebar-link">使用 ConfigMap 配置 MySQL</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#kubernetes-dashboard" class="sidebar-link">Kubernetes Dashboard</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#概述-10" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#访问" class="sidebar-link">访问</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#登录" class="sidebar-link">登录</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#使用-kuboard-替代-kubernetes-dashboard" class="sidebar-link">使用 Kuboard 替代 Kubernetes Dashboard</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#概述-11" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#什么是-kuboard" class="sidebar-link">什么是 Kuboard</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#安装-kuboard" class="sidebar-link">安装 Kuboard</a></li><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#为什么使用-kuboard" class="sidebar-link">为什么使用 Kuboard</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#k8s踩坑日记" class="sidebar-link">k8s踩坑日记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#不支持-api模式不再支持" class="sidebar-link">不支持 api模式不再支持</a></li></ul></li><li><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#k8s常用命令" class="sidebar-link">k8s常用命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/%E6%8C%87%E5%8D%97/Linux/Kubernetes%20%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html#kubernetes常用命令" class="sidebar-link">kubernetes常用命令</a></li></ul></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-6cbeab0a data-v-4698c43e><h3 class="title" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a>Kubernetes教程</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><input type="password" value="" data-v-6cbeab0a> <span data-v-6cbeab0a>Konck! Knock!</span> <button data-v-6cbeab0a>OK</button></label> <div class="footer" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><span data-v-6cbeab0a><i class="iconfont reco-theme" data-v-6cbeab0a></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-6cbeab0a>vuePress-theme-reco</a></span> <span data-v-6cbeab0a><i class="iconfont reco-copyright" data-v-6cbeab0a></i> <a data-v-6cbeab0a><span data-v-6cbeab0a>blog</span>
            
          <span data-v-6cbeab0a>2019 - </span>
          2020
        </a></span></div></div> <div data-v-4698c43e><main class="page"><!----> <div class="page-title" style="display:none;"><h1>Kubernetes教程</h1> <hr> <div data-v-484a899e><i class="iconfont reco-account" data-v-484a899e><span data-v-484a899e>blog</span></i> <i class="iconfont reco-date" data-v-484a899e><span data-v-484a899e>2019-10-20</span></i> <!----> <i class="iconfont reco-tag tags" data-v-484a899e><span class="tag-item" data-v-484a899e>
      Kubernetes
    </span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><h1 id="kubernetes"><a href="#kubernetes" class="header-anchor">#</a> Kubernetes</h1> <h2 id="kubernetes-简介"><a href="#kubernetes-简介" class="header-anchor">#</a> Kubernetes 简介</h2> <h3 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h3> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/fa0e1e144c783fa.png" alt="img"></p> <p>Kubernetes 是 <strong>Google 2014 年创建管理的</strong>，是 Google 10 多年大规模容器管理技术 Borg 的开源版本。</p> <p>Kubernetes 是容器集群管理系统，是一个开源的平台，可以实现容器集群的自动化部署、自动扩缩容、维护等功能。使用 Kubernetes 我们可以：</p> <ul><li>快速部署应用</li> <li>快速扩展应用</li> <li>无缝对接新的应用功能</li> <li>节省资源，优化硬件资源的使用</li></ul> <p>Kubernetes 的目标是促进完善组件和工具的生态系统，以减轻应用程序在公有云或私有云中运行的负担。</p> <h3 id="特点"><a href="#特点" class="header-anchor">#</a> 特点</h3> <ul><li><strong>可移植：</strong> 支持公有云，私有云，混合云，多重云（多个公共云）</li> <li><strong>可扩展：</strong> 模块化，插件化，可挂载，可组合</li> <li><strong>自动化：</strong> 自动部署，自动重启，自动复制，自动伸缩/扩展</li></ul> <h3 id="从传统到容器化部署"><a href="#从传统到容器化部署" class="header-anchor">#</a> 从传统到容器化部署</h3> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/6bc0b5b348a5c5b.png" alt="img"></p> <h4 id="传统的部署方式"><a href="#传统的部署方式" class="header-anchor">#</a> 传统的部署方式</h4> <p>传统的应用部署方式是通过插件或脚本来安装应用。这样做的缺点是应用的运行、配置、管理、所有生存周期将与当前操作系统绑定，这样做并不利于应用的升级更新/回滚等操作，当然也可以通过创建虚机的方式来实现某些功能，但是虚拟机非常重，并不利于可移植性。</p> <h4 id="容器化部署的优势"><a href="#容器化部署的优势" class="header-anchor">#</a> 容器化部署的优势</h4> <ul><li><strong>快速创建/部署应用：</strong> 与虚拟机相比，容器镜像的创建更加容易。</li> <li><strong>持续开发、集成和部署：</strong> 提供可靠且频繁的容器镜像构建/部署，并使用快速和简单的回滚(由于镜像不可变性)。</li> <li><strong>开发和运行相分离：</strong> 在 build 或者 release 阶段创建容器镜像，使得应用和基础设施解耦。</li> <li><strong>开发，测试和生产环境一致性：</strong> 在本地或外网（生产环境）运行的一致性。</li> <li><strong>云平台或其他操作系统：</strong> 可以在 Ubuntu、RHEL、CoreOS、on-prem、Google Container Engine 或其它任何环境中运行。</li> <li><strong>分布式，弹性，微服务化：</strong> 应用程序分为更小的、独立的部件，可以动态部署和管理。</li> <li><strong>资源隔离</strong></li> <li><strong>资源利用更高效</strong></li></ul> <h3 id="为什么需要-kubernetes"><a href="#为什么需要-kubernetes" class="header-anchor">#</a> 为什么需要 Kubernetes</h3> <p>可以在物理或虚拟机的 Kubernetes 集群上运行容器化应用，Kubernetes 能提供一个以 <strong>“容器为中心的基础架构”</strong>，满足在生产环境中运行应用的一些常见需求，如：</p> <ul><li>多个进程协同工作</li> <li>存储系统挂载</li> <li>应用健康检查</li> <li>应用实例的复制</li> <li>自动伸缩/扩展</li> <li>注册与发现</li> <li>负载均衡</li> <li>滚动更新</li> <li>资源监控</li> <li>日志访问</li> <li>调试应用程序</li> <li>提供认证和授权</li></ul> <h2 id="kubernetes-安装前的准备"><a href="#kubernetes-安装前的准备" class="header-anchor">#</a> Kubernetes 安装前的准备</h2> <h3 id="概述-2"><a href="#概述-2" class="header-anchor">#</a> 概述</h3> <p>本次安装采用 Ubuntu Server X64 18.04 LTS 版本安装 kubernetes 集群环境，集群节点为 1 主 2 从模式，此次对虚拟机会有些基本要求，如下：</p> <ul><li>OS：Ubuntu Server X64 18.04 LTS（16.04 版本步骤相同，再之前则不同）</li> <li>CPU：最低要求，1 CPU 2 核</li> <li>内存：最低要求，2 GB</li> <li>磁盘：最低要求，20 GB</li></ul> <h3 id="节点配置"><a href="#节点配置" class="header-anchor">#</a> 节点配置</h3> <table><thead><tr><th style="text-align:left;">主机名</th> <th style="text-align:left;">IP</th> <th style="text-align:left;">角色</th> <th style="text-align:left;">系统</th> <th style="text-align:left;">CPU/内存</th> <th style="text-align:left;">磁盘</th></tr></thead> <tbody><tr><td style="text-align:left;">kubernetes-master</td> <td style="text-align:left;">192.168.141.110</td> <td style="text-align:left;">Master</td> <td style="text-align:left;">Ubuntu Server 18.04</td> <td style="text-align:left;">2 核 2G</td> <td style="text-align:left;">20G</td></tr> <tr><td style="text-align:left;">kubernetes-node-01</td> <td style="text-align:left;">192.168.141.120</td> <td style="text-align:left;">Node</td> <td style="text-align:left;">Ubuntu Server 18.04</td> <td style="text-align:left;">2 核 4G</td> <td style="text-align:left;">20G</td></tr> <tr><td style="text-align:left;">kubernetes-node-02</td> <td style="text-align:left;">192.168.141.121</td> <td style="text-align:left;">Node</td> <td style="text-align:left;">Ubuntu Server 18.04</td> <td style="text-align:left;">2 核 4G</td> <td style="text-align:left;">20G</td></tr></tbody></table> <h3 id="统一环境配置"><a href="#统一环境配置" class="header-anchor">#</a> 统一环境配置</h3> <blockquote><p><strong>注意：</strong> 以下步骤请在制作 VMware 镜像时一并完成，避免逐台安装的痛苦</p></blockquote> <h4 id="关闭交换空间"><a href="#关闭交换空间" class="header-anchor">#</a> 关闭交换空间</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>swapoff -a
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="避免开机启动交换空间"><a href="#避免开机启动交换空间" class="header-anchor">#</a> 避免开机启动交换空间</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code># 注释 swap 开头的行vi /etc/fstab
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="关闭防火墙"><a href="#关闭防火墙" class="header-anchor">#</a> 关闭防火墙</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>ufw disable
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="配置-dns"><a href="#配置-dns" class="header-anchor">#</a> 配置 DNS</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code># 取消 DNS 行注释，并增加 DNS 配置如：114.114.114.114，修改后重启下计算机
vi /etc/systemd/resolved.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="安装-docker"><a href="#安装-docker" class="header-anchor">#</a> 安装 Docker</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code># 更新软件源
sudo apt-get update
# 安装所需依赖
sudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common
# 安装 GPG 证书
curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -
# 新增软件源信息
sudo add-apt-repository &quot;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable&quot;
# 再次更新软件源
sudo apt-get -y update
# 安装 Docker CE 版
sudo apt-get -y install docker-ce
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="配置-docker-加速器"><a href="#配置-docker-加速器" class="header-anchor">#</a> 配置 Docker 加速器</h4> <blockquote><p><strong>注意：</strong> 国内镜像加速器可能会很卡，请替换成你自己阿里云镜像加速器，地址如：<code>https://yourself.mirror.aliyuncs.com</code>，在阿里云控制台的 <strong>容器镜像服务 -&gt; 镜像加速器</strong> 菜单中可以找到</p></blockquote> <p>在 <code>/etc/docker/daemon.json</code> 中写入如下内容（以下配置修改 <code>cgroup</code> 驱动为 <code>systemd</code>，满足 K8S 建议）</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],
  &quot;log-driver&quot;: &quot;json-file&quot;,
  &quot;log-opts&quot;: {
    &quot;max-size&quot;: &quot;100m&quot;
  },
  &quot;registry-mirrors&quot;: [
    &quot;https://yjrxjjt7.mirror.aliyuncs.com&quot;,
    &quot;https://dockerhub.azk8s.cn&quot;,
    &quot;https://registry.docker-cn.com&quot;
  ],
  &quot;storage-driver&quot;: &quot;overlay2&quot;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="安装-kubernetes-必备工具"><a href="#安装-kubernetes-必备工具" class="header-anchor">#</a> 安装 Kubernetes 必备工具</h4> <p>安装三个 Kubernetes 必备工具，分别为 <strong>kubeadm</strong>，<strong>kubelet</strong>，<strong>kubectl</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 安装系统工具
apt-get update &amp;&amp; apt-get install -y apt-transport-https
# 安装 GPG 证书
curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add -
# 写入软件源；注意：我们用系统代号为 bionic，但目前阿里云不支持，所以沿用 16.04 的 xenial
cat &lt;&lt; EOF &gt;/etc/apt/sources.list.d/kubernetes.list
deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main
EOF
# 安装
apt-get update &amp;&amp; apt-get install -y kubelet kubeadm kubectl
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="同步时间"><a href="#同步时间" class="header-anchor">#</a> 同步时间</h4> <ul><li><strong>设置时区</strong></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>dpkg-reconfigure tzdata
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>选择 <strong>Asia（亚洲）</strong></li></ul> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/fff634856c3091d.png" alt="img"></p> <ul><li>选择 <strong>Shanghai（上海）</strong></li></ul> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/db85d9068a86cb9.png" alt="img"></p> <ul><li><strong>时间同步</strong></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># 安装 ntpdate
apt-get install ntpdate
# 设置系统时间与网络时间同步（cn.pool.ntp.org 位于中国的公共 NTP 服务器）
ntpdate cn.pool.ntp.org
# 将系统时间写入硬件时间
hwclock --systohc
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><strong>确认时间</strong></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>date
# 输出如下（自行对照与系统时间是否一致）
Sun Jun  2 22:02:35 CST 2019
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="修改-cloud-cfg"><a href="#修改-cloud-cfg" class="header-anchor">#</a> 修改 cloud.cfg</h4> <p>主要作用是防止重启后主机名还原</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>vi /etc/cloud/cloud.cfg
# 该配置默认为 false，修改为 true 即可
preserve_hostname: true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="单独节点配置"><a href="#单独节点配置" class="header-anchor">#</a> 单独节点配置</h3> <blockquote><p><strong>注意：</strong> 为 Master 和 Node 节点单独配置对应的 <strong>IP</strong> 和 <strong>主机名</strong></p></blockquote> <h4 id="配置-ip"><a href="#配置-ip" class="header-anchor">#</a> 配置 IP</h4> <p>编辑 <code>vi /etc/netplan/50-cloud-init.yaml</code> 配置文件，修改内容如下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubernetes-master
network:
    ethernets:
        ens33:
          addresses: [192.168.12.110/24]
          gateway4: 192.168.12.2
          nameservers:
            addresses: [192.168.12.2]
    version: 2
    
#kubernetes-node-01
network:
    ethernets:
        ens33:
          addresses: [192.168.12.120/24]
          gateway4: 192.168.12.2
          nameservers:
            addresses: [192.168.12.2]
    version: 2
    
#kubernetes-node-02
network:
    ethernets:
        ens33:
          addresses: [192.168.12.121/24]
          gateway4: 192.168.12.2
          nameservers:
            addresses: [192.168.12.2]
    version: 2
#kubernetes-node-03
network:
    ethernets:
        ens33:
          addresses: [192.168.12.122/24]
          gateway4: 192.168.12.2
          nameservers:
            addresses: [192.168.12.2]
    version: 2 
#kubernetes-volums
network:
    ethernets:
        ens33:
          addresses: [192.168.12.130/24]
          gateway4: 192.168.12.2
          nameservers:
            addresses: [192.168.12.2]
    version: 2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>使用 <code>netplan apply</code> 命令让配置生效</p> <h4 id="配置主机名"><a href="#配置主机名" class="header-anchor">#</a> 配置主机名</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>#kubernetes-master
# 修改主机名
hostnamectl set-hostname kubernetes-master
# 配置 hosts
cat &gt;&gt; /etc/hosts &lt;&lt; EOF
192.168.12.110 kubernetes-master
EOF

#kubernetes-node-01
# 修改主机名
hostnamectl set-hostname kubernetes-node-01
# 配置 hosts
cat &gt;&gt; /etc/hosts &lt;&lt; EOF
192.168.12.120 kubernetes-node-01
EOF

#kubernetes-node-02
# 修改主机名
hostnamectl set-hostname kubernetes-node-02
# 配置 hosts
cat &gt;&gt; /etc/hosts &lt;&lt; EOF
192.168.12.121 kubernetes-node-02
EOF

#kubernetes-node-03
# 修改主机名
hostnamectl set-hostname kubernetes-node-03
# 配置 hosts
cat &gt;&gt; /etc/hosts &lt;&lt; EOF
192.168.12.122 kubernetes-node-03
EOF

#kubernetes-volums
# 修改主机名
hostnamectl set-hostname kubernetes-volums
# 配置 hosts
cat &gt;&gt; /etc/hosts &lt;&lt; EOF
192.168.12.130 kubernetes-volums
EOF
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h2 id="kubernetes-安装集群"><a href="#kubernetes-安装集群" class="header-anchor">#</a> Kubernetes 安装集群</h2> <h3 id="概述-3"><a href="#概述-3" class="header-anchor">#</a> 概述</h3> <p>kubeadm 是 kubernetes 的集群安装工具，能够快速安装 kubernetes 集群，安装 kubernetes 主要是安装它的各个镜像，而 kubeadm 已经为我们集成好了运行 kubernetes 所需的基本镜像。但由于国内的网络原因，在搭建环境时，无法拉取到这些镜像。此时我们只需要修改为阿里云提供的镜像服务即可解决该问题。</p> <h3 id="创建并修改配置"><a href="#创建并修改配置" class="header-anchor">#</a> 创建并修改配置</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code># 导出配置文件
kubeadm config print init-defaults --kubeconfig ClusterConfiguration &gt; kubeadm.yml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>apiVersion: kubeadm.k8s.io/v1beta2
bootstrapTokens:
- groups:
  - system:bootstrappers:kubeadm:default-node-token
  token: abcdef.0123456789abcdef
  ttl: 24h0m0s
  usages:
  - signing
  - authentication
kind: InitConfiguration
localAPIEndpoint:
  # 修改为主节点 IP
  advertiseAddress: 192.168.12.110
  bindPort: 6443
nodeRegistration:
  criSocket: /var/run/dockershim.sock
  name: kubernetes-master
  taints:
  - effect: NoSchedule
    key: node-role.kubernetes.io/master
---
apiServer:
  timeoutForControlPlane: 4m0s
apiVersion: kubeadm.k8s.io/v1beta2
certificatesDir: /etc/kubernetes/pki
clusterName: kubernetes
controllerManager: {}
dns:
  type: CoreDNS
etcd:
  local:
    dataDir: /var/lib/etcd
# 国内不能访问 Google，修改为阿里云
imageRepository: registry.aliyuncs.com/google_containers
kind: ClusterConfiguration
# 修改版本号
kubernetesVersion: v1.15.0
networking:
  dnsDomain: cluster.local
  # 配置 POD 所在网段为我们虚拟机不重叠的网段（这里用的是 Flannel 默认网段）
  podSubnet: &quot;10.244.0.0/16&quot;
  serviceSubnet: 10.96.0.0/12
scheduler: {}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h3 id="查看所需镜像"><a href="#查看所需镜像" class="header-anchor">#</a> 查看所需镜像</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubeadm config images list --config kubeadm.yml
# 输出如下
registry.aliyuncs.com/google_containers/kube-apiserver:v1.15.0
registry.aliyuncs.com/google_containers/kube-controller-manager:v1.15.0
registry.aliyuncs.com/google_containers/kube-scheduler:v1.15.0
registry.aliyuncs.com/google_containers/kube-proxy:v1.15.0
registry.aliyuncs.com/google_containers/pause:3.1
registry.aliyuncs.com/google_containers/etcd:3.3.10
registry.aliyuncs.com/google_containers/coredns:1.3.1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="拉取所需镜像"><a href="#拉取所需镜像" class="header-anchor">#</a> 拉取所需镜像</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubeadm config images pull --config kubeadm.yml
# 输出如下
[config/images] Pulled registry.aliyuncs.com/google_containers/kube-apiserver:v1.15.0
[config/images] Pulled registry.aliyuncs.com/google_containers/kube-controller-manager:v1.15.0
[config/images] Pulled registry.aliyuncs.com/google_containers/kube-scheduler:v1.15.0
[config/images] Pulled registry.aliyuncs.com/google_containers/kube-proxy:v1.15.0
[config/images] Pulled registry.aliyuncs.com/google_containers/pause:3.1
[config/images] Pulled registry.aliyuncs.com/google_containers/etcd:3.3.10
[config/images] Pulled registry.aliyuncs.com/google_containers/coredns:1.3.1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="安装主节点"><a href="#安装主节点" class="header-anchor">#</a> 安装主节点</h3> <p>执行以下命令初始化主节点，该命令指定了初始化时需要使用的配置文件，其中添加 <code>--upload-certs</code> 参数可以在后续执行加入节点时自动分发证书文件。追加的 <code>tee kubeadm-init.log</code> 用以输出日志。</p> <blockquote><p><strong>注意：</strong> 如果安装 kubernetes 版本和下载的镜像版本不统一则会出现 <code>timed out waiting for the condition</code> 错误。中途失败或是想修改配置可以使用 <code>kubeadm reset</code> 命令重置配置，再做初始化操作即可。</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubeadm init --config=kubeadm.yml --upload-certs | tee kubeadm-init.log
# 输出如下
Flag --experimental-upload-certs has been deprecated, use --upload-certs instead
[init] Using Kubernetes version: v1.15.0
[preflight] Running pre-flight checks
        [WARNING IsDockerSystemdCheck]: detected &quot;cgroupfs&quot; as the Docker cgroup driver. The recommended driver is &quot;systemd&quot;. Please follow the guide at https://kubernetes.io/docs/setup/cri/
[preflight] Pulling images required for setting up a Kubernetes cluster
[preflight] This might take a minute or two, depending on the speed of your internet connection
[preflight] You can also perform this action in beforehand using 'kubeadm config images pull'
[kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;
[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;
[kubelet-start] Activating the kubelet service
[certs] Using certificateDir folder &quot;/etc/kubernetes/pki&quot;
[certs] Generating &quot;ca&quot; certificate and key
[certs] Generating &quot;apiserver-kubelet-client&quot; certificate and key
[certs] Generating &quot;apiserver&quot; certificate and key
[certs] apiserver serving cert is signed for DNS names [kubernetes-master kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 192.168.141.110]
[certs] Generating &quot;front-proxy-ca&quot; certificate and key
[certs] Generating &quot;front-proxy-client&quot; certificate and key
[certs] Generating &quot;etcd/ca&quot; certificate and key
[certs] Generating &quot;etcd/server&quot; certificate and key
[certs] etcd/server serving cert is signed for DNS names [kubernetes-master localhost] and IPs [192.168.141.110 127.0.0.1 ::1]
[certs] Generating &quot;apiserver-etcd-client&quot; certificate and key
[certs] Generating &quot;etcd/peer&quot; certificate and key
[certs] etcd/peer serving cert is signed for DNS names [kubernetes-master localhost] and IPs [192.168.141.110 127.0.0.1 ::1]
[certs] Generating &quot;etcd/healthcheck-client&quot; certificate and key
[certs] Generating &quot;sa&quot; key and public key
[kubeconfig] Using kubeconfig folder &quot;/etc/kubernetes&quot;
[kubeconfig] Writing &quot;admin.conf&quot; kubeconfig file
[kubeconfig] Writing &quot;kubelet.conf&quot; kubeconfig file
[kubeconfig] Writing &quot;controller-manager.conf&quot; kubeconfig file
[kubeconfig] Writing &quot;scheduler.conf&quot; kubeconfig file
[control-plane] Using manifest folder &quot;/etc/kubernetes/manifests&quot;
[control-plane] Creating static Pod manifest for &quot;kube-apiserver&quot;
[control-plane] Creating static Pod manifest for &quot;kube-controller-manager&quot;
[control-plane] Creating static Pod manifest for &quot;kube-scheduler&quot;
[etcd] Creating static Pod manifest for local etcd in &quot;/etc/kubernetes/manifests&quot;
[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory &quot;/etc/kubernetes/manifests&quot;. This can take up to 4m0s
[apiclient] All control plane components are healthy after 23.006217 seconds
[upload-config] Storing the configuration used in ConfigMap &quot;kubeadm-config&quot; in the &quot;kube-system&quot; Namespace
[kubelet] Creating a ConfigMap &quot;kubelet-config-1.15&quot; in namespace kube-system with the configuration for the kubelets in the cluster
[upload-certs] Storing the certificates in Secret &quot;kubeadm-certs&quot; in the &quot;kube-system&quot; Namespace
[upload-certs] Using certificate key:
4a351218cf34c15b04b08b7d916c27a625418145d8d3b281ec125fd2b2ac7ab5
[mark-control-plane] Marking the node kubernetes-master as control-plane by adding the label &quot;node-role.kubernetes.io/master=''&quot;
[mark-control-plane] Marking the node kubernetes-master as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule]
[bootstrap-token] Using token: abcdef.0123456789abcdef
[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials
[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster
[bootstrap-token] Creating the &quot;cluster-info&quot; ConfigMap in the &quot;kube-public&quot; namespace
[addons] Applied essential addon: CoreDNS
[addons] Applied essential addon: kube-proxy
Your Kubernetes control-plane has initialized successfully!
To start using your cluster, you need to run the following as a regular user:
  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config
You should now deploy a pod network to the cluster.
Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/
Then you can join any number of worker nodes by running the following on each as root:
kubeadm join 192.168.12.110:6443 --token abcdef.0123456789abcdef \
    --discovery-token-ca-cert-hash sha256:755175060aa59ee66637df437cf8d3b461ac403adaa6ab341f3ba28e26c79bef 
    
#生成的日志 cat kubeadm-init.log 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>kubeadm join 192.168.12.110:6443 --token abcdef.0123456789abcdef \
    --discovery-token-ca-cert-hash sha256:755175060aa59ee66637df437cf8d3b461ac403adaa6ab341f3ba28e26c79bef 
    
#将以上两句话复制到node 结点运行进行集群
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="配置-kubectl"><a href="#配置-kubectl" class="header-anchor">#</a> 配置 kubectl</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>mkdir -p $HOME/.kube
cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
# 非 ROOT 用户执行
chown $(id -u):$(id -g) $HOME/.kube/config
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="验证是否成功"><a href="#验证是否成功" class="header-anchor">#</a> 验证是否成功</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get node
# 输出如下
NAME                STATUS     ROLES    AGE     VERSION
kubernetes-master   NotReady   master   4m38s   v1.15.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="安装从节点"><a href="#安装从节点" class="header-anchor">#</a> 安装从节点</h3> <p>将 Node 节点加入到集群中很简单，只需要在 Node 服务器上安装 <strong>kubeadm</strong>，<strong>kubectl</strong>，<strong>kubelet</strong> 三个工具，然后使用 <code>kubeadm join</code> 命令加入即可</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#如果token 过期则重新获取
kubeadm token create

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>kubeadm join 192.168.12.110:6443 --token 51m7dx.x88i64jzhvavb91d \
    --discovery-token-ca-cert-hash sha256:755175060aa59ee66637df437cf8d3b461ac403adaa6ab341f3ba28e26c79bef 
# 输出如下
[preflight] Running pre-flight checks
        [WARNING IsDockerSystemdCheck]: detected &quot;cgroupfs&quot; as the Docker cgroup driver. The recommended driver is &quot;systemd&quot;. Please follow the guide at https://kubernetes.io/docs/setup/cri/
[preflight] Reading configuration from the cluster...
[preflight] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -oyaml'
[kubelet-start] Downloading configuration for the kubelet from the &quot;kubelet-config-1.15&quot; ConfigMap in the kube-system namespace
[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;
[kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;
[kubelet-start] Activating the kubelet service
[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...
This node has joined the cluster:
* Certificate signing request was sent to apiserver and a response was received.
* The Kubelet was informed of the new secure connection details.
Run 'kubectl get nodes' on the control-plane to see this node join the cluster.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="验证是否成功-2"><a href="#验证是否成功-2" class="header-anchor">#</a> 验证是否成功</h4> <p>回到 Master 主节点查看是否安装成功</p> <blockquote><p><strong>注意：</strong> 如果 Node 节点加入 Master 时配置有问题可以在 Node 节点上使用 <code>kubeadm reset</code> 重置配置再使用 <code>kubeadm join</code> 命令重新加入即可。希望在 master 节点删除 node ，可以使用 <code>kubectl delete nodes</code> 删除。</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get node
# 输出如下
NAME                 STATUS     ROLES    AGE   VERSION
kubernetes-master    NotReady   master   20m   v1.15.0
kubernetes-node-01   NotReady   &lt;none&gt;   16s   v1.15.0
kubernetes-node-02   NotReady   &lt;none&gt;   6s    v1.15.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="查看-pod-状态"><a href="#查看-pod-状态" class="header-anchor">#</a> 查看 Pod 状态</h4> <p>coredns 尚未运行，此时我们还需要安装网络插件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get pod -n kube-system -o wide
# 输出如下
NAME                                        READY   STATUS    RESTARTS   AGE     IP                NODE                 NOMINATED NODE   READINESS GATES
coredns-bccdc95cf-9s4bm                     0/1     Pending   0          24m     &lt;none&gt;            &lt;none&gt;               &lt;none&gt;           &lt;none&gt;
coredns-bccdc95cf-s8ggd                     0/1     Pending   0          24m     &lt;none&gt;            &lt;none&gt;               &lt;none&gt;           &lt;none&gt;
etcd-kubernetes-master                      1/1     Running   0          24m     192.168.141.110   kubernetes-master    &lt;none&gt;           &lt;none&gt;
kube-apiserver-kubernetes-master            1/1     Running   0          24m     192.168.141.110   kubernetes-master    &lt;none&gt;           &lt;none&gt;
kube-controller-manager-kubernetes-master   1/1     Running   0          23m     192.168.141.110   kubernetes-master    &lt;none&gt;           &lt;none&gt;
kube-proxy-8s87d                            1/1     Running   0          4m56s   192.168.141.120   kubernetes-node-01   &lt;none&gt;           &lt;none&gt;
kube-proxy-cbnlb                            1/1     Running   0          4m46s   192.168.141.121   kubernetes-node-02   &lt;none&gt;           &lt;none&gt;
kube-proxy-vwhxj                            1/1     Running   0          24m     192.168.141.110   kubernetes-master    &lt;none&gt;           &lt;none&gt;
kube-scheduler-kubernetes-master            1/1     Running   0          24m     192.168.141.110   kubernetes-master    &lt;none&gt;           &lt;none&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="附：扩展阅读"><a href="#附：扩展阅读" class="header-anchor">#</a> 附：扩展阅读</h3> <h4 id="kubeadm-init-的执行过程"><a href="#kubeadm-init-的执行过程" class="header-anchor">#</a> kubeadm init 的执行过程</h4> <ul><li><strong>init：</strong> 指定版本进行初始化操作</li> <li><strong>preflight：</strong> 初始化前的检查和下载所需要的 Docker 镜像文件</li> <li><strong>kubelet-start：</strong> 生成 kubelet 的配置文件 <code>var/lib/kubelet/config.yaml</code>，没有这个文件 kubelet 无法启动，所以初始化之前的 kubelet 实际上启动不会成功</li> <li><strong>certificates：</strong> 生成 Kubernetes 使用的证书，存放在 <code>/etc/kubernetes/pki</code> 目录中</li> <li><strong>kubeconfig：</strong> 生成 KubeConfig 文件，存放在 <code>/etc/kubernetes</code> 目录中，组件之间通信需要使用对应文件</li> <li><strong>control-plane：</strong> 使用 <code>/etc/kubernetes/manifest</code> 目录下的 YAML 文件，安装 Master 组件</li> <li><strong>etcd：</strong> 使用 <code>/etc/kubernetes/manifest/etcd.yaml</code> 安装 Etcd 服务</li> <li><strong>wait-control-plane：</strong> 等待 control-plan 部署的 Master 组件启动</li> <li><strong>apiclient：</strong> 检查 Master 组件服务状态。</li> <li><strong>uploadconfig：</strong> 更新配置</li> <li><strong>kubelet：</strong> 使用 configMap 配置 kubelet</li> <li><strong>patchnode：</strong> 更新 CNI 信息到 Node 上，通过注释的方式记录</li> <li><strong>mark-control-plane：</strong> 为当前节点打标签，打了角色 Master，和不可调度标签，这样默认就不会使用 Master 节点来运行 Pod</li> <li><strong>bootstrap-token：</strong> 生成 token 记录下来，后边使用 <code>kubeadm join</code> 往集群中添加节点时会用到</li> <li><strong>addons：</strong> 安装附加组件 CoreDNS 和 kube-proxy</li></ul> <h2 id="kubernetes-配置网络"><a href="#kubernetes-配置网络" class="header-anchor">#</a> Kubernetes 配置网络</h2> <h3 id="概述-4"><a href="#概述-4" class="header-anchor">#</a> 概述</h3> <p>容器网络是容器选择连接到其他容器、主机和外部网络的机制。容器的 runtime 提供了各种网络模式，每种模式都会产生不同的体验。例如，Docker 默认情况下可以为容器配置以下网络：</p> <ul><li><strong>none：</strong> 将容器添加到一个容器专门的网络堆栈中，没有对外连接。</li> <li><strong>host：</strong> 将容器添加到主机的网络堆栈中，没有隔离。</li> <li><strong>default bridge：</strong> 默认网络模式。每个容器可以通过 IP 地址相互连接。</li> <li><strong>自定义网桥：</strong> 用户定义的网桥，具有更多的灵活性、隔离性和其他便利功能。</li></ul> <h3 id="什么是-cni"><a href="#什么是-cni" class="header-anchor">#</a> 什么是 CNI</h3> <p>CNI(Container Network Interface) 是一个标准的，通用的接口。在容器平台，Docker，Kubernetes，Mesos 容器网络解决方案 flannel，calico，weave。只要提供一个标准的接口，就能为同样满足该协议的所有容器平台提供网络功能，而 CNI 正是这样的一个标准接口协议。</p> <h3 id="kubernetes-中的-cni-插件"><a href="#kubernetes-中的-cni-插件" class="header-anchor">#</a> Kubernetes 中的 CNI 插件</h3> <p>CNI 的初衷是创建一个框架，用于在配置或销毁容器时动态配置适当的网络配置和资源。插件负责为接口配置和管理 IP 地址，并且通常提供与 IP 管理、每个容器的 IP 分配、以及多主机连接相关的功能。容器运行时会调用网络插件，从而在容器启动时分配 IP 地址并配置网络，并在删除容器时再次调用它以清理这些资源。</p> <p>运行时或协调器决定了容器应该加入哪个网络以及它需要调用哪个插件。然后，插件会将接口添加到容器网络命名空间中，作为一个 veth 对的一侧。接着，它会在主机上进行更改，包括将 veth 的其他部分连接到网桥。再之后，它会通过调用单独的 IPAM（IP地址管理）插件来分配 IP 地址并设置路由。</p> <p>在 Kubernetes 中，kubelet 可以在适当的时间调用它找到的插件，为通过 kubelet 启动的 pod进行自动的网络配置。</p> <p>Kubernetes 中可选的 CNI 插件如下：</p> <ul><li>Flannel</li> <li>Calico</li> <li>Canal</li> <li>Weave</li></ul> <h3 id="什么是-calico"><a href="#什么是-calico" class="header-anchor">#</a> 什么是 Calico</h3> <p>Calico 为容器和虚拟机提供了安全的网络连接解决方案，并经过了大规模生产验证（在公有云和跨数千个集群节点中），可与 Kubernetes，OpenShift，Docker，Mesos，DC / OS 和 OpenStack 集成。</p> <p>Calico 还提供网络安全规则的动态实施。使用 Calico 的简单策略语言，您可以实现对容器，虚拟机工作负载和裸机主机端点之间通信的细粒度控制。</p> <h3 id="下载-calico-配置文件并修改"><a href="#下载-calico-配置文件并修改" class="header-anchor">#</a> 下载 Calico 配置文件并修改</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>wget https://docs.projectcalico.org/v3.8/manifests/calico.yaml
vi calico.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>修改第 611 行，将 <code>192.168.0.0/16</code> 修改为 <code>10.244.0.0/16</code>，可以通过如下命令快速查找</p> <ul><li>显示行号：<code>:set number</code></li> <li>查找字符：<code>/要查找的字符</code>，输入小写 <code>n</code> 下一个匹配项，输入大写 <code>N</code> 上一个匹配项</li></ul> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/f426d4f38ca346f.png" alt="img"></p> <h3 id="安装网络插件-calico"><a href="#安装网络插件-calico" class="header-anchor">#</a> 安装网络插件 Calico</h3> <blockquote><p><strong>注意：</strong> 截止到文章发表日期 2019 年 07 月 20 日，Calico 官方版本为 3.8</p></blockquote> <p>参考官方文档安装：<a href="http://www.qfdmy.com/wp-content/themes/quanbaike/go.php?url=aHR0cHM6Ly9kb2NzLnByb2plY3RjYWxpY28ub3JnL3YzLjgvZ2V0dGluZy1zdGFydGVkL2t1YmVybmV0ZXMv" target="_blank" rel="noopener noreferrer">https://docs.projectcalico.org/v3.8/getting-started/kubernetes/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl apply -f calico.yaml
# 输出如下
configmap/calico-config created
customresourcedefinition.apiextensions.k8s.io/felixconfigurations.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/ipamblocks.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/blockaffinities.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/ipamhandles.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/ipamconfigs.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/bgppeers.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/bgpconfigurations.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/ippools.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/hostendpoints.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/clusterinformations.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/globalnetworkpolicies.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/globalnetworksets.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/networkpolicies.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/networksets.crd.projectcalico.org created
clusterrole.rbac.authorization.k8s.io/calico-kube-controllers created
clusterrolebinding.rbac.authorization.k8s.io/calico-kube-controllers created
clusterrole.rbac.authorization.k8s.io/calico-node created
clusterrolebinding.rbac.authorization.k8s.io/calico-node created
daemonset.extensions/calico-node created
serviceaccount/calico-node created
deployment.extensions/calico-kube-controllers created
serviceaccount/calico-kube-controllers created
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="验证安装是否成功"><a href="#验证安装是否成功" class="header-anchor">#</a> 验证安装是否成功</h3> <ul><li>查看 Calico 网络插件处于 <strong>Running</strong> 状态即表示安装成功</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>watch kubectl get pods --all-namespaces
# 输出如下
NAMESPACE     NAME                                        READY   STATUS    RESTARTS   AGE
kube-system   calico-kube-controllers-658558ddf8-9zzjg    1/1     Running   0          90s
kube-system   calico-node-9cr5f                           1/1     Running   0          91s
kube-system   calico-node-n99mz                           1/1     Running   0          91s
kube-system   calico-node-nl67v                           1/1     Running   0          91s
kube-system   coredns-bccdc95cf-9s4bm                     1/1     Running   0          56m
kube-system   coredns-bccdc95cf-s8ggd                     1/1     Running   0          56m
kube-system   etcd-kubernetes-master                      1/1     Running   0          55m
kube-system   kube-apiserver-kubernetes-master            1/1     Running   0          55m
kube-system   kube-controller-manager-kubernetes-master   1/1     Running   0          55m
kube-system   kube-proxy-8s87d                            1/1     Running   0          36m
kube-system   kube-proxy-cbnlb                            1/1     Running   0          36m
kube-system   kube-proxy-vwhxj                            1/1     Running   0          56m
kube-system   kube-scheduler-kubernetes-master            1/1     Running   0          55m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li>查看节点状态处于 <strong>Ready</strong> 即表示安装成功</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get node
# 输出如下
NAME                 STATUS   ROLES    AGE   VERSION
kubernetes-master    Ready    master   57m   v1.15.0
kubernetes-node-01   Ready    &lt;none&gt;   37m   v1.15.0
kubernetes-node-02   Ready    &lt;none&gt;   36m   v1.15.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="kubernetes-第一个容器"><a href="#kubernetes-第一个容器" class="header-anchor">#</a> Kubernetes 第一个容器</h2> <h3 id="检查组件运行状态"><a href="#检查组件运行状态" class="header-anchor">#</a> 检查组件运行状态</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get cs
# 输出如下
NAME                 STATUS    MESSAGE             ERROR
# 调度服务，主要作用是将 POD 调度到 Node
scheduler            Healthy   ok
# 自动化修复服务，主要作用是 Node 宕机后自动修复 Node 回到正常的工作状态
controller-manager   Healthy   ok
# 服务注册与发现
etcd-0               Healthy   {&quot;health&quot;:&quot;true&quot;}  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="检查-master-状态"><a href="#检查-master-状态" class="header-anchor">#</a> 检查 Master 状态</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl cluster-info
# 输出如下
Kubernetes master is running at https://192.168.141.110:6443
KubeDNS is running at https://192.168.141.110:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="检查-nodes-状态"><a href="#检查-nodes-状态" class="header-anchor">#</a> 检查 Nodes 状态</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get nodes
# 输出如下
NAME                 STATUS   ROLES    AGE   VERSION
kubernetes-master    Ready    master   72m   v1.15.0
kubernetes-node-01   Ready    &lt;none&gt;   52m   v1.15.0
kubernetes-node-02   Ready    &lt;none&gt;   51m   v1.15.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="运行第一个容器实例"><a href="#运行第一个容器实例" class="header-anchor">#</a> 运行第一个容器实例</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code># 使用 kubectl 命令创建两个监听 80 端口的 Nginx Pod（Kubernetes 运行容器的最小单元）
kubectl run nginx --image=nginx --replicas=2 --port=80
# 输出如下
kubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead.
deployment.apps/nginx created
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="查看全部-pods-的状态"><a href="#查看全部-pods-的状态" class="header-anchor">#</a> 查看全部 Pods 的状态</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get pods
# 输出如下
NAME                     READY   STATUS    RESTARTS   AGE
nginx-7c45b84548-mv8n8   1/1     Running   0          36s
nginx-7c45b84548-vp2x6   1/1     Running   0          36s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="查看已部署的服务"><a href="#查看已部署的服务" class="header-anchor">#</a> 查看已部署的服务</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get deployment
# 输出如下
NAME    READY   UP-TO-DATE   AVAILABLE   AGE
nginx   2/2     2            2           70s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="发布服务"><a href="#发布服务" class="header-anchor">#</a> 发布服务</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code># 使用负载均衡模式发布服务，让用户可以访问
kubectl expose deployment nginx --port=80 --type=LoadBalancer
# 输出如下
service/nginx exposed
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="查看已发布的服务"><a href="#查看已发布的服务" class="header-anchor">#</a> 查看已发布的服务</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get services
# 输出如下
NAME         TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
kubernetes   ClusterIP      10.96.0.1       &lt;none&gt;        443/TCP        81m
nginx        LoadBalancer   10.102.37.240   &lt;pending&gt;     80:31406/TCP   115s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="查看服务详情"><a href="#查看服务详情" class="header-anchor">#</a> 查看服务详情</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl describe service nginx
# 输出如下
Name:                     nginx
Namespace:                default
Labels:                   run=nginx
Annotations:              &lt;none&gt;
Selector:                 run=nginx
Type:                     LoadBalancer
IP:                       10.102.37.240
Port:                     &lt;unset&gt;  80/TCP
TargetPort:               80/TCP
# 发布到外网的服务端口
NodePort:                 &lt;unset&gt;  31406/TCP
Endpoints:                192.168.140.66:80,192.168.141.194:80
Session Affinity:         None
External Traffic Policy:  Cluster
Events:                   &lt;none&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="验证是否成功-3"><a href="#验证是否成功-3" class="header-anchor">#</a> 验证是否成功</h3> <p>通过浏览器访问 Node 服务器，此时 Kubernetes 会以负载均衡的方式访问部署的 Nginx 服务，能够正常看到 Nginx 的欢迎页即表示成功</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>http://192.168.141.120:31406/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="停止服务"><a href="#停止服务" class="header-anchor">#</a> 停止服务</h3> <ul><li>删除已部署的服务</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl delete deployment nginx
# 输出如下
deployment.extensions &quot;nginx&quot; deleted
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>删除已发布的服务</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl delete service nginx
# 输出如下
service &quot;nginx&quot; deleted
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="kubernetes-概念总结"><a href="#kubernetes-概念总结" class="header-anchor">#</a> Kubernetes 概念总结</h2> <h3 id="什么是-kubernetes"><a href="#什么是-kubernetes" class="header-anchor">#</a> 什么是 Kubernetes</h3> <p>Kubernetes 是一个开源的 Docker 容器编排系统，它可以调度计算集群的节点，动态管理上面的作业，保证它们按用户期望的状态运行。通过使用「labels」和「pods」的概念，Kubernetes 将应用按逻辑单元进行分组，方便管理和服务发现。</p> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/43dea45523a841e.png" alt="img"></p> <ul><li><strong>pods：</strong> 是一组紧密关联的容器集合，它们共享 IPC(进程间通信)、Network(网络) 和 UTS namespace(UTS 命名空间是 Linux 命名空间的一个子系统，主要作用是完成对容器 Hostname 和 Domain 的隔离，同时保存内核名称、版本、以及底层体系结构类型等信息)，是 Kubernetes 调度的基本单位。</li> <li><strong>labels：</strong> 键值对(key/value)标签，可以被关联到如 Pod 这样的对象上，主要作用是给用户一个直观的感受，比如这个 Pod 是用来放置数据库的</li> <li><strong>GUI：</strong> 用户图形界面，可以是 Web 用户界面，比如使用 <code>kubernetes-dashboard</code> 组件，用户可以通过 Dashboard 在 Kubernetes 集群中部署容器化的应用，可以查看集群中应用的运行情况，同时也能够基于 Dashboard 创建或修改部署、任务、服务等 Kubernetes 的资源。通过部署向导，用户能够对部署进行扩缩容，进行滚动更新、重启 Pod 和部署新应用。当然，通过 Dashboard 也能够查看 Kubernetes 资源的状态</li> <li><strong>kubectl：</strong> 用于管理 Kubernetes 集群的命令行工具</li> <li><strong>kube-apiserver：</strong> 提供了资源操作的唯一入口，并提供认证、授权、访问控制、API 注册和发现等机制</li> <li><strong>Kubernetes Master：</strong> Kubernetes 集群主节点，主要由 <code>kube-apiserver</code>、<code>kube-scheduler</code>、<code>kube-controller-manager</code>、<code>etcd</code> 四个模块组成</li> <li><strong>Kubernetes Node：</strong> Kubernetes 集群子节点，主要由 <code>kubelet</code>、<code>kube-proxy</code>、<code>runtime</code> 三个模块组成</li> <li><strong>Image Registry：</strong> 镜像仓库，比如：Ducker HUB 或 Docker 私服</li></ul> <h3 id="kubernetes-master"><a href="#kubernetes-master" class="header-anchor">#</a> Kubernetes Master</h3> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/fa764f17a458dfa.png" alt="img"></p> <ul><li><strong>kube-apiserver：</strong> 提供了资源操作的唯一入口，并提供认证、授权、访问控制、API 注册和发现等机制</li> <li><strong>kube-scheduler：</strong> 负责资源的调度，按照预定的调度策略将 Pod 调度到相应的机器上</li> <li><strong>kube-controller-manager：</strong> 负责维护集群的状态，比如故障检测、自动扩展、滚动更新等</li> <li><strong>etcd：</strong> CoreOS 基于 Raft 开发的分布式 key-value 存储，可用于服务发现、共享配置以及一致性保障（如数据库选主、分布式锁等）</li></ul> <h3 id="kubernetes-node"><a href="#kubernetes-node" class="header-anchor">#</a> Kubernetes Node</h3> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/cff9bb5fe37f800.png" alt="img"></p> <ul><li><strong>runtime：</strong> 负责镜像管理以及 Pod 和容器的真正运行（CRI，Container Runtime Interface），默认的容器运行时为 Docker，还支持 RKT 容器</li> <li><strong>kubelet：</strong> 负责维持容器的生命周期，同时也负责 Volume（CVI，Container Volume Interface）和网络（CNI，Container Network Interface）的管理</li> <li><strong>kube-proxy：</strong> 负责为 Service 提供 cluster 内部的服务发现和负载均衡</li></ul> <h3 id="kubernetes-架构"><a href="#kubernetes-架构" class="header-anchor">#</a> Kubernetes 架构</h3> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/3d78d68032fc78f.png" alt="img"></p> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/3d7d2db329892e7.png" alt="img"></p> <h2 id="kubernetes-通过资源配置运行容器"><a href="#kubernetes-通过资源配置运行容器" class="header-anchor">#</a> Kubernetes 通过资源配置运行容器</h2> <h3 id="概述-5"><a href="#概述-5" class="header-anchor">#</a> 概述</h3> <p>我们知道通过 <code>run</code> 命令启动容器非常麻烦，Docker 提供了 Compose 为我们解决了这个问题。那 Kubernetes 是如何解决这个问题的呢？其实很简单，使用 <code>kubectl create</code> 命令就可以做到和 Compose 一样的效果了，该命令可以通过配置文件快速创建一个集群资源对象。</p> <h3 id="创建-yaml-配置文件"><a href="#创建-yaml-配置文件" class="header-anchor">#</a> 创建 YAML 配置文件</h3> <h4 id="部署-deployment"><a href="#部署-deployment" class="header-anchor">#</a> 部署 Deployment</h4> <p>创建一个名为 <code>nginx-deployment.yml</code> 的配置文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># API 版本号
apiVersion: apps/v1
# 类型，如：Pod/ReplicationController/Deployment/Service/Ingress
kind: Deployment
# 元数据
metadata:
  # Kind 的名称
  name: nginx-app
spec:
  selector:
    matchLabels:
      app: nginx
  # 部署的实例数量
  replicas: 2
  template:
    metadata:
      labels:
        # 容器标签的名字，发布 Service 时，selector 需要和这里对应
        app: nginx
    spec:
      # 配置容器，数组类型，说明可以配置多个容器
      containers:
      # 容器名称
      - name: nginx
        # 容器镜像
        image: nginx:1.17
        # 只有镜像不存在时，才会进行镜像拉取
        imagePullPolicy: IfNotPresent
        # 暴露端口
        ports:
        # Pod 端口
        - containerPort: 80
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h4 id="发布-service"><a href="#发布-service" class="header-anchor">#</a> 发布 Service</h4> <p>创建一个名为 <code>nginx-service.yml</code> 的配置文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># API 版本号
apiVersion: v1
# 类型，如：Pod/ReplicationController/Deployment/Service/Ingress
kind: Service
# 元数据
metadata:
  # Kind 的名称
  name: nginx-http
spec:
  # 暴露端口
  ports:
    ## Service 暴露的端口
    - port: 80
      ## Pod 上的端口，这里是将 Service 暴露的端口转发到 Pod 端口上
      targetPort: 80
  # 类型
  type: LoadBalancer
  # 标签选择器
  selector:
    # 需要和上面部署的 Deployment 标签名对应
    app: nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code># 部署
kubectl create -f nginx-service.yml
# 删除
kubectl delete -f nginx-service.yml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="镜像拉取策略"><a href="#镜像拉取策略" class="header-anchor">#</a> 镜像拉取策略</h4> <p>支持三种 ImagePullPolicy</p> <ul><li><strong>Always：</strong> 不管镜像是否存在都会进行一次拉取</li> <li><strong>Never：</strong> 不管镜像是否存在都不会进行拉取</li> <li><strong>IfNotPresent：</strong> 只有镜像不存在时，才会进行镜像拉取</li></ul> <p>注意</p> <ul><li>默认为 <code>IfNotPresent</code>，但 <code>:latest</code> 标签的镜像默认为 <code>Always</code></li> <li>拉取镜像时 Docker 会进行校验，如果镜像中的 MD5 码没有变，则不会拉取镜像数据</li> <li>生产环境中应该尽量避免使用 <code>:latest</code> 标签，而开发环境中可以借助 <code>:latest</code> 标签自动拉取最新的镜像</li></ul> <h3 id="验证是否生效"><a href="#验证是否生效" class="header-anchor">#</a> 验证是否生效</h3> <h4 id="查看-pod-列表"><a href="#查看-pod-列表" class="header-anchor">#</a> 查看 Pod 列表</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get pods
# 输出如下
NAME                         READY   STATUS    RESTARTS   AGE
nginx-app-64bb598779-2pplx   1/1     Running   0          25m
nginx-app-64bb598779-824lc   1/1     Running   0          25m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="查看-deployment-列表"><a href="#查看-deployment-列表" class="header-anchor">#</a> 查看 Deployment 列表</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get deployment
# 输出如下
NAME        READY   UP-TO-DATE   AVAILABLE   AGE
nginx-app   2/2     2            2           25m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="查看-service-列表"><a href="#查看-service-列表" class="header-anchor">#</a> 查看 Service 列表</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get service
# 输出如下
NAME         TYPE           CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE
kubernetes   ClusterIP      10.96.0.1      &lt;none&gt;        443/TCP        20h
nginx-http    LoadBalancer   10.98.49.142   &lt;pending&gt;     80:31631/TCP   14m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="查看-service-详情"><a href="#查看-service-详情" class="header-anchor">#</a> 查看 Service 详情</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl describe service nginx-app
# 输出如下
Name:                     nginx-http
Namespace:                default
Labels:                   &lt;none&gt;
Annotations:              &lt;none&gt;
Selector:                 name=nginx
Type:                     LoadBalancer
IP:                       10.98.49.142
Port:                     &lt;unset&gt;  80/TCP
TargetPort:               80/TCP
NodePort:                 &lt;unset&gt;  31631/TCP
Endpoints:                10.244.141.205:80,10.244.2.4:80
Session Affinity:         None
External Traffic Policy:  Cluster
Events:                   &lt;none&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="通过浏览器访问"><a href="#通过浏览器访问" class="header-anchor">#</a> 通过浏览器访问</h4> <p>通过浏览器访问 <a href="http://www.qfdmy.com/wp-content/themes/quanbaike/go.php?url=aHR0cDovLzE5Mi4xNjguMTQxLjEyMDozMTYzMS8=" target="_blank" rel="noopener noreferrer">http://192.168.141.120:31631/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ，出现 Nginx 欢迎页即表示成功</p> <h3 id="集成环境部署"><a href="#集成环境部署" class="header-anchor">#</a> 集成环境部署</h3> <p>也可以不区分配置文件，一次性部署 Deployment 和 Service，创建一个名为 <code>nginx.yml</code> 的配置文件，配置内容如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-app
spec:
  selector:
    matchLabels:
      app: nginx
  replicas: 2
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx
        ports:
        - containerPort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: nginx-http
spec:
  ports:
    - port: 80
      targetPort: 80
      # 可以指定 NodePort 端口，默认范围是：30000-32767
      # nodePort: 30080
  type: LoadBalancer
  selector:
    app: nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code># 部署
kubectl create -f nginx.yml
# 删除
kubectl delete -f nginx.yml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="附：扩展阅读-2"><a href="#附：扩展阅读-2" class="header-anchor">#</a> 附：扩展阅读</h3> <h4 id="修改默认的端口范围"><a href="#修改默认的端口范围" class="header-anchor">#</a> 修改默认的端口范围</h4> <p>Kubernetes 服务的 NodePort 默认端口范围是 30000-32767，在某些场合下，这个限制不太适用，我们可以自定义它的端口范围，操作步骤如下：</p> <p>编辑 <code>vi /etc/kubernetes/manifests/kube-apiserver.yaml</code>配置文件，增加配置 <code>--service-node-port-range=2-65535</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>apiVersion: v1
kind: Pod
metadata:
  creationTimestamp: null
  labels:
    component: kube-apiserver
    tier: control-plane
  name: kube-apiserver
  namespace: kube-system
spec:
  containers:
  - command:
    - kube-apiserver
    # 在这里增加配置即可
    - --service-node-port-range=2-65535
    - --advertise-address=192.168.141.150
    - --allow-privileged=true
    - --authorization-mode=Node,RBAC
    - --client-ca-file=/etc/kubernetes/pki/ca.crt
    - --enable-admission-plugins=NodeRestriction
    - --enable-bootstrap-token-auth=true
    - --etcd-cafile=/etc/kubernetes/pki/etcd/ca.crt
    - --etcd-certfile=/etc/kubernetes/pki/apiserver-etcd-client.crt
// 以下配置省略...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>使用 <code>docker ps</code> 命令找到 <code>kube-apiserver</code> 容器，再使用 <code>docker restart</code> 即可生效。</p> <h2 id="kubernetes-ingress-简介"><a href="#kubernetes-ingress-简介" class="header-anchor">#</a> Kubernetes Ingress 简介</h2> <h3 id="术语"><a href="#术语" class="header-anchor">#</a> 术语</h3> <ul><li><strong>节点：</strong> Kubernetes 集群中的服务器</li> <li><strong>集群：</strong> Kubernetes 管理的一组服务器集合</li> <li><strong>边界路由器：</strong> 为局域网和 Internet 路由数据包的路由器，执行防火墙保护局域网络</li> <li><strong>集群网络：</strong> 遵循 Kubernetes 网络模型实现集群内的通信的具体实现，比如 Flannel 和 Calico</li> <li><strong>服务：</strong> Kubernetes 的服务 (Service) 是使用标签选择器标识的一组 Pod Service (Deployment)。 <strong>除非另有说明，否则服务的虚拟 IP 仅可在集群内部访问</strong></li></ul> <h3 id="内部访问方式-clusterip"><a href="#内部访问方式-clusterip" class="header-anchor">#</a> 内部访问方式 ClusterIP</h3> <p>ClusterIP 服务是 Kubernetes 的默认服务。它给你一个集群内的服务，集群内的其它应用都可以访问该服务。集群外部无法访问它。在某些场景下我们可以使用 Kubernetes 的 Proxy 模式来访问服务，比如调试服务时。</p> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/d842ad072f5674d.png" alt="img"></p> <h3 id="三种外部访问方式"><a href="#三种外部访问方式" class="header-anchor">#</a> 三种外部访问方式</h3> <h4 id="nodeport"><a href="#nodeport" class="header-anchor">#</a> NodePort</h4> <p>NodePort 服务是引导外部流量到你的服务的最原始方式。NodePort，正如这个名字所示，<strong>在所有节点（虚拟机）上开放一个特定端口</strong>，任何发送到该端口的流量都被转发到对应服务。</p> <p>NodePort 服务特征如下：</p> <ul><li>每个端口只能是一种服务</li> <li>端口范围只能是 30000-32767（可调）</li> <li>不在 YAML 配置文件中指定则会分配一个默认端口</li></ul> <blockquote><p><strong>建议：</strong> 不要在生产环境中使用这种方式暴露服务，大多数时候我们应该让 Kubernetes 来选择端口</p></blockquote> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/63a59d808847ae0.png" alt="img"></p> <h4 id="loadbalancer"><a href="#loadbalancer" class="header-anchor">#</a> LoadBalancer</h4> <p>LoadBalancer 服务是暴露服务到 Internet 的标准方式。所有通往你指定的端口的流量都会被转发到对应的服务。它没有过滤条件，没有路由等。这意味着你几乎可以发送任何种类的流量到该服务，像 HTTP，TCP，UDP，WebSocket，gRPC 或其它任意种类。</p> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/51f8a4e248cfeb4.png" alt="img"></p> <h4 id="ingress"><a href="#ingress" class="header-anchor">#</a> Ingress</h4> <p>Ingress 事实上不是一种服务类型。相反，它处于多个服务的前端，扮演着 “智能路由” 或者集群入口的角色。你可以用 Ingress 来做许多不同的事情，各种不同类型的 Ingress 控制器也有不同的能力。它允许你基于路径或者子域名来路由流量到后端服务。</p> <p>Ingress 可能是暴露服务的最强大方式，但同时也是最复杂的。Ingress 控制器有各种类型，包括 Google Cloud Load Balancer， Nginx，Contour，Istio，等等。它还有各种插件，比如 cert-manager (它可以为你的服务自动提供 SSL 证书)/</p> <p>如果你想要使用同一个 IP 暴露多个服务，这些服务都是使用相同的七层协议（典型如 HTTP），你还可以获取各种开箱即用的特性（比如 SSL、认证、路由等等）</p> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/78cb1880ec00126.png" alt="img"></p> <h3 id="什么是-ingress"><a href="#什么是-ingress" class="header-anchor">#</a> 什么是 Ingress</h3> <p>通常情况下，Service 和 Pod 的 IP 仅可在集群内部访问。集群外部的请求需要通过负载均衡转发到 Service 在 Node 上暴露的 NodePort 上，然后再由 kube-proxy 通过边缘路由器 (edge router) 将其转发给相关的 Pod 或者丢弃。而 Ingress 就是为进入集群的请求提供路由规则的集合</p> <p>Ingress 可以给 Service 提供集群外部访问的 URL、负载均衡、SSL 终止、HTTP 路由等。为了配置这些 Ingress 规则，集群管理员需要部署一个 Ingress Controller，它监听 Ingress 和 Service 的变化，并根据规则配置负载均衡并提供访问入口。</p> <h2 id="nginx-虚拟主机"><a href="#nginx-虚拟主机" class="header-anchor">#</a> Nginx 虚拟主机</h2> <h3 id="什么是-nginx"><a href="#什么是-nginx" class="header-anchor">#</a> 什么是 Nginx</h3> <p>Nginx 是一款高性能的 HTTP 服务器/反向代理服务器及电子邮件（IMAP/POP3）代理服务器。由俄罗斯的程序设计师 Igor Sysoev 所开发，官方测试 Nginx 能够支支撑 5 万并发链接，并且 CPU、内存等资源消耗却非常低，运行非常稳定。</p> <h3 id="nginx-的应用场景"><a href="#nginx-的应用场景" class="header-anchor">#</a> Nginx 的应用场景</h3> <ul><li>HTTP 服务器：Nginx 是一个 HTTP 服务可以独立提供 HTTP 服务。可以做网页静态服务器。</li> <li>虚拟主机：可以实现在一台服务器虚拟出多个网站。例如个人网站使用的虚拟主机。</li> <li>反向代理，负载均衡：当网站的访问量达到一定程度后，单台服务器不能满足用户的请求时，需要用多台服务器集群可以使用 Nginx 做反向代理。并且多台服务器可以平均分担负载，不会因为某台服务器负载高宕机而某台服务器闲置的情况。</li></ul> <h3 id="nginx-虚拟主机-2"><a href="#nginx-虚拟主机-2" class="header-anchor">#</a> Nginx 虚拟主机</h3> <h4 id="什么是虚拟主机"><a href="#什么是虚拟主机" class="header-anchor">#</a> 什么是虚拟主机</h4> <p>虚拟主机是一种特殊的软硬件技术，它可以将网络上的每一台计算机分成多个虚拟主机，每个虚拟主机可以独立对外提供 www 服务，这样就可以实现一台主机对外提供多个 web 服务，每个虚拟主机之间是独立的，互不影响的。</p> <p>通过 Nginx 可以实现虚拟主机的配置，Nginx 支持三种类型的虚拟主机配置</p> <ul><li>基于 IP 的虚拟主机</li> <li>基于域名的虚拟主机</li> <li>基于端口的虚拟主机</li></ul> <h4 id="nginx-配置文件的结构"><a href="#nginx-配置文件的结构" class="header-anchor">#</a> Nginx 配置文件的结构</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code># ...
events {
    # ...
}
http {
    # ...
    server{
        # ...
    }
    # ...
    server{
        # ...
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><blockquote><p><strong>注意：</strong> 每个 server 就是一个虚拟主机</p></blockquote> <h3 id="基于-docker-部署-nginx"><a href="#基于-docker-部署-nginx" class="header-anchor">#</a> 基于 Docker 部署 Nginx</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: '3.1'
services:
  nginx:
    restart: always
    image: nginx
    container_name: nginx
    ports:
      - 80:80
    volumes:
      - ./conf/nginx.conf:/etc/nginx/nginx.conf
      - ./html:/usr/share/nginx/html
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="基于端口的虚拟主机配置"><a href="#基于端口的虚拟主机配置" class="header-anchor">#</a> 基于端口的虚拟主机配置</h4> <h5 id="需求"><a href="#需求" class="header-anchor">#</a> 需求</h5> <ul><li>Nginx 对外提供 80 和 8080 两个端口监听服务</li> <li>请求 80 端口则请求 html80 目录下的 html</li> <li>请求 8080 端口则请求 html8080 目录下的 html</li></ul> <h5 id="操作流程"><a href="#操作流程" class="header-anchor">#</a> 操作流程</h5> <ul><li>创建目录及文件，在 <code>/usr/local/docker/nginx/html</code> 目录下创建 <code>html80</code> 和 <code>html8080</code> 两个目录，并分别创建两个 <code>index.html</code> 文件</li> <li>配置虚拟主机，创建并修改 <code>/usr/local/docker/nginx/conf</code> 目录下的 <code>nginx.conf</code></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># 启动进程,通常设置成和 CPU 的数量相等
worker_processes  1;
events {
    # epoll 是多路复用 IO(I/O Multiplexing) 中的一种方式
    # 但是仅用于 linux2.6 以上内核,可以大大提高 nginx 的性能
    use epoll;
    # 单个后台 worker process 进程的最大并发链接数
    worker_connections  1024;
}
http {
    # 设定 mime 类型,类型由 mime.type 文件定义
    include       mime.types;
    default_type  application/octet-stream;
    # sendfile 指令指定 nginx 是否调用 sendfile 函数（zero copy 方式）来输出文件，对于普通应用，
    # 必须设为 on，如果用来进行下载等应用磁盘 IO 重负载应用，可设置为 off，以平衡磁盘与网络 I/O 处理速度，降低系统的 uptime.
    sendfile        on;
    # 连接超时时间
    keepalive_timeout  65;
    # 设定请求缓冲
    client_header_buffer_size 2k;
    # 配置虚拟主机 192.168.141.121
    server {
    # 监听的 IP 和端口，配置 192.168.141.121:80
        listen       80;
    # 虚拟主机名称这里配置 IP 地址
        server_name  192.168.141.121;
    # 所有的请求都以 / 开始，所有的请求都可以匹配此 location
        location / {
        # 使用 root 指令指定虚拟主机目录即网页存放目录
        # 比如访问 http://ip/index.html 将找到 /usr/local/docker/nginx/html/html80/index.html
        # 比如访问 http://ip/item/index.html 将找到 /usr/local/docker/nginx/html/html80/item/index.html
            root   /usr/share/nginx/html/html80;
        # 指定欢迎页面，按从左到右顺序查找
            index  index.html index.htm;
        }
    }
    # 配置虚拟主机 192.168.141.121
    server {
        listen       8080;
        server_name  192.168.141.121;
        location / {
            root   /usr/share/nginx/html/html8080;
            index  index.html index.htm;
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h4 id="基于域名的虚拟主机配置"><a href="#基于域名的虚拟主机配置" class="header-anchor">#</a> 基于域名的虚拟主机配置</h4> <h5 id="需求-2"><a href="#需求-2" class="header-anchor">#</a> 需求</h5> <ul><li>两个域名指向同一台 Nginx 服务器，用户访问不同的域名显示不同的网页内容</li> <li>两个域名是 ingress.funtl.com 和 service.funtl.com</li> <li>Nginx 服务器使用虚拟机 192.168.141.121</li></ul> <h5 id="操作流程-2"><a href="#操作流程-2" class="header-anchor">#</a> 操作流程</h5> <ul><li>配置 Hosts，通过 host 文件指定 service1.funtl.com 和 service2.funtl.com 对应 192.168.141.121 虚拟机，修改 window 的 hosts 文件：（C:\Windows\System32\drivers\etc）</li> <li>创建目录及文件，在 <code>/usr/local/docker/nginx/html</code> 目录下创建 <code>service1</code> 和 <code>service1</code> 两个目录，并分别创建两个 index.html 文件</li> <li>配置虚拟主机，修改 <code>/usr/local/docker/nginx/conf</code> 目录下的 <code>nginx.conf</code></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>user  nginx;
worker_processes  1;
events {
    use epoll;
    worker_connections  1024;
}
http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;
    server {
        listen       80;
        server_name  service1.funtl.com;
        location / {
            root   /usr/share/nginx/html/service1;
            index  index.html index.htm;
        }
    }
    server {
        listen       80;
        server_name  service2.funtl.com;
        location / {
            root   /usr/share/nginx/html/service2;
            index  index.html index.htm;
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="nginx-反向代理"><a href="#nginx-反向代理" class="header-anchor">#</a> Nginx 反向代理</h2> <h3 id="什么是代理服务器"><a href="#什么是代理服务器" class="header-anchor">#</a> 什么是代理服务器</h3> <p>代理服务器，客户机在发送请求时，不会直接发送给目的主机，而是先发送给代理服务器，代理服务接受客户机请求之后，再向主机发出，并接收目的主机返回的数据，存放在代理服务器的硬盘中，再发送给客户机。</p> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/edaa206ef7713d0.png" alt="img"></p> <h3 id="为什么要使用代理服务器"><a href="#为什么要使用代理服务器" class="header-anchor">#</a> 为什么要使用代理服务器</h3> <ul><li><strong>提高访问速度：</strong> 由于目标主机返回的数据会存放在代理服务器的硬盘中，因此下一次客户再访问相同的站点数据时，会直接从代理服务器的硬盘中读取，起到了缓存的作用，尤其对于热门站点能明显提高请求速度。</li> <li><strong>防火墙作用：</strong> 由于所有的客户机请求都必须通过代理服务器访问远程站点，因此可在代理服务器上设限，过滤某些不安全信息。</li> <li><strong>通过代理服务器访问不能访问的目标站点：</strong> 互联网上有许多开放的代理服务器，客户机在访问受限时，可通过不受限的代理服务器访问目标站点，通俗说，我们使用的翻墙浏览器就是利用了代理服务器，虽然不能出国，但也可直接访问外网。</li></ul> <h3 id="什么是正向代理"><a href="#什么是正向代理" class="header-anchor">#</a> 什么是正向代理</h3> <p>正向代理，架设在客户机与目标主机之间，只用于代理内部网络对 Internet 的连接请求，客户机必须指定代理服务器,并将本来要直接发送到 Web 服务器上的 HTTP 请求发送到代理服务器中。</p> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/150135f1004fc35.png" alt="img"></p> <h3 id="什么是反向代理"><a href="#什么是反向代理" class="header-anchor">#</a> 什么是反向代理</h3> <p>反向代理服务器架设在服务器端，通过缓冲经常被请求的页面来缓解服务器的工作量，将客户机请求转发给内部网络上的目标服务器；并将从服务器上得到的结果返回给 Internet 上请求连接的客户端，此时代理服务器与目标主机一起对外表现为一个服务器。</p> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/230002f000af055.png" alt="img"></p> <h3 id="反向代理有哪些主要应用"><a href="#反向代理有哪些主要应用" class="header-anchor">#</a> 反向代理有哪些主要应用</h3> <p>现在许多大型 web 网站都用到反向代理。除了可以防止外网对内网服务器的恶性攻击、缓存以减少服务器的压力和访问安全控制之外，还可以进行负载均衡，将用户请求分配给多个服务器。</p> <h3 id="使用-nginx-反向代理-tomcat"><a href="#使用-nginx-反向代理-tomcat" class="header-anchor">#</a> 使用 Nginx 反向代理 Tomcat</h3> <h4 id="需求-3"><a href="#需求-3" class="header-anchor">#</a> 需求</h4> <ul><li>两个 Tomcat 服务通过 Nginx 反向代理</li> <li>Nginx 服务器：192.168.141.121:80</li> <li>Tomcat1 服务器：192.168.141.121:8081</li> <li>Tomcat2 服务器：192.168.141.121:8082</li></ul> <h4 id="启动-tomcat-容器"><a href="#启动-tomcat-容器" class="header-anchor">#</a> 启动 Tomcat 容器</h4> <p>启动两个 Tomcat 容器，映射端口为 8081 和 8082，<code>docker-compose.yml</code> 如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: '3.1'
services:
  tomcat1:
    image: tomcat
    container_name: tomcat1
    ports:
      - 8081:8080
  tomcat2:
    image: tomcat
    container_name: tomcat2
    ports:
      - 8082:8080
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="配置-nginx-反向代理"><a href="#配置-nginx-反向代理" class="header-anchor">#</a> 配置 Nginx 反向代理</h4> <p>修改 <code>/usr/local/docker/nginx/conf</code> 目录下的 <code>nginx.conf</code> 配置文件：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>user  nginx;
worker_processes  1;
events {
    use epoll;
    worker_connections  1024;
}
http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;
    # 配置一个代理即 tomcat1 服务器
    upstream tomcatServer1 {
        server 192.168.141.121:8081;
    }
    # 配置一个代理即 tomcat2 服务器
    upstream tomcatServer2 {
        server 192.168.141.121:8082;
    }
    # 配置一个虚拟主机
    server {
        listen 80;
        server_name service1.funtl.com;
        location / {
                # 域名 service1.funtl.com 的请求全部转发到 tomcatServer1 即 tomcat1 服务上
                proxy_pass http://tomcatServer1;
                # 欢迎页面，按照从左到右的顺序查找页面
                index index.jsp index.html index.htm;
        }
    }
    server {
        listen 80;
        server_name service2.funtl.com;
        location / {
            # 域名 service2.funtl.com 的请求全部转发到 tomcatServer2 即 tomcat2 服务上
            proxy_pass http://tomcatServer2;
            index index.jsp index.html index.htm;
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><blockquote><p><strong>注意：</strong> 新版 Nginx 的 <code>MARKDOWN_HASHbc3b0556316b0ba241ae6bb86b76e8a2MARKDOWN*HASH*</code> <em>配置中的名称不可以有下划线(&quot;</em>&quot;)，否则会报 <code>400</code> 错误</p></blockquote> <h2 id="nginx-负载均衡"><a href="#nginx-负载均衡" class="header-anchor">#</a> Nginx 负载均衡</h2> <h3 id="什么是负载均衡"><a href="#什么是负载均衡" class="header-anchor">#</a> 什么是负载均衡</h3> <p>负载均衡建立在现有网络结构之上，它提供了一种廉价有效透明的方法扩展网络设备和服务器的带宽、增加吞吐量、加强网络数据处理能力、提高网络的灵活性和可用性。</p> <p>负载均衡，英文名称为 Load Balance，其意思就是分摊到多个操作单元上进行执行，例如 Web 服务器、FTP 服务器、企业关键应用服务器和其它关键任务服务器等，从而共同完成工作任务。</p> <h3 id="nginx-实现负载均衡"><a href="#nginx-实现负载均衡" class="header-anchor">#</a> Nginx 实现负载均衡</h3> <ul><li>Nginx 作为负载均衡服务器，用户请求先到达 Nginx，再由 Nginx 根据负载配置将请求转发至 Tomcat 服务器</li> <li>Nginx 负载均衡服务器：192.168.141.121:80</li> <li>Tomcat1 服务器：192.168.141.121:8081</li> <li>Tomcat2 服务器：192.168.141.121:8082</li> <li>修改 <code>/usr/local/docker/nginx/conf</code> 目录下的 <code>nginx.conf</code> 配置文件：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>user  nginx;
worker_processes  1;
events {
    use epoll;
    worker_connections  1024;
}
http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;
    upstream myapp1 {
        server 192.168.141.121:8081 weight=10;
        server 192.168.141.121:8082 weight=10;
    }
    server {
        listen 80;
        server_name nginx.funtl.com;
        location / {
            proxy_pass http://myapp1;
            index index.jsp index.html index.htm;
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="相关配置说明"><a href="#相关配置说明" class="header-anchor">#</a> 相关配置说明</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code># 定义负载均衡设备的 Ip及设备状态 
upstream myServer {
    server 127.0.0.1:9090 down;
    server 127.0.0.1:8080 weight=2;
    server 127.0.0.1:6060;
    server 127.0.0.1:7070 backup;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>在需要使用负载的 Server 节点下添加</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>proxy_pass http://myServer;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>upstream</code>：每个设备的状态:</li> <li><code>down</code>：表示当前的 <code>server</code> 暂时不参与负载</li> <li><code>weight</code>：默认为 1 <code>weight</code> 越大，负载的权重就越大。</li> <li><code>max_fails</code>：允许请求失败的次数默认为 1 当超过最大次数时，返回 <code>proxy_next_upstream</code> 模块定义的错误</li> <li><code>fail_timeout</code>:<code>max_fails</code> 次失败后，暂停的时间。</li> <li><code>backup</code>：其它所有的非 <code>backup</code> 机器 <code>down</code> 或者忙的时候，请求 <code>backup</code> 机器。所以这台机器压力会最轻</li></ul> <h2 id="nginx-ingress-controller"><a href="#nginx-ingress-controller" class="header-anchor">#</a> Nginx Ingress Controller</h2> <h3 id="概述-6"><a href="#概述-6" class="header-anchor">#</a> 概述</h3> <p>本次实践的主要目的就是将入口统一，不再通过 LoadBalancer 等方式将端口暴露出来，而是使用 Ingress 提供的反向代理负载均衡功能作为我们的唯一入口。通过以下步骤操作仔细体会。</p> <blockquote><p><strong>注意：</strong> 下面包含资源配置的步骤都是自行创建 YAML 配置文件通过 <code>kubectl create -f</code> 或 <code>kubectl apply -f</code> 部署，<code>kubectl delete -f</code> 删除</p></blockquote> <h3 id="安装-ingress"><a href="#安装-ingress" class="header-anchor">#</a> 安装 Ingress</h3> <p>Ingress Controller 有许多种，我们选择最熟悉的 Nginx 来处理请求，其它可以参考 <a href="https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ul><li>下载 Nginx Ingress Controller 配置文件</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/static/mandatory.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>修改配置文件，找到配置如下位置 (搜索 <code>serviceAccountName</code>) 在下面增加一句 <code>hostNetwork: true</code></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-ingress-controller
  namespace: ingress-nginx
  labels:
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
spec:
  # 可以部署多个实例
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: ingress-nginx
      app.kubernetes.io/part-of: ingress-nginx
  template:
    metadata:
      labels:
        app.kubernetes.io/name: ingress-nginx
        app.kubernetes.io/part-of: ingress-nginx
      annotations:
        prometheus.io/port: &quot;10254&quot;
        prometheus.io/scrape: &quot;true&quot;
    spec:
      serviceAccountName: nginx-ingress-serviceaccount
      # 增加 hostNetwork: true，意思是开启主机网络模式，暴露 Nginx 服务端口 80
      hostNetwork: true
      containers:
        - name: nginx-ingress-controller
          # 使用 Azure 中国镜像
          image: quay.azk8s.cn/kubernetes-ingress-controller/nginx-ingress-controller:0.24.1
          args:
            - /nginx-ingress-controller
            - --configmap=$(POD_NAMESPACE)/nginx-configuration
            - --tcp-services-configmap=$(POD_NAMESPACE)/tcp-services
            - --udp-services-configmap=$(POD_NAMESPACE)/udp-services
            - --publish-service=$(POD_NAMESPACE)/ingress-nginx
// 以下代码省略...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><ul><li>通过命令 <code>kubectl apply -f mandatory.yaml</code> 部署</li> <li>通过命令 <code>kubectl get pods -n ingress-nginx -o wide</code> 查看</li></ul> <h3 id="部署-ingress"><a href="#部署-ingress" class="header-anchor">#</a> 部署 Ingress</h3> <ul><li>创建一个名为 <code>ingress.yml</code> 的资源配置文件</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  name: nginx-web
  annotations:
    # 指定 Ingress Controller 的类型
    kubernetes.io/ingress.class: &quot;nginx&quot;
    # 指定我们的 rules 的 path 可以使用正则表达式
    nginx.ingress.kubernetes.io/use-regex: &quot;true&quot;
    # 连接超时时间，默认为 5s
    nginx.ingress.kubernetes.io/proxy-connect-timeout: &quot;600&quot;
    # 后端服务器回转数据超时时间，默认为 60s
    nginx.ingress.kubernetes.io/proxy-send-timeout: &quot;600&quot;
    # 后端服务器响应超时时间，默认为 60s
    nginx.ingress.kubernetes.io/proxy-read-timeout: &quot;600&quot;
    # 客户端上传文件，最大大小，默认为 20m
    nginx.ingress.kubernetes.io/proxy-body-size: &quot;10m&quot;
    # URL 重写
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  # 路由规则
  rules:
  # 主机名，只能是域名，修改为你自己的
  - host: k8s.funtl.com
    http:
      paths:
      - path:
        backend:
          # 后台部署的 Service Name
          serviceName: tomcat-http
          # 后台部署的 Service Port
          servicePort: 8080
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><ul><li>通过命令 <code>kubectl apply -f ingress.yml</code> 部署</li> <li>通过命令 <code>kubectl get ingress</code> 查看</li></ul> <h3 id="部署-tomcat"><a href="#部署-tomcat" class="header-anchor">#</a> 部署 Tomcat</h3> <p>部署 Tomcat 但仅允许在内网访问，我们要通过 Ingress 提供的反向代理功能路由到 Tomcat 之上，创建一个名为 <code>tomcat.yml</code> 资源配置文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: tomcat-app
spec:
  replicas: 2
  template:
    metadata:
      labels:
        name: tomcat
    spec:
      containers:
      - name: tomcat
        image: tomcat:8.5.43
        imagePullPolicy: IfNotPresent
        ports:
        - containerPort: 8080
---
apiVersion: v1
kind: Service
metadata:
  name: tomcat-http
spec:
  ports:
    - port: 8080
      targetPort: 8080
  # ClusterIP, NodePort, LoadBalancer
  type: ClusterIP
  selector:
    name: tomcat
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><ul><li>通过命令 <code>kubectl apply -f tomcat.yml</code> 部署</li></ul> <h3 id="验证是否成功-4"><a href="#验证是否成功-4" class="header-anchor">#</a> 验证是否成功</h3> <h4 id="查看-tomcat"><a href="#查看-tomcat" class="header-anchor">#</a> 查看 Tomcat</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get deployment
# 输出如下
NAME         READY   UP-TO-DATE   AVAILABLE   AGE
tomcat-app   2/2     2            2           88m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get service
# 输出如下
NAME          TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
kubernetes    ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP    2d5h
tomcat-http   ClusterIP   10.97.222.179   &lt;none&gt;        8080/TCP   89m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="查看-ingress"><a href="#查看-ingress" class="header-anchor">#</a> 查看 Ingress</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get pods -n ingress-nginx -o wide
# 输出如下，注意下面的 IP 地址，就是我们实际访问地址
NAME                                        READY   STATUS    RESTARTS   AGE   IP                NODE                 NOMINATED NODE   READINESS GATES
nginx-ingress-controller-76f9fddcf8-vzkm5   1/1     Running   0          61m   192.168.141.121   kubernetes-node-02   &lt;none&gt;           &lt;none&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get ingress
# 输出如下
NAME        HOSTS          ADDRESS   PORTS   AGE
nginx-web   k8s.funtl.com             80      61m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="测试访问"><a href="#测试访问" class="header-anchor">#</a> 测试访问</h4> <p>成功代理到 Tomcat 即表示成功</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 不设置 Hosts 的方式请求地址，下面的 IP 和 HOST 均在上面有配置
curl -v http://192.168.12.120 -H 'host: k8s.smxy.com'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="kubernetes-准备数据卷"><a href="#kubernetes-准备数据卷" class="header-anchor">#</a> Kubernetes 准备数据卷</h2> <h3 id="概述-7"><a href="#概述-7" class="header-anchor">#</a> 概述</h3> <p>在 Docker 中就有数据卷的概念，当容器删除时，数据也一起会被删除，想要持久化使用数据，需要把主机上的目录挂载到 Docker 中去，在 K8S 中，数据卷是通过 Pod 实现持久化的，如果 Pod 删除，数据卷也会一起删除，k8s 的数据卷是 docker 数据卷的扩展，K8S 适配各种存储系统，包括本地存储 EmptyDir，HostPath， 网络存储（NFS，GlusterFS，PV/PVC）等。</p> <p>我们以部署 MySQL8 为例，采用 <strong>NFS + PV/PVC</strong> 网络存储方案实现我们的 Kubernetes 数据持久化。</p> <h3 id="什么是-nfs"><a href="#什么是-nfs" class="header-anchor">#</a> 什么是 NFS</h3> <p>NFS 是 Network File System 的简写，即网络文件系统，NFS 是 FreeBSD 支持的文件系统中的一种。NFS 基于 RPC (Remote Procedure Call) 远程过程调用实现，其允许一个系统在网络上与它人共享目录和文件。通过使用 NFS，用户和程序就可以像访问本地文件一样访问远端系统上的文件。NFS 是一个非常稳定的，可移植的网络文件系统。具备可扩展和高性能等特性，达到了企业级应用质量标准。由于网络速度的增加和延迟的降低，NFS 系统一直是通过网络提供文件系统服务的有竞争力的选择 。</p> <h4 id="nfs-原理"><a href="#nfs-原理" class="header-anchor">#</a> NFS 原理</h4> <p>NFS 使用 RPC (Remote Procedure Call) 的机制进行实现，RPC 使得客户端可以调用服务端的函数。同时，由于有 VFS 的存在，客户端可以像使用其它普通文件系统一样使用 NFS 文件系统。经由操作系统的内核，将 NFS 文件系统的调用请求通过 TCP/IP 发送至服务端的 NFS 服务。NFS 服务器执行相关的操作，并将操作结果返回给客户端。</p> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/4c530fd29b79c58.jpg" alt="img"></p> <h4 id="nfs-服务主要进程"><a href="#nfs-服务主要进程" class="header-anchor">#</a> NFS 服务主要进程</h4> <ul><li>rpc.nfsd：最主要的 NFS 进程，管理客户端是否可登录</li> <li>rpc.mountd：挂载和卸载 NFS 文件系统，包括权限管理</li> <li>rpc.lockd：非必要，管理文件锁，避免同时写出错</li> <li>rpc.statd：非必要，检查文件一致性，可修复文件</li></ul> <h4 id="nfs-的关键工具"><a href="#nfs-的关键工具" class="header-anchor">#</a> NFS 的关键工具</h4> <ul><li>主要配置文件：<code>/etc/exports</code></li> <li>NFS 文件系统维护命令：<code>/usr/bin/exportfs</code></li> <li>共享资源的日志文件：<code>/var/lib/nfs/*tab</code></li> <li>客户端查询共享资源命令：<code>/usr/sbin/showmount</code></li> <li>端口配置：<code>/etc/sysconfig/nfs</code></li></ul> <h4 id="nfs-服务端配置"><a href="#nfs-服务端配置" class="header-anchor">#</a> NFS 服务端配置</h4> <p>在 NFS 服务器端的主要配置文件为 <code>/etc/exports</code> 时，通过此配置文件可以设置共享文件目录。每条配置记录由 NFS 共享目录、NFS 客户端地址和参数这 3 部分组成，格式如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[NFS 共享目录] [NFS 客户端地址 1 (参数 1, 参数 2, 参数 3……)] [客户端地址 2 (参数 1, 参数 2, 参数 3……)]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>NFS 共享目录：服务器上共享出去的文件目录</li> <li>NFS 客户端地址：允许其访问的 NFS 服务器的客户端地址，可以是客户端 IP 地址，也可以是一个网段 (192.168.141.0/24)</li> <li>访问参数：括号中逗号分隔项，主要是一些权限选项</li></ul> <h5 id="访问权限参数"><a href="#访问权限参数" class="header-anchor">#</a> 访问权限参数</h5> <table><thead><tr><th style="text-align:left;">序号</th> <th style="text-align:left;">选项</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">1</td> <td style="text-align:left;">ro</td> <td style="text-align:left;">客户端对于共享文件目录为只读权限。默认</td></tr> <tr><td style="text-align:left;">2</td> <td style="text-align:left;">rw</td> <td style="text-align:left;">客户端对于共享文件目录具有读写权限</td></tr></tbody></table> <h5 id="用户映射参数"><a href="#用户映射参数" class="header-anchor">#</a> 用户映射参数</h5> <table><thead><tr><th style="text-align:left;">序号</th> <th style="text-align:left;">选项</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">1</td> <td style="text-align:left;">root_squash</td> <td style="text-align:left;">使客户端使用 root 账户访冋时，服务器映射为服务器本地的匿名账号</td></tr> <tr><td style="text-align:left;">2</td> <td style="text-align:left;">no_root_squash</td> <td style="text-align:left;">客户端连接服务端时如果使用的是 root，那么也拥有对服务端分享的目录的 root 权限</td></tr> <tr><td style="text-align:left;">3</td> <td style="text-align:left;">all_squash</td> <td style="text-align:left;">将所有客户端用户请求映射到匿名用户或用户组（nfsnobody)</td></tr> <tr><td style="text-align:left;">4</td> <td style="text-align:left;">no_all_squash</td> <td style="text-align:left;">与上相反。默认</td></tr> <tr><td style="text-align:left;">5</td> <td style="text-align:left;">anonuid=xxx</td> <td style="text-align:left;">将远程访问的所有用户都映射为匿名用户，并指定该用户为本地用户(UID=xxx)</td></tr> <tr><td style="text-align:left;">6</td> <td style="text-align:left;">anongid=xxx</td> <td style="text-align:left;">将远程访问的所有用户组都映射为匿名用户组账户，并指定该匿名用户组账户为本地用户组账户(GUI=xxx)</td></tr></tbody></table> <h5 id="其它配置参数"><a href="#其它配置参数" class="header-anchor">#</a> 其它配置参数</h5> <table><thead><tr><th style="text-align:left;">序号</th> <th style="text-align:left;">选项</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">1</td> <td style="text-align:left;">sync</td> <td style="text-align:left;">同步写操作，数据写入存储设备后返回成功信息。默认</td></tr> <tr><td style="text-align:left;">2</td> <td style="text-align:left;">async</td> <td style="text-align:left;">异步写提作，数据在未完全写入存储设备前就返回成功信息，实际还在内存，</td></tr> <tr><td style="text-align:left;">3</td> <td style="text-align:left;">wdelay</td> <td style="text-align:left;">延迟写入选项，将多个写提请求合并后写入硬盘，减少 I/O 次数， NFS 非正常关闭数据可能丢失。默认</td></tr> <tr><td style="text-align:left;">4</td> <td style="text-align:left;">no_wdelay</td> <td style="text-align:left;">与上相反，不与 async 同时生效，如果 NFS 服务器主要收到小且不相关的请求，该选项实际会降低性能</td></tr> <tr><td style="text-align:left;">5</td> <td style="text-align:left;">subtree</td> <td style="text-align:left;">若输出目录是一个子目录，则 NFS 服务器将检查其父目录的权限。默认</td></tr> <tr><td style="text-align:left;">6</td> <td style="text-align:left;">no_subtree</td> <td style="text-align:left;">即使输出目录是一个子目录， NFS 服务器也不检查其父目录的权限，这样可以提高效率</td></tr> <tr><td style="text-align:left;">7</td> <td style="text-align:left;">secure</td> <td style="text-align:left;">限制客户端只能从小于 1024 的 TCP/IP 端口连接 NFS 服务器。默认</td></tr> <tr><td style="text-align:left;">8</td> <td style="text-align:left;">insecure</td> <td style="text-align:left;">允许客户端从大于 1024 的 TCP/IP 端口连接服务器</td></tr></tbody></table> <h3 id="安装-nfs-服务端"><a href="#安装-nfs-服务端" class="header-anchor">#</a> 安装 NFS 服务端</h3> <p>由于 NFS 是一套分布式文件系统，我们再创建一台独立的虚拟机作为我们 NFS 服务端，配置如下</p> <table><thead><tr><th style="text-align:left;">主机名</th> <th style="text-align:left;">IP</th> <th style="text-align:left;">系统</th> <th style="text-align:left;">CPU/内存</th> <th style="text-align:left;">磁盘</th></tr></thead> <tbody><tr><td style="text-align:left;">kubernetes-volumes</td> <td style="text-align:left;">192.168.141.130</td> <td style="text-align:left;">Ubuntu Server 18.04</td> <td style="text-align:left;">2 核 2G</td> <td style="text-align:left;">20G</td></tr></tbody></table> <ul><li>创建一个目录作为共享文件目录</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>mkdir -p /usr/local/kubernetes/volumes
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>给目录增加读写权限</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>chmod a+rw /usr/local/kubernetes/volumes
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>安装 NFS 服务端</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>apt-get update
apt-get install -y nfs-kernel-server
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>配置 NFS 服务目录，打开文件 <code>vi /etc/exports</code> <ul><li><strong><code>/usr/local/kubernetes/volumes</code>：</strong> 作为服务目录向客户端开放</li> <li>***：**表示任何 IP 都可以访问</li> <li><strong>rw：</strong> 读写权限</li> <li><strong>sync：</strong> 同步权限</li> <li><strong>no_subtree_check：</strong> 表示如果输出目录是一个子目录，NFS 服务器不检查其父目录的权限</li> <li><strong>no_root_squash：</strong> 客户端连接服务端时如果使用的是 root，那么也拥有对服务端分享的目录的 root 权限</li></ul></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>/usr/local/kubernetes/volumes *(rw,sync,no_subtree_check,no_root_squash)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>重启服务，使配置生效</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>/etc/init.d/nfs-kernel-server restart
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="安装-nfs-客户端"><a href="#安装-nfs-客户端" class="header-anchor">#</a> 安装 NFS 客户端</h3> <p>安装客户端的目的是验证是否可以上传文件到服务端，安装命令如下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>apt-get install -y nfs-common
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>创建 NFS 客户端挂载目录</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>mkdir -p /usr/local/kubernetes/volumes-mount
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>将 NFS 服务器的 <code>/usr/local/kubernetes/volumes</code> 目录挂载到 NFS 客户端的 <code>/usr/local/kubernetes/volumes-mount</code> 目录</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>mount 192.168.141.130:/usr/local/kubernetes/volumes /usr/local/kubernetes/volumes-mount
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>使用 <code>df</code> 命令查看挂载信息</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>df
# 输出如下
Filesystem                                    1K-blocks    Used Available Use% Mounted on
udev                                             977544       0    977544   0% /dev
tmpfs                                            201732    1232    200500   1% /run
/dev/mapper/ubuntu--vg-ubuntu--lv              19475088 4780912  13681852  26% /
tmpfs                                           1008648       0   1008648   0% /dev/shm
tmpfs                                              5120       0      5120   0% /run/lock
tmpfs                                           1008648       0   1008648   0% /sys/fs/cgroup
/dev/loop0                                        90624   90624         0 100% /snap/core/7270
/dev/loop1                                        93184   93184         0 100% /snap/core/6350
/dev/sda2                                        999320   77944    852564   9% /boot
tmpfs                                            201728       0    201728   0% /run/user/0
# 有此输出表示挂载成功
192.168.141.130:/usr/local/kubernetes/volumes  19475200 4780800  13681920  26% /usr/local/kubernetes/volumes-mount
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="验证-nfs-服务"><a href="#验证-nfs-服务" class="header-anchor">#</a> 验证 NFS 服务</h3> <ul><li>测试文件上传</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>ip addr &gt; /usr/local/kubernetes/volumes-mount/test.txt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>查看 <code>/usr/local/kubernetes/volumes</code> 目录下是否有 <code>test.txt</code> 文件，有则表示成功</li></ul> <h3 id="取消-nfs-客户端挂载"><a href="#取消-nfs-客户端挂载" class="header-anchor">#</a> 取消 NFS 客户端挂载</h3> <blockquote><p><strong>注意：</strong> 不要直接在挂载目录下执行，否则会报错</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>umount /usr/local/kubernetes/volumes-mount
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="kubernetes-使用数据卷"><a href="#kubernetes-使用数据卷" class="header-anchor">#</a> Kubernetes 使用数据卷</h2> <h3 id="概述-8"><a href="#概述-8" class="header-anchor">#</a> 概述</h3> <p>存储管理与计算管理是两个不同的问题。Persistent Volume 子系统，对存储的供应和使用做了抽象，以 API 形式提供给管理员和用户使用。要完成这一任务，我们引入了两个新的 API 资源：<strong>Persistent Volume（持久卷）</strong> 和 <strong>Persistent Volume Claim（持久卷消费者）</strong>。</p> <p>Persistent Volume（PV）是集群之中的一块网络存储。跟 Node 一样，也是集群的资源。PV 跟 Volume (卷) 类似，不过会有独立于 Pod 的生命周期。这一 API 对象包含了存储的实现细节，例如 NFS、iSCSI 或者其他的云提供商的存储系统。Persistent Volume Claim (PVC) 是用户的一个请求。跟 Pod 类似，Pod 消费 Node 的资源，PVC 消费 PV 的资源。Pod 能够申请特定的资源（CPU 和内存）；Claim 能够请求特定的尺寸和访问模式（例如可以加载一个读写，以及多个只读实例）</p> <h3 id="pv-与-pvc"><a href="#pv-与-pvc" class="header-anchor">#</a> PV 与 PVC</h3> <p>PV 是集群的资源。PVC 是对这一资源的请求，也是对资源的所有权的检验。PV 和 PVC 之间的互动遵循如下的生命周期。</p> <ul><li><strong>供应：</strong> 集群管理员会创建一系列的 PV。这些 PV 包含了为集群用户提供的真实存储资源，它们可利用 Kubernetes API 来消费。</li> <li><strong>绑定：</strong> 用户创建一个包含了容量和访问模式的持久卷申请。Master 会监听 PVC 的产生，并尝试根据请求内容查找匹配的 PV，并把 PV 和 PVC 进行绑定。用户能够获取满足需要的资源，并且在使用过程中可能超出请求数量。如果找不到合适的卷，这一申请就会持续处于非绑定状态，一直到出现合适的 PV。例如一个集群准备了很多的 50G 大小的持久卷，（虽然总量足够）也是无法响应 100G 的申请的，除非把 100G 的 PV 加入集群。</li> <li><strong>使用：</strong> Pod 把申请作为卷来使用。集群会通过 PVC 查找绑定的 PV，并 Mount 给 Pod。对于支持多种访问方式的卷，用户在使用 PVC 作为卷的时候，可以指定需要的访问方式。一旦用户拥有了一个已经绑定的 PVC，被绑定的 PV 就归该用户所有了。用户的 Pods 能够通过在 Pod 的卷中包含的 PVC 来访问他们占有的 PV。</li> <li><strong>释放：</strong> 当用户完成对卷的使用时，就可以利用 API 删除 PVC 对象了，而且他还可以重新申请。删除 PVC 后，对应的卷被视为 “被释放”，但是这时还不能给其他的 PVC 使用。之前的 PVC 数据还保存在卷中，要根据策略来进行后续处理。</li> <li><strong>回收：</strong> PV 的回收策略向集群阐述了在 PVC 释放卷的时候，应如何进行后续工作。目前可以采用三种策略：保留，回收或者删除。保留策略允许重新申请这一资源。在持久卷能够支持的情况下，删除策略会同时删除持久卷以及 AWS EBS/GCE PD 或者 Cinder 卷中的存储内容。如果插件能够支持，回收策略会执行基础的擦除操作（<code>rm -rf /thevolume/*</code>），这一卷就能被重新申请了。</li></ul> <h3 id="定义-pv"><a href="#定义-pv" class="header-anchor">#</a> 定义 PV</h3> <h4 id="持久卷插件"><a href="#持久卷插件" class="header-anchor">#</a> 持久卷插件</h4> <p>持久卷是以插件方式实现的，目前支持的插件如下：</p> <ul><li>GCEPersistentDisk</li> <li>AWSElasticBlockStore</li> <li><strong>NFS（我们采用的是该方案）</strong></li> <li>iSCSI</li> <li>RBD (Ceph Block Device)</li> <li>Glusterfs</li> <li>HostPath (单节点测试使用)</li> <li>本地持久卷</li></ul> <h4 id="yaml-配置"><a href="#yaml-配置" class="header-anchor">#</a> YAML 配置</h4> <p>创建一个名为 <code>nfs-pv-mysql.yml</code> 的配置文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>apiVersion: v1
kind: PersistentVolume
metadata:
  name: nfs-pv-mysql
spec:
  # 设置容量
  capacity:
    storage: 5Gi
  # 访问模式
  accessModes:
    # 该卷能够以读写模式被多个节点同时加载
    - ReadWriteMany
  # 回收策略，这里是基础擦除 `rm-rf/thevolume/*`
  persistentVolumeReclaimPolicy: Recycle
  nfs:
    # NFS 服务端配置的路径
    path: &quot;/usr/local/kubernetes/volumes&quot;
    # NFS 服务端地址
    server: 192.168.12.130
    readOnly: false
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code># 部署
kubectl create -f nfs-pv-mysql.yml
# 删除
kubectl delete -f nfs-pv-mysql.yml
# 查看
kubectl get pv
NAME           CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE
nfs-pv-mysql   5Gi        RWX            Recycle          Available                                   29m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="配置说明"><a href="#配置说明" class="header-anchor">#</a> 配置说明</h4> <h5 id="capacity（容量）"><a href="#capacity（容量）" class="header-anchor">#</a> Capacity（容量）</h5> <p>一般来说，PV 会指定存储容量。这里需要使用 PV 的 capcity 属性。目前存储大小是唯一一个能够被申请的指标，今后会加入更多属性，例如 IOPS，吞吐能力等。</p> <h5 id="accessmodes（访问模式）"><a href="#accessmodes（访问模式）" class="header-anchor">#</a> AccessModes（访问模式）</h5> <p>只要资源提供者支持，持久卷能够被用任何方式加载到主机上。每种存储都会有不同的能力，每个 PV 的访问模式也会被设置成为该卷所支持的特定模式。例如 NFS 能够支持多个读写客户端，但是某个 NFS PV 可能会在服务器上以只读方式使用。每个 PV 都有自己的一系列的访问模式，这些访问模式取决于 PV 的能力。访问模式的可选范围如下：</p> <ul><li><strong>ReadWriteOnce：</strong> 该卷能够以读写模式被加载到一个节点上</li> <li><strong>ReadOnlyMany：</strong> 该卷能够以只读模式加载到多个节点上</li> <li><strong>ReadWriteMany：</strong> 该卷能够以读写模式被多个节点同时加载</li></ul> <p>在 CLI 下，访问模式缩写为：</p> <ul><li><strong>RWO：</strong> ReadWriteOnce</li> <li><strong>ROX：</strong> ReadOnlyMany</li> <li><strong>RWX：</strong> ReadWriteMany</li></ul> <p>另外，一个卷不论支持多少种访问模式，同时只能以一种访问模式加载。例如一个 GCE Persistent Disk 既能支持 ReadWriteOnce，也能支持 ReadOnlyMany。</p> <h5 id="recyclingpolicy（回收策略）"><a href="#recyclingpolicy（回收策略）" class="header-anchor">#</a> RecyclingPolicy（回收策略）</h5> <p>当前的回收策略可选值包括：</p> <ul><li><strong>Retain：</strong> 人工重新申请</li> <li><strong>Recycle：</strong> 基础擦除（<code>rm-rf/thevolume/*</code>）</li> <li><strong>Delete：</strong> 相关的存储资产例如 AWS EBS，GCE PD 或者 OpenStack Cinder 卷一并删除</li></ul> <p>目前，只有 NFS 和 HostPath 支持 Recycle 策略，AWS EBS、GCE PD 以及 Cinder 卷支持 Delete 策略。</p> <h5 id="阶段（phase）"><a href="#阶段（phase）" class="header-anchor">#</a> 阶段（Phase）</h5> <p>一个卷会处于如下阶段之一：</p> <ul><li><strong>Available：</strong> 可用资源，尚未被绑定到 PVC 上</li> <li><strong>Bound：</strong> 该卷已经被绑定</li> <li><strong>Released：</strong> PVC 已经被删除，但该资源尚未被集群回收</li> <li><strong>Failed：</strong> 该卷的自动回收过程失败</li></ul> <h3 id="定义-pvc"><a href="#定义-pvc" class="header-anchor">#</a> 定义 PVC</h3> <p>创建一个名为 <code>nfs-pvc-mysql-myshop.yml</code> 的配置文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: nfs-pvc-mysql-myshop
spec:
  accessModes:
  # 需要使用和 PV 一致的访问模式
  - ReadWriteMany
  # 按需分配资源
  resources:
     requests:
       storage: 1Gi
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code># 部署
kubectl create -f nfs-pvc-mysql-myshop.yml
# 删除
kubectl delete -f nfs-pvc-mysql-myshop.yml
# 查看
kubectl get pvc
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="部署-mysql8"><a href="#部署-mysql8" class="header-anchor">#</a> 部署 MySQL8</h3> <blockquote><p><strong>注意：</strong> 要确保每台 Node 都安装了 NFS 客户端，<code>apt-get install -y nfs-common</code></p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: mysql-myshop
spec:
  replicas: 1
  template:
    metadata:
      labels:
        name: mysql-myshop
    spec:
      containers:
        - name: mysql-myshop
          image: mysql:8.0.16
          # 只有镜像不存在时，才会进行镜像拉取
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 3306
          # 同 Docker 配置中的 environment
          env:
            - name: MYSQL_ROOT_PASSWORD
              value: &quot;123456&quot;
          # 容器中的挂载目录
          volumeMounts:
            - name: nfs-vol-myshop
              mountPath: /var/lib/mysql
      volumes:
        # 挂载到数据卷
        - name: nfs-vol-myshop
          persistentVolumeClaim:
            claimName: nfs-pvc-mysql-myshop
---
apiVersion: v1
kind: Service
metadata:
  name: mysql-myshop
spec:
  ports:
    - port: 3306
      targetPort: 3306
  type: LoadBalancer
  selector:
    name: mysql-myshop
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h4 id="测试运行"><a href="#测试运行" class="header-anchor">#</a> 测试运行</h4> <p>部署成功后可以使用 <code>kubectl get service</code> 查看我们 MySQL 的运行端口，再使用连接工具连接会报如下错误</p> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/85bc9545ce9ec0c.png" alt="img"></p> <p>意思为无法使用密码的方式登录，在 Docker 部署时我们可以在 YAML 中配置相关参数解决这个问题；下一节我们讲解在 Kubernetes 中采用 <strong>ConfigMap</strong> 的方式配置 MySQL</p> <h2 id="kubernetes-configmap"><a href="#kubernetes-configmap" class="header-anchor">#</a> Kubernetes ConfigMap</h2> <h3 id="概述-9"><a href="#概述-9" class="header-anchor">#</a> 概述</h3> <p>ConfigMap 是用来存储配置文件的 Kubernetes 资源对象，所有的配置内容都存储在 etcd 中。它可以被用来保存单个属性，也可以用来保存整个配置文件或者 JSON 二进制对象。ConfigMap API 资源提供了将配置数据注入容器的方式，同时保证该机制对容器来说是透明的。配置应该从 Image 内容中解耦，以此来保持容器化应用程序的可移植性。</p> <h3 id="使用-configmap-配置-mysql"><a href="#使用-configmap-配置-mysql" class="header-anchor">#</a> 使用 ConfigMap 配置 MySQL</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-myshop-config
data:
  # 这里是键值对数据
  mysqld.cnf: |
    [client]
    port=3306
    [mysql]
    no-auto-rehash
    [mysqld]
    skip-host-cache
    skip-name-resolve
    default-authentication-plugin=mysql_native_password
    character-set-server=utf8mb4
    collation-server=utf8mb4_general_ci
    explicit_defaults_for_timestamp=true
    lower_case_table_names=1
---
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: mysql-myshop
spec:
  replicas: 1
  template:
    metadata:
      labels:
        name: mysql-myshop
    spec:
      containers:
        - name: mysql-myshop
          image: mysql:8.0.16
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 3306
          env:
            - name: MYSQL_ROOT_PASSWORD
              value: &quot;123456&quot;
          volumeMounts:
            # 以数据卷的形式挂载 MySQL 配置文件目录
            - name: cm-vol-myshop
              mountPath: /etc/mysql/conf.d
            - name: nfs-vol-myshop
              mountPath: /var/lib/mysql
      volumes:
        # 将 ConfigMap 中的内容以文件形式挂载进数据卷
        - name: cm-vol-myshop
          configMap:
            name: mysql-myshop-config
            items:
                # ConfigMap 中的 Key
              - key: mysqld.cnf
                # ConfigMap Key 匹配的 Value 写入名为 mysqld.cnf 的文件中
                path: mysqld.cnf
        - name: nfs-vol-myshop
          persistentVolumeClaim:
            claimName: nfs-pvc-mysql-myshop
---
apiVersion: v1
kind: Service
metadata:
  name: mysql-myshop
spec:
  ports:
    - port: 3306
      targetPort: 3306
  type: LoadBalancer
  selector:
    name: mysql-myshop
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code># 查看 ConfigMap
kubectl get cm
kubectl describe cm &lt;ConfigMap Name&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="kubernetes-dashboard"><a href="#kubernetes-dashboard" class="header-anchor">#</a> Kubernetes Dashboard</h2> <h3 id="概述-10"><a href="#概述-10" class="header-anchor">#</a> 概述</h3> <p>Kubernetes Dashboard 是 Kubernetes 集群的 Web UI，用于管理集群。</p> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <p>GitHub 地址：<a href="https://github.com/kubernetes/dashboard" target="_blank" rel="noopener noreferrer">Kubernetes Dashboard<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>下载配置文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># k8s1.15
wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-beta2/aio/deploy/recommended.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code># k8s1.16
wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-beta5/aio/deploy/recommended.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>修改配置如下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 省略部分代码...
# ------------------- Dashboard Service ------------------- #
kind: Service
apiVersion: v1
metadata:
  labels:
    k8s-app: kubernetes-dashboard
  name: kubernetes-dashboard
  namespace: kube-system
spec:
  # 修改类型为 NodePort 访问
  type: NodePort
  ports:
    - port: 443
      targetPort: 8443
      # 设置端口号为 30001
      nodePort: 30001
  selector:
    k8s-app: kubernetes-dashboard
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>部署到集群</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 部署
kubectl create -f recommended.yaml
# 查看
kubectl -n kubernetes-dashboard get pods
kubectl -n kubernetes-dashboard get service kubernetes-dashboard
kubectl -n kubernetes-dashboard describe service kubernetes-dashboard
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="访问"><a href="#访问" class="header-anchor">#</a> 访问</h3> <p>需要使用 NodeIP:30001 访问 Dashboard，因为证书原因除火狐浏览器外其它浏览器无法直接打开页面</p> <p>Chrome 浏览器显示如下</p> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/fcacca76f64339a.png" alt="img"></p> <p>Firefox 浏览器显示如下</p> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/3a719c594e6fdeb.png" alt="img"></p> <p>点击 <strong>接受风险并继续</strong> 即可显示欢迎界面</p> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/af3fa90ff0439c4.png" alt="img"></p> <h3 id="登录"><a href="#登录" class="header-anchor">#</a> 登录</h3> <p>我们采用 Token 方式登录</p> <ul><li>创建登录账号，创建一个名为 <code>dashboard-adminuser.yaml</code> 的配置文件</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>apiVersion: v1
kind: ServiceAccount
metadata:
  name: admin-user
  namespace: kubernetes-dashboard
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: admin-user
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
- kind: ServiceAccount
  name: admin-user
  namespace: kubernetes-dashboard
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl create -f dashboard-adminuser.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>打印 Token 信息</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl -n kubernetes-dashboard describe secret $(kubectl -n kubernetes-dashboard get secret | grep admin-user | awk '{print $1}')
# 输出如下
Name:         admin-user-token-2v8vd
Namespace:    kubernetes-dashboard
Labels:       &lt;none&gt;
Annotations:  kubernetes.io/service-account.name: admin-user
              kubernetes.io/service-account.uid: f6f23bc9-3f34-4452-9977-8915e77fbef3
Type:  kubernetes.io/service-account-token
Data
====
namespace:  20 bytes
token:      eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyLXRva2VuLTJ2OHZkIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJmNmYyM2JjOS0zZjM0LTQ0NTItOTk3Ny04OTE1ZTc3ZmJlZjMiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZXJuZXRlcy1kYXNoYm9hcmQ6YWRtaW4tdXNlciJ9.d7TVh5L9OKBLY62FXF8ZDjp7dZMH6hmOgd0QKCwPaNEGL_pzJrz1j5JC0TlSaQgFXJKVhUq3WzBsKC2yAsgOc53AKNfJbv0UWKVk5sLXwi79rZiaUdB6cGHOVxiMxUHsluhDAs7DoALyOT3svY5JSh_f5f5h92ZUxBTx5CeFHr47B_MnjG0kgeRR7p8i2vV1OLnW0JQDg-eI0usfFYIzjBy3z1NiVjJJ8ON_ygUNapSXQLuLanjv0Vei_XVTaxfqL9-8AabSm_VDo-mTkqDJWK-utBvQ1AajOWs9fbz8ey6GiC33KevaxxPjNvKfIJI2h0FvDUffy6qysT-IuN2ZEA
ca.crt:     1025 bytes
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>将 Token 输入浏览器，成功登陆后效果如下</li></ul> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/08/9f4c1fb1a6afb0a.png" alt="img"></p> <h2 id="使用-kuboard-替代-kubernetes-dashboard"><a href="#使用-kuboard-替代-kubernetes-dashboard" class="header-anchor">#</a> 使用 Kuboard 替代 Kubernetes Dashboard</h2> <h3 id="概述-11"><a href="#概述-11" class="header-anchor">#</a> 概述</h3> <p>Kubernetes 已然是当下容器编排领域事实上的标准，各大云服务商都急于推出 Kubernetes 服务，互联网公司也纷纷跟进，将自己的应用容器化，并使用 Kubernetes 编排，在 Kubernetes 图形化工具方面，我们已经获得了极大的可选择空间：</p> <ul><li>各云服务商自己推出的 Kubernetes 服务所搭载的管理控制台，例如 阿里云的 Kubernetes 服务，青云推出的 KubeSphere，其他云服务商的 CaaS 类服务</li> <li>Kubernetes 官方的图形管理界面 Kubernetes Dashboard</li> <li>面向企业私有化部署的 Rancher</li></ul> <h3 id="什么是-kuboard"><a href="#什么是-kuboard" class="header-anchor">#</a> 什么是 Kuboard</h3> <p>Kuboard 类似于 Kubernetes Dashboard，是一款轻量级产品，按照 Kuboard 的文档，您可以很快地搭建一套学习 Kubernetes 用的集群环境，您也可以在自己已经有的集群上轻易地完成 Kuboard 的安装</p> <h3 id="安装-kuboard"><a href="#安装-kuboard" class="header-anchor">#</a> 安装 Kuboard</h3> <p>如果您已经有了 Kubernetes 集群，只需要一行命令即可安装 Kuboard：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl apply -f https://kuboard.cn/install-script/kuboard.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后访问您集群中任意节点的 32567 端口（<a href="http://any-of-your-node-ip:32567" target="_blank" rel="noopener noreferrer">http://any-of-your-node-ip:32567<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>） ，即可打开 Kuboard 界面，比如我的 Node 节点 IP 为：<a href="http://192.168.12.110:32567" target="_blank" rel="noopener noreferrer">http://192.168.12.110:32567<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h4 id="获取-token"><a href="#获取-token" class="header-anchor">#</a> 获取 Token</h4> <p>此 Token 拥有 ClusterAdmin 的权限，可以执行所有操作</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep kuboard-user | awk '{print $1}')
# 输出如下
Name:         kuboard-user-token-dsccx
Namespace:    kube-system
Labels:       &lt;none&gt;
Annotations:  kubernetes.io/service-account.name: kuboard-user
              kubernetes.io/service-account.uid: 08aad1b1-3d1b-4b6f-a379-3e320620a09f
Type:  kubernetes.io/service-account-token
Data
====
ca.crt:     1025 bytes
namespace:  11 bytes
token:      eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJrdWJvYXJkLXVzZXItdG9rZW4tZHNjY3giLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoia3Vib2FyZC11c2VyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiMDhhYWQxYjEtM2QxYi00YjZmLWEzNzktM2UzMjA2MjBhMDlmIiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOmt1Ym9hcmQtdXNlciJ9.rndy-u-CxDF_yfaubq2HmIb7o04uLI3z7soqTf581VPLFo31dLmQvDPBJXWmFXHAfy0f-msCZjXWU35Cvwvlg3A5LZXgmfsJJi-kwYgpjnsOpFqquezAR6mDDnyXC1NLb8HD4PXgb4wbqnz6-jXlj7T0EXaDK0U5JvNtnkVy8y66mucz6tGnANqLYsHIYPT86P2VTOAWPrnz3pJHtoo_2AMI_y5Pc9RiVH1cro5I5D8Qf8_XDBE4oTsNXaqvWItnjg1O-nhxwsRpe-Szbe9wtFLbqjsO0_ZF5jPT1SdNrkuzoRJ4FpJsjBpbSpLB_DXtc0Y15oJVNZwpmJXKywCXRw
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="登录-kuboard"><a href="#登录-kuboard" class="header-anchor">#</a> 登录 Kuboard</h4> <p>使用刚才生成的 Token 直接登录即可</p> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/10/2d5d15920d2ff56.png" alt="img"></p> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/10/9a6a1abff8f2ee5.png" alt="img"></p> <h3 id="为什么使用-kuboard"><a href="#为什么使用-kuboard" class="header-anchor">#</a> 为什么使用 Kuboard</h3> <h4 id="非侵入式"><a href="#非侵入式" class="header-anchor">#</a> 非侵入式</h4> <p>Rancher 为了支持多云管理（MeSos，Docker Swarm，Kubernetes 等），引入了一系列复杂的概念，又需要新增安装 Rancher Server、Rancher Agent 等，本来学习 Kubernetes 已然不堪重负，Rancher 再把多云整合到一起来，无疑又增加了学习和使用的复杂性。如果您只是打算使用 Kubernetes 的话，也许并不需要选择 Rancher 这样重量级的产品。Kuboard 仅仅依赖于原生 Kubernetes，可以运行在各种公有云、私有云上，您也可以自己基于物理机、vsphere、vmware 等已经有的基础设施搭建 Kubernetes，轻松实现现有 Infrastructure 的容器化改造</p> <h4 id="名称空间"><a href="#名称空间" class="header-anchor">#</a> 名称空间</h4> <p>在 Kuboard 中，名称空间的展示形式以微服务参考分层架构的形式，将所有的微服务分为如下几层：</p> <ul><li>展现层
<ul><li>终端用户访问的 Web 应用</li></ul></li> <li>API 网关层
<ul><li>Spring Cloud Gateway / Zuul / Kong 等接口网关</li></ul></li> <li>微服务层
<ul><li>Spring Boot 微服务，或 PHP / Python / Go 实现的微服务</li></ul></li> <li>持久层
<ul><li>MySQL 数据库等（开发及测试环境里，将 MySQL 部署于 Kubernetes 可以极大地降低环境维护的任务量）</li></ul></li> <li>中间件层
<ul><li>消息队列</li> <li>服务注册 Eureka / Zookeeper / Consul 等</li></ul></li> <li>监控层
<ul><li>Prometheus + Grafana</li> <li>Pinpooint 等</li></ul></li></ul> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/10/9843af61439f784.jpg" alt="img"></p> <p>更为贴心的，当某一个工作负载存在部署方面的问题时， Kuboard 将以红色高亮出该工作负载，并配有合适的方式辅助用户定位错误信息</p> <h4 id="无需手写-yaml"><a href="#无需手写-yaml" class="header-anchor">#</a> 无需手写 Yaml</h4> <p>学习 Kubernetes 时，需要花费许多的时间，在理解一个概念之后，模仿着写一个 <code>yaml</code> 文件，再使用 <code>kubectl</code> 应用该文件，使用 Kuboard 提供的工作负载编辑器，可以直观的完成应用的部署</p> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/10/c6c02c114acc74a.png" alt="img"></p> <h4 id="应用升级"><a href="#应用升级" class="header-anchor">#</a> 应用升级</h4> <p>Kuboard 提供批量修改容器镜像版本的功能，轻松升级应用程序的版本</p> <p><img src="http://www.qfdmy.com/wp-content/uploads/2019/10/d08f0d4acdff85d.jpg" alt="img"></p> <h2 id="k8s踩坑日记"><a href="#k8s踩坑日记" class="header-anchor">#</a> k8s踩坑日记</h2> <h3 id="不支持-api模式不再支持"><a href="#不支持-api模式不再支持" class="header-anchor">#</a> 不支持 api模式不再支持</h3> <p>将 extensions/v1beta1 换成 app/v1 api即可，相应格式微调。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>apiVersion: apps/v1
kind: Deployment
metadata:
  name: mysql-myshop
spec:
  selector:
    matchLabels:
      app: mysql
  replicas: 1
  template:
    metadata:
      labels:
        app: mysql
    spec:
      containers:
        - name: mysql-myshop
          image: mysql:8.0.16
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 3306
          env:
            - name: MYSQL_ROOT_PASSWORD
              value: &quot;aaazzz123&quot;
          volumeMounts:
            - name: cm-vol-myshop
              mountPath: /etc/mysql/conf.d
            - name: nfs-vol-myshop
              mountPath: /var/lib/mysql
      volumes:
        - name: cm-vol-myshop
          configMap:
            name: mysql-myshop-config
            items:
              - key: mysqld.cnf
                path: mysqld.cnf
        - name: nfs-vol-myshop
          persistentVolumeClaim:
            claimName: nfs-pvc-mysql-myshop
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h2 id="k8s常用命令"><a href="#k8s常用命令" class="header-anchor">#</a> k8s常用命令</h2> <h3 id="kubernetes常用命令"><a href="#kubernetes常用命令" class="header-anchor">#</a> kubernetes常用命令</h3> <h4 id="_1、查看类命令"><a href="#_1、查看类命令" class="header-anchor">#</a> 1、查看类命令</h4> <p><code>kubectl cluster-info</code>    ----查看集群信息</p> <p>kubectl -s http://localhost:8080 get componentstatuses    ----查看各组件信息</p> <p>kubectl get pods    ----列出当前所有的pod</p> <p>kubectl get pods -o wide    ----查看pods所在的运行节点</p> <p>kubectl get pods -o yaml    ----查看pods定义的详细信息</p> <p>kubectl get rc    ----查看Replication Controller信息</p> <p>kubectl get service    ----查看service的信息</p> <p>kubectl get nodes    ----查看节点信息</p> <p>kubectl get pod --selector name=redis    ----按selector名来查找pod</p> <p>kubectl exec pod名 env    ----查看运行的pod的环境变量</p> <h4 id="_2、操作类命令"><a href="#_2、操作类命令" class="header-anchor">#</a> 2、操作类命令</h4> <p>kubectl apply -f 文件名    ----启动</p> <p>kubectl create -f 文件名    ----创建</p> <p>kubectl replace -f 文件名 [--force]    ----重建</p> <p>删除：</p> <p>kubectl delete -f 文件名</p> <p>kubectl delete pod pod名</p> <p>kubectl delete rc rc名</p> <p>kubectl delete service service名</p> <p>kubectl delete pod --all</p> <p>kubectl run mybusybox --image=busybox    ----启动一个pod</p> <p>kubectl run mybusybox --image=busybox --replicas=5    ----启动多个pod</p> <p>kubectl delete deployments mybusybox    ----删除创建的pod</p> <p>kubectl get pods    ----列出当前所有的pod</p> <p>kubectl describe pod [PODNAME]    ----查看pod的状态</p> <p>kubectl run mynginx --image=nginx --port=80 --hostport=8000    ----创建带有端口映射的pod</p> <p>kubectl run -i --tty busybox --image=busybox    ----创建带有终端的pod</p></div> <footer class="page-edit" style="display:none;"><!----> <!----></footer> <!----> <!----></main> <!----> <div class="comments-wrapper" data-v-4698c43e><!----></div></div></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-a81d141e data-v-a81d141e><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-a81d141e><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-a81d141e></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-a81d141e></path></svg></div></div></div>
    <script src="/assets/js/app.20e080e3.js" defer></script><script src="/assets/js/3.69b4042a.js" defer></script><script src="/assets/js/1.c4c6ad86.js" defer></script><script src="/assets/js/17.6a344db1.js" defer></script>
  </body>
</html>
